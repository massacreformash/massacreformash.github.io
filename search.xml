<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
    
    <entry>
      <title><![CDATA[ä½¿ç”¨`presentViewController`æ–¹æ³•å¼¹å‡ºæ¨¡æ€æ§åˆ¶å™¨ å¹¶è¿›è¡Œè‡ªå®šä¹‰æ“ä½œ(äºŒ)]]></title>
      <url>http://yoursite.com/2016/08/14/%E4%BD%BF%E7%94%A8%60presentViewController%60%E6%96%B9%E6%B3%95%E5%BC%B9%E5%87%BA%E6%A8%A1%E6%80%81%E6%8E%A7%E5%88%B6%E5%99%A8%20%E5%B9%B6%E8%BF%9B%E8%A1%8C%E8%87%AA%E5%AE%9A%E4%B9%89%E6%93%8D%E4%BD%9C(%E4%BA%8C)/</url>
      <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><ul>
<li>å‰ä¸€ç¯‡æ–‡ç« å®ç°äº†ä»åˆå§‹æ§åˆ¶å™¨ä¸­é€šè¿‡ç‚¹å‡»æ“ä½œå¼¹å‡º<code>æ¨¡æ€æ§åˆ¶å™¨</code>çš„æ“ä½œ, å¹¶è¿›è¡Œäº†ä¸€ç³»åˆ—åœ¨å¼¹å‡ºè¿‡ç¨‹ä¸­çš„è‡ªå®šä¹‰æ•ˆæœ</li>
<li>è¿™ç¯‡æ–‡ç« å°†ç»§ç»­ä¹‹å‰çš„è®¨è®º, å®Œæˆä¹‹åè¦<code>dismiss</code>æ‰<code>æ¨¡æ€æ§åˆ¶å™¨</code>çš„ä¸€ç³»åˆ—æ–¹æ³•çš„å®ç°è¿‡ç¨‹<blockquote>
<p>æ‰€è°“<code>dismiss</code>, å°±æ˜¯è®©<code>æ¨¡æ€è§†å›¾</code>ä»å±å¹•ä¸Šæ¶ˆå¤±çš„æ“ä½œ</p>
</blockquote>
</li>
</ul>
<h2 id="UIKitåœ¨dismissè¿‡ç¨‹ä¸­éƒ½å¹²äº†å•¥"><a href="#UIKitåœ¨dismissè¿‡ç¨‹ä¸­éƒ½å¹²äº†å•¥" class="headerlink" title="UIKitåœ¨dismissè¿‡ç¨‹ä¸­éƒ½å¹²äº†å•¥"></a><code>UIKit</code>åœ¨<code>dismiss</code>è¿‡ç¨‹ä¸­éƒ½å¹²äº†å•¥</h2><ul>
<li>ä¾æ—§æ˜¯ç¿»è¯‘å®˜æ–¹æ–‡æ¡£ä¸­å…³äº<code>UIKit</code>åœ¨<code>dismiss</code>è¿‡ç¨‹ä¸­çš„è°ƒç”¨è¿‡ç¨‹</li>
</ul>
<blockquote>
<ol>
<li>ä»å½“å‰å¯è§çš„<code>viewController</code>ä¸­å–åˆ°ä¹‹å‰ç¨‹åºå‘˜è‡ªå®šä¹‰çš„<code>presentationController</code></li>
<li>å¦‚æœå­˜åœ¨åŠ¨ç”»å¯¹è±¡æˆ–è€…äº¤äº’å¼åŠ¨ç”»å¯¹è±¡çš„è¯, å°±å‘è¿‡æ¸¡ä»£ç†è¯·æ±‚è¯¥å¯¹è±¡</li>
<li><strong>è°ƒç”¨<code>presentationController</code>ä¸­çš„<code>dismissalTransitionWillBegin</code>æ–¹æ³•</strong><ul>
<li>åœ¨è¯¥æ–¹æ³•ä¸­, ç¨‹åºå‘˜å¯ä»¥æ·»åŠ è‡ªå®šä¹‰çš„ view åˆ°è§†å›¾çš„å±‚çº§ç»“æ„ä¸­, å¹¶å¯¹è¿™äº›è‡ªå®šä¹‰çš„ view é…ç½®åŠ¨ç”»</li>
</ul>
</li>
<li>ä»è‡ªå®šä¹‰çš„<code>presentationController</code>å–åˆ°å·²ç»å¼¹å‡ºçš„<code>presentedView</code></li>
<li><strong>æ‰§è¡Œ<code>dismiss</code>è¿‡ç¨‹ä¸­çš„è·³è½¬åŠ¨ç”»</strong><ul>
<li>è·³è½¬è¿‡æ¸¡åŠ¨ç”»åŒ…æ‹¬ä¸€ä¸ªä¸»åŠ¨ç”»(ç”±åŠ¨ç”»å¯¹è±¡<code>animator objects</code>åˆ›å»º)å’Œè‹¥å¹²éšä¸»åŠ¨ç”»ä¸€èµ·æ‰§è¡Œçš„è‡ªå®šä¹‰åŠ¨ç”»æ•ˆæœ. å¦‚æœæƒ³äº†è§£æ›´å¤šæœ‰å…³è¿‡æ¸¡åŠ¨ç”»çš„ä¿¡æ¯, å¯ä»¥å‚é˜…<a href="https://developer.apple.com/library/ios/featuredarticles/ViewControllerPGforiPhoneOS/CustomizingtheTransitionAnimations.html#//apple_ref/doc/uid/TP40007457-CH16-SW2" target="_blank" rel="external">The Transition Animation Sequence æ–‡æ¡£</a></li>
<li>åœ¨åŠ¨ç”»çš„æ‰§è¡Œè¿‡ç¨‹ä¸­, <code>UIKit</code>ä¼šè°ƒç”¨æˆ‘ä»¬è‡ªå®šä¹‰çš„<code>presentationController</code>ä¸­çš„<code>containerViewWillLayoutSubviews</code>æ–¹æ³•å’Œ<code>containerViewDidLayoutSubviews</code>æ–¹æ³•, ç¨‹åºå‘˜å¯ä»¥åœ¨è¿™ä¸¤ä¸ªæ–¹æ³•ä¸­ç§»é™¤ä¹‹å‰è‡ªå®šä¹‰çš„çº¦æŸ(åº”è¯¥æ˜¯ view å§?)</li>
</ul>
</li>
<li>åœ¨åŠ¨ç”»ç»“æŸæ—¶, ä¼šè°ƒç”¨<code>dismissalTransitionDidEnd:</code>æ–¹æ³•</li>
</ol>
</blockquote>
<h2 id="å®ç°dismissæ¨¡æ€æ§åˆ¶å™¨çš„å…·ä½“æ­¥éª¤"><a href="#å®ç°dismissæ¨¡æ€æ§åˆ¶å™¨çš„å…·ä½“æ­¥éª¤" class="headerlink" title="å®ç°dismissæ¨¡æ€æ§åˆ¶å™¨çš„å…·ä½“æ­¥éª¤"></a>å®ç°<code>dismiss</code>æ¨¡æ€æ§åˆ¶å™¨çš„å…·ä½“æ­¥éª¤</h2><blockquote>
<ul>
<li>å½“æ¨¡æ€æ§åˆ¶å™¨è¢«<code>dismiss</code>æ—¶, å¯ä»¥ä½¿ç”¨<code>dismissalTransitionDidEnd:</code>æ–¹æ³•æ¥ä»è§†å›¾å±‚çº§ç»“æ„ä¸­ç§»é™¤è‡ªå®šä¹‰çš„ view</li>
<li>è€Œå¦‚æœæƒ³è¦åœ¨<code>dismiss</code>çš„è¿‡ç¨‹ä¸­æ‰§è¡Œä¸€äº›æ¶ˆå¤±çš„åŠ¨ç”»æ•ˆæœ, ä¹Ÿå¯ä»¥åœ¨<code>dismissalTransitionDidEnd:</code>ä¸­è¿›è¡Œè‡ªå®šä¹‰</li>
</ul>
</blockquote>
<h3 id="å¼€å§‹dismissè¿‡ç¨‹è°ƒç”¨çš„æ–¹æ³•"><a href="#å¼€å§‹dismissè¿‡ç¨‹è°ƒç”¨çš„æ–¹æ³•" class="headerlink" title="å¼€å§‹dismissè¿‡ç¨‹è°ƒç”¨çš„æ–¹æ³•"></a>å¼€å§‹<code>dismiss</code>è¿‡ç¨‹è°ƒç”¨çš„æ–¹æ³•</h3><figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">-</span> (void)<span class="selector-tag">dismissalTransitionWillBegin</span> &#123;</div><div class="line">    <span class="comment">//å°†æš—è‰²è§†å›¾æ¸å‡º</span></div><div class="line">    <span class="selector-tag">if</span>([[self presentedViewController] transitionCoordinator]) &#123;</div><div class="line">        <span class="selector-attr">[[[self presentedViewController]</span> <span class="selector-tag">transitionCoordinator</span>]</div><div class="line">         <span class="selector-tag">animateAlongsideTransition</span>:^(id&lt;UIViewControllerTransitionCoordinatorContext&gt;</div><div class="line">                                      context) &#123;</div><div class="line">             <span class="selector-attr">[[self dimmingView]</span> <span class="selector-tag">setAlpha</span><span class="selector-pseudo">:0.0</span>];</div><div class="line">         &#125; <span class="attribute">completion</span>:nil];</div><div class="line">    &#125;</div><div class="line">    <span class="selector-tag">else</span> &#123;</div><div class="line">        <span class="selector-attr">[[self dimmingView]</span> <span class="selector-tag">setAlpha</span><span class="selector-pseudo">:0.0</span>];</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="dismissè¿‡ç¨‹ç»“æŸåè°ƒç”¨çš„æ–¹æ³•"><a href="#dismissè¿‡ç¨‹ç»“æŸåè°ƒç”¨çš„æ–¹æ³•" class="headerlink" title="dismissè¿‡ç¨‹ç»“æŸåè°ƒç”¨çš„æ–¹æ³•"></a><code>dismiss</code>è¿‡ç¨‹ç»“æŸåè°ƒç”¨çš„æ–¹æ³•</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)dismissalTransitionDidEnd:(<span class="built_in">BOOL</span>)completed &#123;</div><div class="line">    <span class="comment">//å¦‚æœ dismiss è¿‡ç¨‹æˆåŠŸç»“æŸ, åˆ™å°†æš—è‰²è§†å›¾ä»å±‚çº§ç»“æ„ä¸­ç§»é™¤</span></div><div class="line">    <span class="keyword">if</span> (completed)</div><div class="line">        [<span class="keyword">self</span>.dimmingView removeFromSuperview];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>è¿è¡Œæµ‹è¯•<br>å¯ä»¥çœ‹åˆ°, åœ¨<code>dismiss</code>çš„è¿‡ç¨‹ä¸­, æš—è‰²çš„èƒŒæ™¯è§†å›¾ç”±æ·±è‡³æµ…æ¶ˆå¤±ä¸è§äº†<br><img src="http://d.pr/i/1iQMa+" alt="æµ‹è¯•"></p>
</blockquote>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[ä½¿ç”¨`presentViewController`æ–¹æ³•å¼¹å‡ºæ¨¡æ€æ§åˆ¶å™¨ å¹¶è¿›è¡Œè‡ªå®šä¹‰æ“ä½œ(ä¸€)]]></title>
      <url>http://yoursite.com/2016/08/10/%E4%BD%BF%E7%94%A8%60presentViewController%60%E6%96%B9%E6%B3%95%E5%BC%B9%E5%87%BA%E6%A8%A1%E6%80%81%E6%8E%A7%E5%88%B6%E5%99%A8%20%E5%B9%B6%E8%BF%9B%E8%A1%8C%E8%87%AA%E5%AE%9A%E4%B9%89%E6%93%8D%E4%BD%9C(%E4%B8%80)/</url>
      <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><ul>
<li>è‡ªå·±åœ¨åšé¡¹ç›®çš„æ—¶å€™, éœ€è¦å®ç°ä¸€ä¸ªè‡ªå®šä¹‰å¼¹çª—çš„æ•ˆæœ, åŒæ—¶åœ¨ä¸Šé¢å®ç°å¾ˆå¤šå­åŠŸèƒ½, æ­¤æ—¶å¦‚æœç”¨è‡ªå®šä¹‰çš„Viewæ¥åšçš„è¯å°±æ˜¾å¾—æœ‰äº›åŠ›ä¸ä»å¿ƒäº†, å¿…é¡»æƒ³åˆ°å¦ä¸€ç§æ–¹æ³•å®ç°</li>
<li>æ›´åˆé€‚çš„å®ç°æ–¹å¼åº”è¯¥å°±æ˜¯ä½¿ç”¨<code>presentViewController: animated: completion:</code>æ–¹æ³•å¼¹å‡ºæ¨¡æ€æ§åˆ¶å™¨æ¥åš, ä½†å¦‚æœä¸è¿›è¡Œè‡ªå®šä¹‰çš„è¯, å¼¹å‡ºçš„æ§åˆ¶å™¨æ°¸è¿œéƒ½æ˜¯å’Œå±å¹•ä¸€æ ·å¤§, å› æ­¤éœ€è¦è¿›è¡Œè‡ªå®šä¹‰</li>
<li>æ¯”è¾ƒå‘çš„æ˜¯, ç½‘ä¸Šå¾ˆå¤šè‡ªå®šä¹‰presentæ§åˆ¶å™¨çš„æ–¹æ³•éƒ½æ˜¯<code>iOS 8.0</code>ä¹‹å‰çš„å®ç°æ­¥éª¤äº†, è¦æ‰¾åˆ°ä¸€ä¸ªèƒ½å®Œç¾è§£å†³é—®é¢˜çš„æ•™ç¨‹å¾ˆéš¾, ä¸å¾—å·²åªå¥½ç¿»é˜…è‹¹æœå®˜æ–¹çš„ develop æ–‡æ¡£, é€šè¯»ä¹‹åé¡ºåˆ©è§£å†³é—®é¢˜, ä¸‹é¢å°±æŠŠè‡ªå·±å®ç°çš„è¿‡ç¨‹åšä¸€ä¸‹æ¢³ç†</li>
</ul>
<blockquote>
<ul>
<li>å®˜æ–¹æ–‡æ¡£: <code>Creating Custom Presentations</code></li>
<li><a href="https://developer.apple.com/library/prerelease/content/featuredarticles/ViewControllerPGforiPhoneOS/DefiningCustomPresentations.html#//apple_ref/doc/uid/TP40007457-CH25-SW1" target="_blank" rel="external">æ–‡æ¡£åœ°å€</a></li>
<li>å¦‚æœæ‰“ä¸å¼€çš„è¯, å¯ä»¥ç›´æ¥åœ¨<a href="https://developer.apple.com/" target="_blank" rel="external">https://developer.apple.com/</a>çš„æœç´¢æ¡†ä¸­æœç´¢<code>Creating Custom Presentations</code>è¿™ç¯‡æ–‡æ¡£</li>
</ul>
</blockquote>
<h2 id="å®ç°è‡ªå®šä¹‰æ¨¡æ€æ§åˆ¶å™¨çš„å…·ä½“æ­¥éª¤"><a href="#å®ç°è‡ªå®šä¹‰æ¨¡æ€æ§åˆ¶å™¨çš„å…·ä½“æ­¥éª¤" class="headerlink" title="å®ç°è‡ªå®šä¹‰æ¨¡æ€æ§åˆ¶å™¨çš„å…·ä½“æ­¥éª¤"></a>å®ç°è‡ªå®šä¹‰æ¨¡æ€æ§åˆ¶å™¨çš„å…·ä½“æ­¥éª¤</h2><h3 id="åœ¨åˆå§‹æ§åˆ¶å™¨éœ€è¦å®Œæˆçš„æ­¥éª¤"><a href="#åœ¨åˆå§‹æ§åˆ¶å™¨éœ€è¦å®Œæˆçš„æ­¥éª¤" class="headerlink" title="åœ¨åˆå§‹æ§åˆ¶å™¨éœ€è¦å®Œæˆçš„æ­¥éª¤"></a>åœ¨åˆå§‹æ§åˆ¶å™¨éœ€è¦å®Œæˆçš„æ­¥éª¤</h3><blockquote>
<p>åœ¨æœ¬ä¾‹ä¸­, å‡è®¾åœ¨ç¨‹åºå¯åŠ¨å, ç‚¹å‡»å±å¹•å°±ä¼šå¼¹å‡º<code>æ¨¡æ€æ§åˆ¶å™¨</code>, æ‰€ä»¥ä¸‹é¢çš„é€»è¾‘ä»£ç å‡åœ¨<code>touchesBegan: withEvent:</code>ä¸­å®ç°</p>
</blockquote>
<ul>
<li>åœ¨å‡†å¤‡å¼¹å‡º<code>æ¨¡æ€æ§åˆ¶å™¨</code>çš„åˆå§‹<code>viewController</code>ä¸­(å®é™…ä¸Šè¿™ä¸ªæ§åˆ¶å™¨åº”å½“è¢«ç§°ä¸º<code>presentingViewController</code>, ä¸‹åŒ)åˆå§‹åŒ–<code>æ¨¡æ€æ§åˆ¶å™¨</code>(åŒæ ·çš„, åœ¨æ–¹æ³•ä¸­, è¿™ä¸ªè¦å¼¹å‡ºæ¥çš„<code>æ¨¡æ€æ§åˆ¶å™¨</code>è¢«ç§°ä¸º<code>presentedViewController</code>, ä¸‹åŒ)</li>
</ul>
<blockquote>
<p>äº‹å…ˆéœ€è¦è‡ªå®šä¹‰ä¸€ä¸ªæ–°ç±»ä½œä¸ºè¦åˆå§‹åŒ–çš„<code>presentedViewController</code>, å¹¶ç»§æ‰¿è‡ª<code>UIViewController</code>, æœ¬ä¾‹ä¸­è‡ªå®šä¹‰äº†ä¸€ä¸ªåä¸º</p>
<ul>
<li><strong><code>MusicViewController</code></strong></li>
</ul>
<p>çš„ç±»ä½œä¸ºè¦å¼¹å‡ºçš„<code>presentedViewController</code>çš„ç±»</p>
</blockquote>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="selector-id">#import</span> <span class="string">"MusicViewController.h"</span></div></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">-(<span class="keyword">void</span>)touchesBegan:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(<span class="built_in">UIEvent</span> *)event&#123;</div><div class="line">  </div><div class="line">    <span class="comment">//1.</span></div><div class="line">    MusicViewController *vc = [[MusicViewController alloc] init];</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>è®¾ç½®<code>presentedViewController</code>çš„<code>modalPresentationStyle</code>å±æ€§ä¸º<code>UIModalPresentationCustom</code></li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">-(<span class="keyword">void</span>)touchesBegan:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(<span class="built_in">UIEvent</span> *)event&#123;</div><div class="line">    </div><div class="line">    <span class="comment">//1.</span></div><div class="line">    MusicViewController *vc = [[MusicViewController alloc] init];</div><div class="line">    </div><div class="line">    <span class="comment">//2.</span></div><div class="line">    vc.modalPresentationStyle = <span class="built_in">UIModalPresentationCustom</span>;</div><div class="line">   </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>åˆå§‹åŒ–<code>presentedViewController</code>çš„ä»£ç†<blockquote>
<ul>
<li>è¿™ä¸ªä»£ç†æ˜¯<strong>é‡ä¸­ä¹‹é‡</strong>, æ˜¯å®ç°è‡ªå®šä¹‰<code>presentedViewController</code>çš„æœ€é‡è¦çš„ç»„æˆéƒ¨åˆ†, ä¸‹é¢çš„æ­¥éª¤ä¸­ä¼š<strong>é‡ç‚¹åˆ†æ</strong></li>
</ul>
<p>æš‚æ—¶éœ€è¦çŸ¥é“çš„æ˜¯, è¿™ä¸ªä»£ç†éœ€è¦è‡ªå®šä¹‰ä¸€ä¸ªéµå®ˆ<code>&lt;UIViewControllerTransitioningDelegate&gt;</code>åè®®çš„ç±», å¹¶ä¸”ç»§æ‰¿è‡ª<code>UIPresentationController</code>ç±». æœ¬ä¾‹ä¸­è‡ªå®šä¹‰äº†ä¸€ä¸ªåä¸º</p>
<ul>
<li><strong><code>MusicAnimator</code></strong></li>
</ul>
<p>çš„ç±»ä½œä¸ºè¦å¼¹å‡ºçš„<code>presentedViewController</code>çš„ä»£ç†</p>
</blockquote>
</li>
</ul>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="selector-id">#import</span> <span class="string">"MusicAnimator.h"</span></div></pre></td></tr></table></figure>
<figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="variable">@interface</span> ViewController ()</div><div class="line"><span class="variable">@property</span> (nonatomic, strong) MusicAnimator *animotor;</div><div class="line"><span class="variable">@end</span></div></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">-(<span class="keyword">void</span>)touchesBegan:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(<span class="built_in">UIEvent</span> *)event&#123;</div><div class="line">    </div><div class="line">    <span class="comment">//1.</span></div><div class="line">    MusicViewController *vc = [[MusicViewController alloc] init];</div><div class="line">    </div><div class="line">    <span class="comment">//2.</span></div><div class="line">    vc.modalPresentationStyle = <span class="built_in">UIModalPresentationCustom</span>;</div><div class="line">    </div><div class="line">    <span class="comment">//3.</span></div><div class="line">    <span class="keyword">self</span>.animotor = [[MusicAnimator alloc] init];</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>è®¾ç½®<code>presentedViewController</code>çš„ä»£ç†ä¸ºåˆšæ‰åˆå§‹åŒ–å¥½çš„ä»£ç†å¯¹è±¡</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">-(<span class="keyword">void</span>)touchesBegan:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(<span class="built_in">UIEvent</span> *)event&#123;</div><div class="line">    </div><div class="line">    <span class="comment">//1.</span></div><div class="line">    MusicViewController *vc = [[MusicViewController alloc] init];</div><div class="line">    </div><div class="line">    <span class="comment">//2.</span></div><div class="line">    vc.modalPresentationStyle = <span class="built_in">UIModalPresentationCustom</span>;</div><div class="line">    </div><div class="line">    <span class="comment">//3.</span></div><div class="line">    <span class="keyword">self</span>.animotor = [[MusicAnimator alloc] init];</div><div class="line">    </div><div class="line">    <span class="comment">//4.</span></div><div class="line">    vc.transitioningDelegate = <span class="keyword">self</span>.animotor;</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>è°ƒç”¨<code>presentViewController: animated: completion:</code>æ–¹æ³•å¼¹å‡ºæ¨¡æ€æ§åˆ¶å™¨</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">-(<span class="keyword">void</span>)touchesBegan:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(<span class="built_in">UIEvent</span> *)event&#123;</div><div class="line">    </div><div class="line">    <span class="comment">//1.</span></div><div class="line">    MusicViewController *vc = [[MusicViewController alloc] init];</div><div class="line">    </div><div class="line">    <span class="comment">//2.</span></div><div class="line">    vc.modalPresentationStyle = <span class="built_in">UIModalPresentationCustom</span>;</div><div class="line">    </div><div class="line">    <span class="comment">//3.</span></div><div class="line">    <span class="keyword">self</span>.animotor = [[MusicAnimator alloc] init];</div><div class="line">    </div><div class="line">    <span class="comment">//4.</span></div><div class="line">    vc.transitioningDelegate = <span class="keyword">self</span>.animotor;</div><div class="line">    </div><div class="line">    <span class="comment">//5.</span></div><div class="line">    [<span class="keyword">self</span> presentViewController:vc animated:<span class="literal">YES</span> completion:^&#123;</div><div class="line">    &#125;];</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="è‡ªå®šä¹‰presentedViewControllerçš„ä»£ç†"><a href="#è‡ªå®šä¹‰presentedViewControllerçš„ä»£ç†" class="headerlink" title="è‡ªå®šä¹‰presentedViewControllerçš„ä»£ç†"></a>è‡ªå®šä¹‰<code>presentedViewController</code>çš„ä»£ç†</h3><blockquote>
<p>è¿™ä¸ªä»£ç†é›†æˆäº†å‡ ä¹æ‰€æœ‰å¼¹å‡º<code>æ¨¡æ€</code>çš„è‡ªå®šä¹‰æ“ä½œ, åœ¨<a href="https://developer.apple.com/library/prerelease/content/featuredarticles/ViewControllerPGforiPhoneOS/DefiningCustomPresentations.html#//apple_ref/doc/uid/TP40007457-CH25-SW1" target="_blank" rel="external">å®˜æ–¹æ–‡æ¡£</a>ä¸­, è‹¹æœä¸ºæˆ‘ä»¬è¯¦ç»†è¯´æ˜äº† <code>UIKit</code> æ˜¯å¦‚ä½•é€šè¿‡è¿™ä¸ªä»£ç†å®Œæˆå¼¹å‡º<code>æ¨¡æ€</code>çš„æ“ä½œ: </p>
<ol>
<li>è°ƒç”¨<strong>ä»£ç†</strong>çš„ <code>presentationControllerForPresentedViewController:presentingViewController:sourceViewController:</code> æ–¹æ³•æ¥æ£€ç´¢è‡ªå®šä¹‰çš„ <code>presentationController</code><ul>
<li>(å®é™…ä¸Šè¿™é‡Œçš„<strong>ä»£ç†</strong>å°±æ˜¯ <code>presentedViewController</code> çš„ä»£ç†, ä¹Ÿå°±æ˜¯æœ¬ä¾‹ä¸­ç»§æ‰¿è‡ª <code>UIPresentationController</code> ç±»çš„ <code>MusicAnimator</code> å¯¹è±¡)</li>
</ul>
</li>
<li>å¦‚æœ<strong>ä»£ç†</strong>ä¸­å­˜åœ¨åŠ¨ç”»å’Œäº¤äº’å¼åŠ¨ç”»å¯¹è±¡ï¼Œåˆ™è°ƒç”¨å®ƒä»¬</li>
<li><strong>è°ƒç”¨ <code>presentationController</code> çš„ <code>presentationTransitionWillBegin</code> æ–¹æ³•</strong><ul>
<li>ç¨‹åºå‘˜åœ¨å¯¹äºè¯¥æ–¹æ³•çš„å®ç°ä¸­, å¯ä»¥æ·»åŠ è‡ªå®šä¹‰ <code>view</code> åˆ°è§†å›¾å±‚çº§ç»“æ„ä¸­, å¹¶é…ç½®è¿™äº› <code>view</code> çš„åŠ¨ç”»ã€‚</li>
</ul>
</li>
<li><strong>ä» <code>presentationController</code> è·å– <code>presentedView</code></strong><ul>
<li>è¯¥æ–¹æ³•è¿”å›çš„ <code>view</code> ç”±åŠ¨ç”»å¯¹è±¡ç§»åŠ¨åˆ°æœ€ç»ˆç¡®å®šçš„ä½ç½®. æ­£å¸¸æƒ…å†µä¸‹ï¼Œè¯¥æ–¹æ³•è¿”å› <code>presentedViewController</code> çš„æ ¹è§†å›¾.</li>
<li>å¦‚æœéœ€è¦çš„è¯, ç¨‹åºå‘˜è‡ªå®šä¹‰çš„ <code>presentationController</code> å¯ä»¥ç”¨è‡ªå®šä¹‰èƒŒæ™¯è§†å›¾æ›¿æ¢è¯¥è§†å›¾.<br>å¦‚æœæŒ‡å®šäº†ä¸€ä¸ªä¸åŒçš„è§†å›¾ï¼Œåˆ™å¿…é¡»å°† <code>presentedViewController</code> çš„æ ¹è§†å›¾æ·»åŠ åˆ°è‡ªå·±çš„è§†å›¾å±‚çº§ç»“æ„ä¸­</li>
</ul>
</li>
<li><strong>æ‰§è¡Œè¿‡æ¸¡åŠ¨ç”»</strong><ul>
<li>è¿‡æ¸¡åŠ¨ç”»åŒ…æ‹¬åŠ¨ç”»å¯¹è±¡åˆ›å»ºçš„ä¸»è¦åŠ¨ç”», å’Œå…¶ä»–ç”±ç¨‹åºå‘˜é…ç½®çš„ä¸ä¸»åŠ¨ç”»ä¸€èµ·è¿è¡Œçš„åŠ¨ç”»ã€‚<br>å…³äºè¿‡æ¸¡åŠ¨ç”»çš„æ›´å¤šä¿¡æ¯ï¼Œå‚è§<a href="https://developer.apple.com/library/prerelease/content/featuredarticles/ViewControllerPGforiPhoneOS/CustomizingtheTransitionAnimations.html#//apple_ref/doc/uid/TP40007457-CH16-SW2" target="_blank" rel="external">The Transition Animation Sequence</a></li>
<li>åœ¨åŠ¨ç”»è¿‡ç¨‹ä¸­ï¼Œ<code>UIKit</code> è°ƒç”¨è‡ªå®šä¹‰çš„ <code>presentationController</code> çš„ <code>containerViewWillLayoutSubviews</code> å’Œ <code>containerViewDidLayoutSubviews</code> æ–¹æ³•ï¼Œè¿™æ ·ä½ å¯ä»¥æ ¹æ®éœ€è¦è°ƒæ•´è‡ªå®šä¹‰è§†å›¾çš„å¸ƒå±€ã€‚</li>
</ul>
</li>
<li>å½“è¿‡æ¸¡åŠ¨ç”»å®Œæˆæ—¶ï¼Œä¼šè°ƒç”¨ <code>presentationTransitionDidEnd:</code> æ–¹æ³•</li>
</ol>
</blockquote>
<h4 id="æ˜¾ç¤ºè‡ªå®šä¹‰çš„-presentedViewController"><a href="#æ˜¾ç¤ºè‡ªå®šä¹‰çš„-presentedViewController" class="headerlink" title="æ˜¾ç¤ºè‡ªå®šä¹‰çš„ presentedViewController"></a>æ˜¾ç¤ºè‡ªå®šä¹‰çš„ <code>presentedViewController</code></h4><blockquote>
<p>åœ¨æ­¤ä¹‹å‰, ç”±äºæ¨¡æ€æ§åˆ¶å™¨è¿˜æ²¡æœ‰èƒŒæ™¯è‰², æ‰€ä»¥å…ˆç»™å…¶è®¾ç½®ä¸€ä¸ªèƒŒæ™¯è‰², ä»¥ä¾¿è§‚å¯Ÿ, è¿™é‡Œè®¾ç½®çš„æ˜¯<strong>é»„è‰²</strong></p>
</blockquote>
<ul>
<li>æœ€é¦–è¦çš„ä»»åŠ¡, æ˜¯å…ˆè¦èƒ½å¤Ÿå°†ä¸€ä¸ªå®Œæ•´çš„æ¨¡æ€æ§åˆ¶å™¨æ˜¾ç¤ºå‡ºæ¥, é‚£ä¹ˆåœ¨ä»£ç†æ§åˆ¶å™¨ä¸­, é¦–å…ˆè¦å®ç°ä¸‹é¢è¿™ä¸ªæ–¹æ³•</li>
<li>è¯¥æ–¹æ³•å°±æ˜¯ä¸Šé¢<code>æ­¥éª¤1</code>ä¸­, <code>UIKit</code> ç”¨æ¥æ£€ç´¢è‡ªå®šä¹‰çš„ <code>presentationController</code>çš„æ–¹æ³•</li>
</ul>
<figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="variable">@implementation</span> MusicAnimator</div><div class="line"></div><div class="line">- (UIPresentationController *)<span class="attribute">presentationControllerForPresentedViewController</span>:(UIViewController *)presented</div><div class="line">                                                      <span class="attribute">presentingViewController</span>:(UIViewController *)presenting</div><div class="line">                                                          <span class="attribute">sourceViewController</span>:(UIViewController *)source &#123;</div><div class="line">    </div><div class="line">    MusicAnimator* myPresentation = <span class="selector-attr">[[MusicAnimator alloc]</span></div><div class="line">                                     <span class="selector-tag">initWithPresentedViewController</span><span class="selector-pseudo">:presented</span> <span class="selector-tag">presentingViewController</span><span class="selector-pseudo">:presenting</span>];</div><div class="line">    </div><div class="line">    return myPresentation;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="variable">@end</span></div></pre></td></tr></table></figure>
<blockquote>
<p>è¿è¡Œæµ‹è¯•<br>ç‚¹å‡»å±å¹•å, ä¼šå¼¹å‡ºå¦‚ä¸‹ç•Œé¢<br><img src="http://d.pr/i/kF4H+" alt="æµ‹è¯•"></p>
</blockquote>
<h4 id="ä¿®æ”¹-presentedViewController-çš„frameå¤§å°"><a href="#ä¿®æ”¹-presentedViewController-çš„frameå¤§å°" class="headerlink" title="ä¿®æ”¹ presentedViewController çš„frameå¤§å°"></a>ä¿®æ”¹ <code>presentedViewController</code> çš„<code>frame</code>å¤§å°</h4><ul>
<li>ä¸‹é¢çš„æ–¹æ³•, æè¿°äº†å¦‚ä½•è‡ªå®šä¹‰<code>presentedViewController</code>çš„<code>frame</code></li>
</ul>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">- (CGRect)frameOfPresentedViewInContainerView &#123;</div><div class="line">    <span class="comment">//åˆå§‹åŒ–æ¨¡æ€æ§åˆ¶å™¨çš„ frame</span></div><div class="line">    CGRect presentedViewFrame = CGRectZero;</div><div class="line">    <span class="comment">//è·å¾—é»˜è®¤çš„å®¹å™¨è§†å›¾çš„å¤§å°(é»˜è®¤ä¸ºä¸å±å¹•ä¸€æ ·å¤§)</span></div><div class="line">    CGRect containerBounds = [[self containerView] bounds];</div><div class="line">    </div><div class="line">    <span class="comment">//è®¾ç½®æ¨¡æ€æ§åˆ¶å™¨çš„ size ä¸ºå®½é«˜éƒ½æ˜¯å±å¹•å¤§å°çš„ä¸€åŠ, å¹¶å‘ä¸‹å–æ•´</span></div><div class="line">    presentedViewFrame.<span class="built_in">size</span> = CGSizeMake(floorf(containerBounds.<span class="built_in">size</span>.<span class="built_in">width</span> * <span class="number">0.5</span>),</div><div class="line">                                         floorf(containerBounds.<span class="built_in">size</span>.<span class="built_in">height</span> * <span class="number">0.5</span>));</div><div class="line">    <span class="comment">//è®¾ç½®è®¾ç½®æ¨¡æ€æ§åˆ¶å™¨çš„åˆå§‹ä½ç½®</span></div><div class="line">    presentedViewFrame.origin.x = (containerBounds.<span class="built_in">size</span>.<span class="built_in">width</span> -</div><div class="line">    presentedViewFrame.<span class="built_in">size</span>.<span class="built_in">width</span>) * <span class="number">0.5</span>;</div><div class="line">    presentedViewFrame.origin.y = (containerBounds.<span class="built_in">size</span>.<span class="built_in">height</span> -</div><div class="line">    presentedViewFrame.<span class="built_in">size</span>.<span class="built_in">height</span>) * <span class="number">0.5</span>;</div><div class="line">    <span class="comment">//è¿”å›è‡ªå®šä¹‰ä¹‹åçš„æ¨¡æ€æ§åˆ¶å™¨çš„ frame</span></div><div class="line">    <span class="built_in">return</span> presentedViewFrame;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>è¿è¡Œæµ‹è¯•<br>ç‚¹å‡»å±å¹•å, ä¼šå¼¹å‡ºå¦‚ä¸‹ç•Œé¢<br><img src="http://d.pr/i/F6NU+" alt="æµ‹è¯•"></p>
</blockquote>
<h4 id="ç®¡ç†è‡ªå®šä¹‰Viewå¹¶æ·»åŠ åŠ¨ç”»"><a href="#ç®¡ç†è‡ªå®šä¹‰Viewå¹¶æ·»åŠ åŠ¨ç”»" class="headerlink" title="ç®¡ç†è‡ªå®šä¹‰Viewå¹¶æ·»åŠ åŠ¨ç”»"></a>ç®¡ç†è‡ªå®šä¹‰<code>View</code>å¹¶æ·»åŠ åŠ¨ç”»</h4><ul>
<li>æ–‡æ¡£æè¿°å¦‚ä¸‹(è‡ªå·±ç¿»è¯‘çš„, äº›è®¸ä¸å‡†, è¯·æŒ‡æ­£ğŸ˜Š)</li>
</ul>
<blockquote>
<ul>
<li>è‡ªå®šä¹‰<code>presentation</code>æ•ˆæœé€šå¸¸åŒ…æ‹¬â€æ·»åŠ è‡ªå®šä¹‰ View â€œåˆ°è¦<code>presented</code>çš„æ§åˆ¶å™¨ä¸­, ç¨‹åºå‘˜å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼å®ç°ç®€å•çš„è§†è§‰æ•ˆæœ, æˆ–è€…æ·»åŠ ä¸€äº›å®é™…çš„åŠ¨ä½œåˆ°<code>presentation</code>è¿‡ç¨‹ä¸­.</li>
<li>ä¸¾ä¾‹æ¥è¯´, å¯ä»¥æ·»åŠ ä¸€ä¸ªåŒ…å«ç€æ‰‹åŠ¿å¯¹è±¡çš„<code>backgroundView</code>åˆ°éœ€è¦<code>presented</code>çš„æ§åˆ¶å™¨çš„<code>bounds</code>ä¹‹å¤–, æ¥è¿½è¸ªä¸€äº›ç‰¹å®šçš„æ‰‹åŠ¿æ“ä½œ(æˆ‘è‡ªå·±æ³¨: å¦‚ç‚¹å‡»<code>presented</code>çš„æ§åˆ¶å™¨å¤–å¯ä»¥å°†å…¶ dismiss æ‰ä¹‹ç±»çš„æ“ä½œ)</li>
<li>åœ¨<code>presentation</code>çš„è¿‡ç¨‹ä¸­, æ‰€æœ‰<code>åˆ›å»º</code>å’Œ<code>ç®¡ç†</code>è‡ªå®šä¹‰ View çš„æ“ä½œ, éƒ½æ˜¯ç”±ç”¨æˆ·è‡ªå®šä¹‰çš„<code>presentationController</code>è´Ÿè´£çš„.</li>
<li>é€šå¸¸æƒ…å†µä¸‹, åˆ›å»ºè‡ªå®šä¹‰ View çš„æ“ä½œ, éƒ½æ˜¯åœ¨åˆå§‹åŒ–<code>presentationController</code>çš„æ–¹æ³•ä¸­å®Œæˆçš„. ä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†ä¸€ä¸ªåˆå§‹åŒ–è‡ªå®šä¹‰ View , å¹¶å¯¹å…¶è¿›è¡Œä¸€äº›ç®€å•é…ç½®çš„è¿‡ç¨‹</li>
</ul>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//åˆå§‹åŒ–presentationControllerçš„æ–¹æ³•</span></div><div class="line">- (<span class="keyword">instancetype</span>)initWithPresentedViewController:(<span class="built_in">UIViewController</span> *)presentedViewController</div><div class="line">                       presentingViewController:(<span class="built_in">UIViewController</span> *)presentingViewController &#123;</div><div class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> initWithPresentedViewController:presentedViewController</div><div class="line">                         presentingViewController:presentingViewController];</div><div class="line">    <span class="keyword">if</span>(<span class="keyword">self</span>) &#123;</div><div class="line">        <span class="comment">// åˆå§‹åŒ–ä¸€ä¸ªæš—è‰²è§†å›¾, å¹¶è®¾ç½®åˆå§‹å¤–è§‚</span></div><div class="line">        <span class="keyword">self</span>.dimmingView = [[<span class="built_in">UIView</span> alloc] init];</div><div class="line">        [<span class="keyword">self</span>.dimmingView setBackgroundColor:[<span class="built_in">UIColor</span> colorWithWhite:<span class="number">0.0</span> alpha:<span class="number">0.4</span>]];</div><div class="line">        [<span class="keyword">self</span>.dimmingView setAlpha:<span class="number">0.0</span>];</div><div class="line">        <span class="comment">//æ³¨æ„! è¿™é‡Œå¹¶æ²¡æœ‰å°†åˆå§‹åŒ–çš„è‡ªå®šä¹‰ View æ·»åŠ ä¸Šå»!</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>ç»§ç»­æ–‡æ¡£æè¿°</li>
</ul>
<blockquote>
<ul>
<li>æƒ³è¦å°†è‡ªå®šä¹‰ View æ¸²æŸ“åˆ°å±å¹•ä¸Šå¹¶å¼€å§‹åšåŠ¨ç”»çš„è¯, éœ€è¦è°ƒç”¨<code>presentationTransitionWillBegin</code>æ–¹æ³•. åœ¨è¯¥æ–¹æ³•ä¸­, å¯ä»¥é…ç½®è‡ªå®šä¹‰çš„ View çš„å±æ€§å¹¶å°†å…¶æ·»åŠ åˆ°<code>presentationController</code>çš„<code>containerView</code>ä¸­</li>
<li>å¦‚æœæƒ³è¦åšåŠ¨ç”», åˆ™å¯ä»¥é€‰ç”¨<code>presentedViewController</code>æˆ–è€…<code>presentingViewController</code>çš„<code>transitionCoordinator</code>æ¥åˆ›å»ºåŠ¨ç”».</li>
<li>ä¸è¦åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ä¿®æ”¹æœ‰å…³äº<code>presentedViewController</code>ä¹‹ä¸Šçš„ä»»ä½• View (ä¹Ÿå°±æ˜¯è¯´, è¿™ä¸ªæ–¹æ³•åªç”¨æ¥è®¾ç½®è‡ªå®šä¹‰ View å’ŒåŠ¨ç”»æ•ˆæœ, è€Œä¸æ˜¯è®¾ç½®æ”¾ç½®åœ¨æ¨¡æ€æ§åˆ¶å™¨ä¸Šçš„viewçš„)</li>
<li><code>transitionCoordinator</code>è¿™ä¸ªåŠ¨ç”»å¯¹è±¡, å°±æ˜¯è´Ÿè´£å°†<code>presentedViewController</code>æ¸²æŸ“åˆ°ä¹‹å‰æˆ‘ä»¬åœ¨<code>frameOfPresentedViewInContainerView</code>æ–¹æ³•ä¸­è¿”å›çš„<code>frame</code>çš„ä½ç½®ä¸Šçš„å¯¹è±¡</li>
</ul>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)presentationTransitionWillBegin &#123;</div><div class="line">    <span class="comment">//å–åˆ° presentationController çš„å®¹å™¨è§†å›¾</span></div><div class="line">    <span class="built_in">UIView</span>* containerView = [<span class="keyword">self</span> containerView];</div><div class="line">    <span class="comment">//å–åˆ°å‡†å¤‡è·³è½¬çš„ presentedViewController</span></div><div class="line">    <span class="built_in">UIViewController</span>* presentedViewController = [<span class="keyword">self</span> presentedViewController];</div><div class="line">    </div><div class="line">    <span class="comment">//è®¾ç½®æš—è‰²è§†å›¾çš„ frame ä¸º containerView çš„å¤§å°(ä¹Ÿå°±æ˜¯å±å¹•çš„å¤§å°)</span></div><div class="line">    <span class="comment">////è®¾ç½®æš—è‰²è§†å›¾çš„ alpha å€¼ ä¸º0</span></div><div class="line">    [[<span class="keyword">self</span> dimmingView] setFrame:[containerView bounds]];</div><div class="line">    [[<span class="keyword">self</span> dimmingView] setAlpha:<span class="number">0.0</span>];</div><div class="line">    </div><div class="line">    <span class="comment">//å°†æš—è‰²è§†å›¾æ’å…¥åˆ° containerView çš„æ‰€æœ‰è§†å›¾çš„æœ€ä¸‹æ–¹</span></div><div class="line">    [containerView insertSubview:[<span class="keyword">self</span> dimmingView] atIndex:<span class="number">0</span>];</div><div class="line">    </div><div class="line">    <span class="comment">//è®¾ç½®æš—è‰²è§†å›¾çš„æ¸å…¥æ•ˆæœ</span></div><div class="line">    <span class="keyword">if</span>([presentedViewController transitionCoordinator]) &#123;</div><div class="line">        [[presentedViewController transitionCoordinator]</div><div class="line">         animateAlongsideTransition:^(<span class="keyword">id</span>&lt;<span class="built_in">UIViewControllerTransitionCoordinatorContext</span>&gt;</div><div class="line">                                      context) &#123;</div><div class="line">             <span class="comment">//æ¸å…¥åŠ¨ç”»</span></div><div class="line">             [[<span class="keyword">self</span> dimmingView] setAlpha:<span class="number">1.0</span>];</div><div class="line">         &#125; completion:<span class="literal">nil</span>];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span> &#123;</div><div class="line">        [[<span class="keyword">self</span> dimmingView] setAlpha:<span class="number">1.0</span>];</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>è¿è¡Œæµ‹è¯•<br>ç‚¹å‡»å±å¹•å, ä¼šå¼¹å‡ºå¦‚ä¸‹ç•Œé¢, å¯ä»¥çœ‹åˆ°åœ¨å¼¹å‡ºçš„é»„è‰²æ¨¡æ€æ§åˆ¶å™¨å, æœ‰ä¸€ä¸ªæš—è‰²çš„èƒŒæ™¯ç”±æµ…å…¥æ·±åšäº†åŠ¨ç”»<br><img src="http://d.pr/i/Y6cs+" alt="æµ‹è¯•"></p>
</blockquote>
<h4 id="å¼¹å‡ºæ¨¡æ€å®Œæˆåçš„æ“ä½œ"><a href="#å¼¹å‡ºæ¨¡æ€å®Œæˆåçš„æ“ä½œ" class="headerlink" title="å¼¹å‡ºæ¨¡æ€å®Œæˆåçš„æ“ä½œ"></a>å¼¹å‡ºæ¨¡æ€å®Œæˆåçš„æ“ä½œ</h4><ul>
<li>æ–‡æ¡£æè¿°å¦‚ä¸‹(è‡ªå·±ç¿»è¯‘çš„, äº›è®¸ä¸å‡†, è¯·æŒ‡æ­£ğŸ˜Š)</li>
</ul>
<blockquote>
<ul>
<li>å¦‚æœç”¨æˆ·åœ¨è·³è½¬è¿‡ç¨‹ä¸­å–æ¶ˆäº†è·³è½¬æ“ä½œ(ä¹Ÿå°±æ˜¯è·³è½¬æœªå®Œæˆ), é‚£ä¹ˆç¨‹åºå‘˜å¯ä»¥åœ¨<code>presentation</code>è¿‡ç¨‹çš„æœ€å, ä½¿ç”¨<code>presentationTransitionDidEnd:</code>æ–¹æ³•å¤„ç†ä¸€äº›ç”±äºå–æ¶ˆæ“ä½œå¯¼è‡´çš„å¿…è¦çš„æ¸…ç†å·¥ä½œ</li>
<li>å¦‚æœä¸€äº›æ‰€éœ€çš„é—¨æ§›æ¡ä»¶æ²¡æœ‰æ»¡è¶³çš„è¯, é‚£ä¹ˆäº¤äº’å¼åŠ¨ç”»å¯¹è±¡å¯èƒ½ä¼šå–æ¶ˆè·³è½¬è¿‡ç¨‹, æ­¤æ—¶<code>presentationTransitionDidEnd:</code>æ–¹æ³•ä¸­çš„<code>completed</code>å‚æ•°ä¼šè¢«è®¾ç½®ä¸º<code>NO</code></li>
<li>ä¸€æ—¦è·³è½¬è¢«å–æ¶ˆ, é‚£ä¹ˆç¨‹åºå‘˜éœ€è¦ç§»é™¤æ‰€æœ‰åœ¨è·³è½¬è¿‡ç¨‹ä¸€å¼€å§‹è¢«æ·»åŠ çš„è‡ªå®šä¹‰view, (å¹¶ä¸”è¿”å›ä¹‹å‰é…ç½®çš„<code>View</code> &lt;â€“ è¿™ä¸€æ­¥åº”è¯¥ä¸æ˜¯å¿…é¡»çš„)</li>
</ul>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)presentationTransitionDidEnd:(<span class="built_in">BOOL</span>)completed &#123;</div><div class="line">    <span class="comment">//å¦‚æœè·³è½¬è¿‡ç¨‹è¢«å–æ¶ˆ, åˆ™å°†æš—è‰²è§†å›¾ç§»é™¤</span></div><div class="line">    <span class="keyword">if</span> (!completed)</div><div class="line">        [<span class="keyword">self</span>.dimmingView removeFromSuperview];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><br><br></p>
<ul>
<li>è¿™ç¯‡æ–‡ç« å·²ç»å®ç°äº†å¦‚ä½•å¼¹å‡ºä¸€ä¸ªè‡ªå®šä¹‰<code>frame</code>çš„æ¨¡æ€æ§åˆ¶å™¨, å¹¶åœ¨å…¶è·³è½¬è¿‡ç¨‹ä¸­å®ç°ä¸€äº›è‡ªå®šä¹‰çš„<code>view</code>å’ŒåŠ¨ç”»æ•ˆæœ</li>
<li>ä¸‹ä¸€ç¯‡æ–‡ç« , æˆ‘å°†å†æŠŠæ–‡æ¡£ä¸­å¦‚ä½•<code>dismiss</code>æ‰è¿™ä¸ªæ§åˆ¶å™¨çš„æ–¹æ³•è¿›è¡Œä¸€ç³»åˆ—å®ç°</li>
</ul>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[iOSå¤šçº¿ç¨‹æŠ€æœ¯çš„å‡ ç§å®ç°æ–¹æ¡ˆ(ä¸€) pthread]]></title>
      <url>http://yoursite.com/2016/08/05/iOS%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%8A%80%E6%9C%AF%E7%9A%84%E5%87%A0%E7%A7%8D%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%A1%88(%E4%B8%80)%20pthread/</url>
      <content type="html"><![CDATA[<h2 id="iOSä¸­å¤šçº¿ç¨‹çš„å®ç°æ–¹æ¡ˆ"><a href="#iOSä¸­å¤šçº¿ç¨‹çš„å®ç°æ–¹æ¡ˆ" class="headerlink" title="iOSä¸­å¤šçº¿ç¨‹çš„å®ç°æ–¹æ¡ˆ"></a>iOSä¸­å¤šçº¿ç¨‹çš„å®ç°æ–¹æ¡ˆ</h2><table>
<thead>
<tr>
<th>æ–¹æ¡ˆ</th>
<th style="text-align:left">ç®€ä»‹</th>
<th style="text-align:center">è¯­è¨€</th>
<th style="text-align:center">çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸ</th>
<th style="text-align:right">ä½¿ç”¨é¢‘ç‡</th>
</tr>
</thead>
<tbody>
<tr>
<td>pthread</td>
<td style="text-align:left"><li>ä¸€å¥—é€šç”¨çš„å¤šçº¿ç¨‹API</li><li>é€‚ç”¨äº Unix / Linux / Windows ç­‰ç³»ç»Ÿ</li><li>è·¨å¹³å°\å¯ç§»æ¤</li><li>ä½¿ç”¨éš¾åº¦å¤§</li></td>
<td style="text-align:center">C</td>
<td style="text-align:center">ç¨‹åºå‘˜ç®¡ç†</td>
<td style="text-align:right">å‡ ä¹ä¸ç”¨</td>
</tr>
<tr>
<td>NSThread</td>
<td style="text-align:left"><li>ä½¿ç”¨æ›´åŠ é¢å‘å¯¹è±¡</li><li>ç®€å•æ˜“ç”¨ï¼Œå¯ç›´æ¥æ“ä½œçº¿ç¨‹å¯¹è±¡</li></td>
<td style="text-align:center">OC</td>
<td style="text-align:center">ç¨‹åºå‘˜ç®¡ç†</td>
<td style="text-align:right">å¶å°”ä½¿ç”¨</td>
</tr>
<tr>
<td>GCD</td>
<td style="text-align:left"><li>æ—¨åœ¨æ›¿ä»£NSThreadç­‰çº¿ç¨‹æŠ€æœ¯</li><li>å……åˆ†åˆ©ç”¨è®¾å¤‡çš„å¤šæ ¸</li></td>
<td style="text-align:center">C</td>
<td style="text-align:center">è‡ªåŠ¨ç®¡ç†</td>
<td style="text-align:right">ç»å¸¸ä½¿ç”¨</td>
</tr>
<tr>
<td>NSOperation</td>
<td style="text-align:left"><li>åŸºäºGCDï¼ˆåº•å±‚æ˜¯GCDï¼‰</li><li>æ¯”GCDå¤šäº†ä¸€äº›æ›´ç®€å•å®ç”¨çš„åŠŸèƒ½</li><li>ä½¿ç”¨æ›´åŠ é¢å‘å¯¹è±¡</li></td>
<td style="text-align:center">OC</td>
<td style="text-align:center">è‡ªåŠ¨ç®¡ç†</td>
<td style="text-align:right">ç»å¸¸ä½¿ç”¨</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>æ’æ’­ä¸€æ®µç¢ç¢å¿µ</strong></p>
<ul>
<li><p>ä½œä¸ºmarkdownè¯­æ³•, ç”Ÿæˆè¡¨æ ¼ä¸€ç›´æ˜¯æ¯”è¾ƒè›‹ç–¼çš„äº‹æƒ…, æ²¡åŠæ³•æ¢è¡Œ, æ›´åˆ«ææ˜¯ä½¿ç”¨æ— åºæˆ–è€…æœ‰åºåˆ—è¡¨äº†, ä¸è¿‡å¥½æ­¹markdownè¿˜ä¿ç•™äº†HTMLæœ€åŸºæœ¬çš„ç”¨æ³•, èƒ½å¤Ÿä¾›æˆ‘ä»¬è°ƒç”¨</p>
</li>
<li><p>é‚£ä¹ˆæƒ³è¦åœ¨è¡¨æ ¼ä¸­ç®€å•çš„æ¢è¡Œæ€ä¹ˆåšå‘¢? å¾ˆç®€å•, åªéœ€è¦å°†è¡¨æ ¼ä¸­æƒ³è¦æ¢è¡Œçš„æ®µè½å‰é¢åŠ ä¸Š<code>&lt;br&gt;</code>, åé¢åŠ ä¸Š<code>&lt;/br&gt;</code>å³å¯</p>
</li>
<li>è€Œæƒ³è¦æ’å…¥æœ‰åºåˆ—è¡¨, åªéœ€è¦åœ¨è¡¨æ ¼ä¸­æƒ³è¦æ¢è¡Œçš„çš„æ®µè½å‰é¢åŠ ä¸Š<code>&lt;li&gt;</code>, åé¢åŠ ä¸Š<code>&lt;/li&gt;</code>å³å¯</li>
</ul>
</blockquote>
<h2 id="pthread"><a href="#pthread" class="headerlink" title="pthread"></a>pthread</h2><ul>
<li><code>pthread</code>æ˜¯<code>POSIX</code>å¤šçº¿ç¨‹å¼€å‘æ¡†æ¶, ç”±äºæ˜¯è·¨å¹³å°çš„Cè¯­è¨€æ¡†æ¶, åœ¨è‹¹æœçš„å¤´æ–‡ä»¶ä¸­å¹¶æ²¡æœ‰è¯¦ç»†çš„æ³¨é‡Š</li>
<li>è¦æŸ¥é˜…<code>pthread</code>çš„æœ‰å…³èµ„æ–™, åªèƒ½è‡ªè¡Œåœ¨ç½‘ç»œä¸Šæœç´¢</li>
</ul>
<h3 id="å¯¼å…¥å¤´æ–‡ä»¶"><a href="#å¯¼å…¥å¤´æ–‡ä»¶" class="headerlink" title="å¯¼å…¥å¤´æ–‡ä»¶"></a>å¯¼å…¥å¤´æ–‡ä»¶</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#import <span class="meta-string">&lt;pthread.h&gt;</span></span></div></pre></td></tr></table></figure>
<h3 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</div><div class="line">    [<span class="keyword">super</span> viewDidLoad];</div><div class="line">    <span class="comment">//è¾“å‡ºå½“å‰çº¿ç¨‹</span></div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"main, %@"</span>, [<span class="built_in">NSThread</span> currentThread]);</div><div class="line">    </div><div class="line">    <span class="comment">//çº¿ç¨‹æ ‡è¯†ç¬¦, å¯ä»¥ä¸ºç©º</span></div><div class="line">    pthread_t thread = <span class="literal">NULL</span>;</div><div class="line">    <span class="comment">//å­çº¿ç¨‹æ‰§è¡Œå‡½æ•°æ—¶éœ€è¦ä¼ å…¥çš„å‚æ•°</span></div><div class="line">    <span class="built_in">NSString</span> *str = <span class="string">@"argu"</span>;</div><div class="line">    </div><div class="line">    <span class="comment">/**</span></div><div class="line">     *  ä½¿ç”¨pthreadåˆ›å»ºå­çº¿ç¨‹</div><div class="line">     *</div><div class="line">     *  @param thread æŒ‡å‘çº¿ç¨‹æ ‡è¯†ç¬¦çš„æŒ‡é’ˆ</div><div class="line">     *  @param NULL   è®¾ç½®çº¿ç¨‹å±æ€§çš„å‚æ•°, å¯ä»¥ä¸ºç©º</div><div class="line">     *  @param demo   å­çº¿ç¨‹å‡†å¤‡æ‰§è¡Œçš„å‡½æ•°</div><div class="line">     *  @param void   å‡†å¤‡æ‰§è¡Œçš„å‡½æ•°æ‰€éœ€è¦çš„å‚æ•°</div><div class="line">     *</div><div class="line">     *  @return è¿”å›å€¼ä¸º0ä»£è¡¨åˆ›å»ºæˆåŠŸ, å¦‚é”™è¯¯ä¼šæ˜¾ç¤ºé”™è¯¯ç </div><div class="line">     */</div><div class="line">    <span class="keyword">int</span> result = pthread_create(&amp;thread, <span class="literal">NULL</span>, demo, (__bridge <span class="keyword">void</span> *)(str));</div><div class="line">    </div><div class="line">    <span class="comment">//åˆ¤æ–­æ˜¯å¦åˆ›å»ºæˆåŠŸ</span></div><div class="line">    <span class="keyword">if</span> (result == <span class="number">0</span>) &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"success"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span> &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"failed"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> *  å‡†å¤‡åœ¨å­çº¿ç¨‹ä¸­æ‰§è¡Œçš„å‡½æ•°</div><div class="line"> */</div><div class="line"><span class="keyword">void</span> *demo(<span class="keyword">void</span> *params) &#123;</div><div class="line">    <span class="comment">//æ‰“å°å½“å‰çº¿ç¨‹</span></div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"demo, %@"</span>, [<span class="built_in">NSThread</span> currentThread]);</div><div class="line">    <span class="comment">//å®šä¹‰å‡½æ•°çš„å‚æ•°ä¸º OC ä¸­çš„ NSString ç±»å‹</span></div><div class="line">    <span class="built_in">NSString</span> *str = (__bridge <span class="built_in">NSString</span> *)(params);</div><div class="line">    <span class="comment">//æ‰“å°å‚æ•°</span></div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"demo, str = %@"</span>, str);</div><div class="line">    <span class="comment">//è¿”å›</span></div><div class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><ol>
<li>åœ¨ C è¯­è¨€ä¸­, æ²¡æœ‰<code>å¯¹è±¡</code>çš„æ¦‚å¿µ, å¯¹è±¡æ˜¯é€šè¿‡<code>ç»“æ„ä½“</code>æ¥å®ç°çš„(å…¶å® Objective-C çš„åº•å±‚å®ç°ä¸­, å¯¹è±¡ä¹Ÿæ˜¯é€šè¿‡ C çš„ç»“æ„ä½“æ¥å®ç°)</li>
<li>é€šå¸¸, åœ¨ä½¿ç”¨ C è¯­è¨€çš„æ¡†æ¶ä¸­, å¯¹è±¡ç±»å‹ä¸€èˆ¬ä»¥<code>_t</code>/<code>Ref</code>ç»“å°¾, å£°æ˜æ—¶ä¸éœ€è¦ä½¿ç”¨<code>*</code></li>
<li><strong>C è¯­è¨€ä¸­çš„<code>void *</code>å’Œ Objective-C ä¸­çš„<code>id</code>ç±»å‹æ˜¯ç­‰ä»·çš„</strong></li>
<li>åœ¨æ··åˆå¼€å‘æ—¶, å¦‚æœåœ¨ C å’Œ Objective-C ä¹‹é—´ä¼ é€’æ•°æ®, éœ€è¦ä½¿ç”¨<code>__bridge</code>è¿›è¡Œæ¡¥æ¥, æ¡¥æ¥çš„ç›®çš„æ˜¯ä¸ºäº†å‘Šè¯‰ç¼–è¯‘å™¨å¦‚ä½•ç®¡ç†å†…å­˜</li>
</ol>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[æ¨¡æ‹ŸSDWebImageå¼‚æ­¥ä¸‹è½½å›¾ç‰‡æ“ä½œ(äº”) æŠ½å–SDWebImageåˆ†ç±»]]></title>
      <url>http://yoursite.com/2016/08/04/%E6%A8%A1%E6%8B%9FSDWebImage%E5%BC%82%E6%AD%A5%E4%B8%8B%E8%BD%BD%E5%9B%BE%E7%89%87%E6%93%8D%E4%BD%9C(%E4%BA%94)%20%E6%8A%BD%E5%8F%96SDWebImage%E5%88%86%E7%B1%BB/</url>
      <content type="html"><![CDATA[<h2 id="a-UIImageViewçš„åˆ†ç±»æ–¹æ³•"><a href="#a-UIImageViewçš„åˆ†ç±»æ–¹æ³•" class="headerlink" title="a. UIImageViewçš„åˆ†ç±»æ–¹æ³•"></a>a. UIImageViewçš„åˆ†ç±»æ–¹æ³•</h2><h3 id="ç›®æ ‡"><a href="#ç›®æ ‡" class="headerlink" title="ç›®æ ‡"></a>ç›®æ ‡</h3><ul>
<li>é€šè¿‡<code>åˆ†ç±»</code>æ–¹æ³•ç®€åŒ–Webå›¾åƒåŠ è½½</li>
<li>ä½¿ç”¨<code>runtime</code>ä¸­<code>å…³è”å¯¹è±¡</code>, å¯¹åˆ†ç±»ä¸­çš„å±æ€§è¿›è¡Œå…³è”</li>
</ul>
<h3 id="æ“ä½œæ­¥éª¤"><a href="#æ“ä½œæ­¥éª¤" class="headerlink" title="æ“ä½œæ­¥éª¤"></a>æ“ä½œæ­¥éª¤</h3><ul>
<li>æ–°å»º<code>UIImageView</code>çš„åˆ†ç±»<code>UIImageView+HMWebCache</code></li>
<li>å®šä¹‰åˆ†ç±»çš„å¯¹è±¡æ–¹æ³•</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">UIImageView</span> (<span class="title">HMWebCache</span>)</span></div><div class="line"></div><div class="line">-(<span class="keyword">void</span>)hm_setImageWithURLString:(<span class="built_in">NSString</span> *)URLString placeHolder:(<span class="built_in">UIImage</span> *)placeHolder;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<h4 id="åˆ†ç±»æ–¹æ³•çš„åˆæ­¥å®ç°"><a href="#åˆ†ç±»æ–¹æ³•çš„åˆæ­¥å®ç°" class="headerlink" title="åˆ†ç±»æ–¹æ³•çš„åˆæ­¥å®ç°"></a>åˆ†ç±»æ–¹æ³•çš„åˆæ­¥å®ç°</h4><ul>
<li>å¯¼å…¥ä¸‹è½½ç®¡ç†å™¨çš„å¤´æ–‡ä»¶</li>
</ul>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="selector-id">#import</span> <span class="string">"HMDownloadOperationManager.h"</span></div></pre></td></tr></table></figure>
<ul>
<li>å®ç°åˆ†ç±»æ–¹æ³•</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">-(<span class="keyword">void</span>)hm_setImageWithURLString:(<span class="built_in">NSString</span> *)URLString placeHolder:(<span class="built_in">UIImage</span> *)placeHolder&#123;</div><div class="line">    </div><div class="line">    <span class="keyword">self</span>.image = placeHolder;</div><div class="line">    </div><div class="line">    [[HMDownloadOperationManager sharedManager] downloadImageWithURLString:URLString completion:^(<span class="built_in">UIImage</span> *image) &#123;</div><div class="line">        <span class="keyword">self</span>.image = image;</div><div class="line">    &#125;];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="ä¿®æ”¹viewControllerçš„ä»£ç "><a href="#ä¿®æ”¹viewControllerçš„ä»£ç " class="headerlink" title="ä¿®æ”¹viewControllerçš„ä»£ç "></a>ä¿®æ”¹<code>viewController</code>çš„ä»£ç </h4><ul>
<li>å¯¼å…¥åˆ†ç±»çš„å¤´æ–‡ä»¶</li>
</ul>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="selector-id">#import</span> <span class="string">"UIImageView+HMWebCache.h"</span></div></pre></td></tr></table></figure>
<ul>
<li>ä¿®æ”¹æ•°æ®æºæ–¹æ³•</li>
</ul>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">-(UITableViewCell *)<span class="string">tableView:</span>(UITableView *)tableView <span class="string">cellForRowAtIndexPath:</span>(NSIndexPath *)indexPath&#123;</div><div class="line">    </div><div class="line">    HMAppCell *cell = [tableView <span class="string">dequeueReusableCellWithIdentifier:</span>cellID <span class="string">forIndexPath:</span>indexPath];</div><div class="line">    </div><div class="line">    HMAppInfo *info = self.app_infos[indexPath.row];</div><div class="line">    </div><div class="line">    cell.appName.text = info.name;</div><div class="line">    cell.downCount.text = info.download;</div><div class="line">    <span class="comment">//åœ¨è¿™é‡Œè®¾ç½®å ä½å›¾åƒ ç”¨æ¥è§£å†³å›¾åƒé—ªåŠ¨çš„é—®é¢˜</span></div><div class="line">    cell.iconView.image = [UIImage <span class="string">imageNamed:</span>@<span class="string">"user_default"</span>];</div><div class="line">    </div><div class="line">    [cell.iconView <span class="string">hm_setImageWithURLString:</span>info.icon <span class="string">placeHolder:</span>[UIImage <span class="string">imageNamed:</span>@<span class="string">"user_default"</span>]];</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> cell;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>è¿è¡Œæµ‹è¯•<br><img src="http://d.pr/i/1gBG2+" alt="æµ‹è¯•"></p>
<ul>
<li>å‘ç°å¿«é€Ÿæ»šåŠ¨çš„æ—¶å€™, cellä¸€æ—¦å¤ç”¨, ä¼šé‡å¤åˆ›å»ºä¸‹è½½æ“ä½œ, å¯¼è‡´å›¾ç‰‡é”™ä¹±</li>
<li>è§£å†³æ–¹æ¡ˆ: è®°å½•æ­¤å‰çš„<code>URLString</code>, å¦‚æœå½“å‰cellçš„<code>URLString</code>å‘ç”Ÿå˜åŒ–, åˆ™å–æ¶ˆä¹‹å‰çš„ä¸‹è½½æ“ä½œ</li>
</ul>
</blockquote>
<h4 id="è¿è¡Œæ—¶å…³è”å¯¹è±¡çš„ä½¿ç”¨"><a href="#è¿è¡Œæ—¶å…³è”å¯¹è±¡çš„ä½¿ç”¨" class="headerlink" title="è¿è¡Œæ—¶å…³è”å¯¹è±¡çš„ä½¿ç”¨"></a>è¿è¡Œæ—¶å…³è”å¯¹è±¡çš„ä½¿ç”¨</h4><ul>
<li>åœ¨åˆ†ç±»ä¸­å®šä¹‰<code>URLString</code>å±æ€§</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *URLString;</div></pre></td></tr></table></figure>
<ul>
<li>å¯¼å…¥å¤´æ–‡ä»¶</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#import <span class="meta-string">&lt;objc/runtime.h&gt;</span></span></div></pre></td></tr></table></figure>
<blockquote>
<p>æ­¤æ—¶ä¼šå¾—åˆ°ä»¥ä¸‹ä¸¤ä¸ªè­¦å‘Š, æç¤ºæˆ‘ä»¬å±æ€§<code>URLString</code>éœ€è¦è¿›è¡ŒåŠ¨æ€çš„ç»‘å®š</p>
<ul>
<li>Property â€˜URLStringâ€™ requires method â€˜URLStringâ€™ to be defined - use @dynamic or provide a method implementation in this category</li>
<li>Property â€˜URLStringâ€™ requires method â€˜setURLString:â€™ to be defined - use @dynamic or provide a method implementation in this category</li>
<li>å®šä¹‰å…³è”å¯¹è±¡å±æ€§çš„<code>key</code></li>
</ul>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> <span class="keyword">char</span> *URLStringKey = <span class="string">"kURLStringKey"</span>;</div></pre></td></tr></table></figure>
<ul>
<li>å®ç°å±æ€§çš„<code>getter</code>å’Œ<code>setter</code>æ–¹æ³•</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">-(<span class="built_in">NSString</span> *)URLString&#123;</div><div class="line">    <span class="keyword">return</span> objc_getAssociatedObject(<span class="keyword">self</span>, URLStringKey);</div><div class="line">&#125;</div><div class="line"></div><div class="line">-(<span class="keyword">void</span>)setURLString:(<span class="built_in">NSString</span> *)URLString&#123;</div><div class="line">    objc_setAssociatedObject(<span class="keyword">self</span>, URLStringKey, URLString, OBJC_ASSOCIATION_COPY_NONATOMIC);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>ä¿®æ”¹åˆ†ç±»ä¸­è®¾ç½®å›¾åƒçš„æ–¹æ³•</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">-(<span class="keyword">void</span>)hm_setImageWithURLString:(<span class="built_in">NSString</span> *)URLString placeHolder:(<span class="built_in">UIImage</span> *)placeHolder&#123;</div><div class="line">    <span class="comment">//å½“å‡†å¤‡ä¸‹è½½çš„å›¾åƒçš„urlä¸æ­¤å‰è¯¥cellä¸­å‡†å¤‡ä¸‹è½½çš„å›¾åƒurlä¸ç­‰, ä¸”è¯¥cellä¸­è‡³å°‘æœ‰ä¸€ä¸ªå›¾åƒæ­£åœ¨ä¸‹è½½æ—¶</span></div><div class="line">    <span class="comment">//å–æ¶ˆä¹‹å‰çš„ä¸‹è½½æ“ä½œ(å–æ¶ˆæ“ä½œå°†åœ¨åé¢å®ç°)</span></div><div class="line">    <span class="keyword">if</span> (![URLString isEqualToString:<span class="keyword">self</span>.URLString] &amp;&amp; <span class="keyword">self</span>.URLString != <span class="literal">nil</span>) &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"å–æ¶ˆä¹‹å‰çš„ä¸‹è½½æ“ä½œ"</span>);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">//ä½¿ç”¨æ–°çš„urlä¸‹è½½å›¾åƒ, å¹¶è®°å½•å½“å‰çš„url</span></div><div class="line">    <span class="keyword">self</span>.URLString = URLString;</div><div class="line">    </div><div class="line">    <span class="comment">//è®¾ç½®å ä½å›¾åƒ</span></div><div class="line">    <span class="keyword">self</span>.image = placeHolder;</div><div class="line">    </div><div class="line">    [[HMDownloadOperationManager sharedManager] downloadImageWithURLString:URLString completion:^(<span class="built_in">UIImage</span> *image) &#123;</div><div class="line">        <span class="comment">//ä¸‹è½½å®Œæˆåå›è°ƒæ—¶, å°†å½“å‰ä¸‹è½½æ“ä½œçš„urlç½®ç©º</span></div><div class="line">        <span class="comment">//(æ¸…é™¤å…³è”å±æ€§)</span></div><div class="line">        <span class="keyword">self</span>.URLString = <span class="literal">nil</span>;</div><div class="line">        <span class="comment">//è®¾ç½®ä¸‹è½½å¥½çš„å›¾ç‰‡</span></div><div class="line">        <span class="keyword">self</span>.image = image;</div><div class="line">    &#125;];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>ä¸‹ä¸€ç›®æ ‡: å–æ¶ˆæŒ‡å®š<code>URLString</code>çš„ä¸‹è½½æ“ä½œ</p>
</blockquote>
<h2 id="b-å–æ¶ˆæŒ‡å®š-URLString-çš„ä¸‹è½½æ“ä½œ"><a href="#b-å–æ¶ˆæŒ‡å®š-URLString-çš„ä¸‹è½½æ“ä½œ" class="headerlink" title="b. å–æ¶ˆæŒ‡å®š URLString çš„ä¸‹è½½æ“ä½œ"></a>b. å–æ¶ˆæŒ‡å®š URLString çš„ä¸‹è½½æ“ä½œ</h2><h3 id="ç›®æ ‡-1"><a href="#ç›®æ ‡-1" class="headerlink" title="ç›®æ ‡"></a>ç›®æ ‡</h3><ul>
<li>å–æ¶ˆæŒ‡å®šURLStringçš„ä¸‹è½½æ“ä½œ, ä»¥è§£å†³å›¾åƒå¤ç”¨çš„é—®é¢˜</li>
</ul>
<h3 id="æ“ä½œæ­¥éª¤-1"><a href="#æ“ä½œæ­¥éª¤-1" class="headerlink" title="æ“ä½œæ­¥éª¤"></a>æ“ä½œæ­¥éª¤</h3><ul>
<li>åœ¨<code>HMDownloadOperationManager.h</code>ä¸­å¢åŠ æ–¹æ³•å®šä¹‰</li>
</ul>
<figure class="highlight erlang"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">-<span class="params">(void)</span>cancelDownloadOperationWithURLString:<span class="params">(NSString *)</span>URLString;</div></pre></td></tr></table></figure>
<ul>
<li>å®ç°è¯¥æ–¹æ³•</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">-(<span class="keyword">void</span>)cancelDownloadOperationWithURLString:(<span class="built_in">NSString</span> *)URLString&#123;</div><div class="line">    <span class="comment">//ä»ç¼“å­˜ä¸­å–åˆ°ä¸‹è½½æ“ä½œ</span></div><div class="line">    HMDownloadOperation *operation = [<span class="keyword">self</span>.operationCacheDict objectForKey:URLString];</div><div class="line">    </div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"å‘ä¹‹å‰çš„ä¸‹è½½æ“ä½œå‘é€å–æ¶ˆä¸‹è½½çš„æ¶ˆæ¯:%@, %@"</span>, URLString, operation);</div><div class="line">    <span class="comment">//å‘é€å–æ¶ˆæ“ä½œçš„æ¶ˆæ¯</span></div><div class="line">    <span class="keyword">if</span> (operation != <span class="literal">nil</span>) &#123;</div><div class="line">        [operation cancel];</div><div class="line">        <span class="comment">//å°†æ“ä½œä»ç¼“å­˜ä¸­ç§»é™¤</span></div><div class="line">        [<span class="keyword">self</span>.operationCacheDict removeObjectForKey:URLString];</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>åœ¨<code>UIImageView</code>çš„åˆ†ç±»æ–¹æ³•ä¸­è°ƒç”¨æ–¹æ³•, å–æ¶ˆä¹‹å‰å·²æœ‰çš„ä¸‹è½½æ“ä½œ</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//å½“å‡†å¤‡ä¸‹è½½çš„å›¾åƒçš„urlä¸æ­¤å‰è¯¥cellä¸­å‡†å¤‡ä¸‹è½½çš„å›¾åƒurlä¸ç­‰, ä¸”è¯¥cellä¸­è‡³å°‘æœ‰ä¸€ä¸ªå›¾åƒæ­£åœ¨ä¸‹è½½æ—¶</span></div><div class="line"><span class="comment">//å–æ¶ˆä¹‹å‰çš„ä¸‹è½½æ“ä½œ(å–æ¶ˆæ“ä½œå°†åœ¨åé¢å®ç°)</span></div><div class="line"><span class="keyword">if</span> (![URLString isEqualToString:<span class="keyword">self</span>.URLString] &amp;&amp; <span class="keyword">self</span>.URLString != <span class="literal">nil</span>) &#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"å–æ¶ˆä¹‹å‰çš„ä¸‹è½½æ“ä½œ"</span>);</div><div class="line">    <span class="comment">//è¿›è¡Œå–æ¶ˆæ“ä½œ</span></div><div class="line">    [[HMDownloadOperationManager sharedManager] cancelDownloadOperationWithURLString:<span class="keyword">self</span>.URLString];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>è¿è¡Œæµ‹è¯•<br><img src="http://d.pr/i/1jpDm+" alt="æµ‹è¯•"><br>å¯ä»¥çœ‹åˆ°å·²ç»æ¯”è¾ƒå¥½çš„è§£å†³äº†å›¾åƒé‡å¤ä¸‹è½½çš„é—®é¢˜, å½“æ»‘åŠ¨æ—¶, æœªä¸‹è½½å›¾åƒçš„cellä¼šå…ˆå–æ¶ˆä¹‹å‰çš„ä¸‹è½½æ“ä½œ, é‡æ–°ä¸‹è½½å½“å‰å›¾åƒ</p>
</blockquote>
<h2 id="c-å†…å­˜è­¦å‘Šå¤„ç†"><a href="#c-å†…å­˜è­¦å‘Šå¤„ç†" class="headerlink" title="c. å†…å­˜è­¦å‘Šå¤„ç†"></a>c. å†…å­˜è­¦å‘Šå¤„ç†</h2><h3 id="ç›®æ ‡-2"><a href="#ç›®æ ‡-2" class="headerlink" title="ç›®æ ‡"></a>ç›®æ ‡</h3><ul>
<li>å­¦ä¹ <code>SDWebImage</code>çš„å†…å­˜è­¦å‘Šæ–¹æ³•, å¤„ç†å†…å­˜è­¦å‘Š</li>
</ul>
<h3 id="æ“ä½œæ­¥éª¤-2"><a href="#æ“ä½œæ­¥éª¤-2" class="headerlink" title="æ“ä½œæ­¥éª¤"></a>æ“ä½œæ­¥éª¤</h3><ul>
<li>åœ¨<code>HMDownloadOperationManager</code>çš„<code>init</code>æ–¹æ³•ä¸­æ³¨å†Œå†…å­˜è­¦å‘Šé€šçŸ¥</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">-(<span class="keyword">instancetype</span>)init</div><div class="line">&#123;</div><div class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> init];</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>) &#123;</div><div class="line">        _downloadQueque = [[<span class="built_in">NSOperationQueue</span> alloc] init];</div><div class="line">        _imageCacheDict = [<span class="built_in">NSMutableDictionary</span> dictionary];</div><div class="line">        _operationCacheDict = [<span class="built_in">NSMutableDictionary</span> dictionary];</div><div class="line">        </div><div class="line">        <span class="comment">//æ³¨å†Œå†…å­˜è­¦å‘Šé€šçŸ¥</span></div><div class="line">        [[<span class="built_in">NSNotificationCenter</span> defaultCenter] addObserver:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(memoryWarning) name:<span class="built_in">UIApplicationDidReceiveMemoryWarningNotification</span> object:<span class="literal">nil</span>];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//ä¸‹è½½ç®¡ç†å™¨é”€æ¯æ—¶, æ³¨é”€é€šçŸ¥ä¸­å¿ƒ</span></div><div class="line">-(<span class="keyword">void</span>)dealloc&#123;</div><div class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] removeObserver:<span class="keyword">self</span>];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>å®ç°å†…å­˜è­¦å‘Šæ–¹æ³•</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">-(<span class="keyword">void</span>)memoryWarning &#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"memory warning received!"</span>);</div><div class="line">    </div><div class="line">    [<span class="keyword">self</span>.imageCacheDict removeAllObjects];</div><div class="line">    [<span class="keyword">self</span>.operationCacheDict removeAllObjects];</div><div class="line">    </div><div class="line">    [<span class="keyword">self</span>.downloadQueque cancelAllOperations];</div><div class="line">&#125;</div></pre></td></tr></table></figure>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[æ¨¡æ‹ŸSDWebImageå¼‚æ­¥ä¸‹è½½å›¾ç‰‡æ“ä½œ(å››) ä»¿SDWebImageçš„æ“ä½œ]]></title>
      <url>http://yoursite.com/2016/08/03/%E6%A8%A1%E6%8B%9FSDWebImage%E5%BC%82%E6%AD%A5%E4%B8%8B%E8%BD%BD%E5%9B%BE%E7%89%87%E6%93%8D%E4%BD%9C(%E5%9B%9B)%20%E4%BB%BFSDWebImage%E7%9A%84%E6%93%8D%E4%BD%9C/</url>
      <content type="html"><![CDATA[<h2 id="ç›®æ ‡"><a href="#ç›®æ ‡" class="headerlink" title="ç›®æ ‡"></a>ç›®æ ‡</h2><ul>
<li>åœ¨ä¸Šä¸€é˜¶æ®µ<code>å¼‚æ­¥åŠ è½½ç½‘ç»œå›¾åƒ</code>çš„åŸºç¡€ä¸Šæ¨¡æ‹Ÿ<code>SDWebImage</code>çš„å®ç°</li>
<li>æ·±å…¥ç†è§£å¼‚æ­¥åŠ è½½ç½‘ç»œå›¾åƒçš„æµç¨‹</li>
<li>æŒæ¡<code>runtime</code>å…³è”å¯¹è±¡çš„ä½¿ç”¨å’Œåº”ç”¨åœºæ™¯</li>
</ul>
<h2 id="æ¶æ„è®¾è®¡"><a href="#æ¶æ„è®¾è®¡" class="headerlink" title="æ¶æ„è®¾è®¡"></a>æ¶æ„è®¾è®¡</h2><p><img src="http://d.pr/i/vcEz+" alt="æ¶æ„è®¾è®¡"></p>
<h3 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h3><h4 id="å®ç°ä¸‹è½½ç®¡ç†å™¨å•ä¾‹"><a href="#å®ç°ä¸‹è½½ç®¡ç†å™¨å•ä¾‹" class="headerlink" title="å®ç°ä¸‹è½½ç®¡ç†å™¨å•ä¾‹"></a>å®ç°ä¸‹è½½ç®¡ç†å™¨å•ä¾‹</h4><ul>
<li>æ–°å»ºä¸‹è½½ç®¡ç†å™¨å•ä¾‹</li>
<li>å°†<code>viewController</code>ä¸­æœ‰å…³<code>å›¾åƒç¼“å­˜</code>/<code>ä¸‹è½½æ“ä½œ</code>é€»è¾‘åˆ¤æ–­çš„ä»£ç ç›´æ¥ç§»æ¤åˆ°ä¸‹è½½ç®¡ç†å™¨ä¸­<h4 id="å®ç°å›¾åƒä¸‹è½½æ“ä½œ"><a href="#å®ç°å›¾åƒä¸‹è½½æ“ä½œ" class="headerlink" title="å®ç°å›¾åƒä¸‹è½½æ“ä½œ"></a>å®ç°å›¾åƒä¸‹è½½æ“ä½œ</h4></li>
<li>å°†æ§åˆ¶å™¨ä¸­çš„æœ‰å…³<code>å›¾åƒä¸‹è½½</code>çš„é€»è¾‘ç§»æ¤åˆ°ä¸‹è½½æ“ä½œä¸­, å¹¶è®¾ç½®æ¥å£, ä½¿å¾—ç®¡ç†å™¨èƒ½å¤Ÿç›´æ¥è°ƒç”¨</li>
</ul>
<blockquote>
<p>å¾…å›¾åƒä¸‹è½½å·¥ä½œå®Œæˆå, å¯¼å…¥<code>UIImageView</code>åˆ†ç±»æ–¹æ³•, åˆ©ç”¨è¿è¡Œæ—¶çš„å…³è”å¯¹è±¡è§£å†³å›¾åƒå¤ç”¨é—®é¢˜</p>
</blockquote>
<h2 id="a-å®ç°ä¸‹è½½ç®¡ç†å™¨"><a href="#a-å®ç°ä¸‹è½½ç®¡ç†å™¨" class="headerlink" title="a. å®ç°ä¸‹è½½ç®¡ç†å™¨"></a>a. å®ç°ä¸‹è½½ç®¡ç†å™¨</h2><h3 id="ç›®æ ‡-1"><a href="#ç›®æ ‡-1" class="headerlink" title="ç›®æ ‡"></a>ç›®æ ‡</h3><ul>
<li>å®ç°æ‰€æœ‰çš„å›¾åƒå¼‚æ­¥ä¸‹è½½ç®¡ç†</li>
</ul>
<h3 id="æ“ä½œæ­¥éª¤"><a href="#æ“ä½œæ­¥éª¤" class="headerlink" title="æ“ä½œæ­¥éª¤"></a>æ“ä½œæ­¥éª¤</h3><ul>
<li>æ–°å»ºä¸‹è½½ç®¡ç†å™¨ç»§æ‰¿è‡ª<code>NSObject</code></li>
<li>å®šä¹‰æ¥å£</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></div><div class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">HMDownloadOperationManager</span> : <span class="title">NSObject</span></span></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> *  ä¸‹è½½ç®¡ç†å™¨å•ä¾‹çš„å…¨å±€è®¿é—®ç‚¹</div><div class="line"> *</div><div class="line"> *  @return ä¸‹è½½ç®¡ç†å™¨å•ä¾‹</div><div class="line"> */</div><div class="line">+(<span class="keyword">instancetype</span>)sharedManager;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> *  é€šè¿‡URLä¸‹è½½å›¾åƒçš„å¯¹è±¡æ–¹æ³•</div><div class="line"> *</div><div class="line"> *  @param URLString  è¦ä¸‹è½½å›¾åƒçš„URL</div><div class="line"> *  @param completion ä¸‹è½½å®Œæˆæ—¶çš„å›è°ƒ</div><div class="line"> */</div><div class="line">-(<span class="keyword">void</span>)downloadImageWithURLString:(<span class="built_in">NSString</span> *)URLString completion:(<span class="keyword">void</span>(^)(<span class="built_in">UIImage</span> *))completion;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<h4 id="å®ç°å•ä¾‹æ–¹æ³•"><a href="#å®ç°å•ä¾‹æ–¹æ³•" class="headerlink" title="å®ç°å•ä¾‹æ–¹æ³•"></a>å®ç°å•ä¾‹æ–¹æ³•</h4><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">+(<span class="keyword">instancetype)sharedManager&#123;</span></div><div class="line">    static HMDownloadOperationManager *manager<span class="comment">;</span></div><div class="line">    </div><div class="line">    static <span class="keyword">dispatch_once_t </span>onceToken<span class="comment">;</span></div><div class="line">    <span class="keyword">dispatch_once(&amp;onceToken, </span>^&#123;</div><div class="line">        manager = [[HMDownloadOperationManager alloc] init]<span class="comment">;</span></div><div class="line">    &#125;)<span class="comment">;</span></div><div class="line">    </div><div class="line">    return manager<span class="comment">;</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>åœ¨ç±»å»¶å±•ä¸­å®šä¹‰ç›¸å…³æˆå‘˜å˜é‡</li>
</ul>
<figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="variable">@interface</span> HMDownloadOperationManager ()</div><div class="line"></div><div class="line"><span class="variable">@property</span> (nonatomic, strong) NSOperationQueue *downloadQueque;</div><div class="line"><span class="variable">@property</span> (nonatomic, strong) NSMutableDictionary *imageCacheDict;</div><div class="line"><span class="variable">@property</span> (nonatomic, strong) NSMutableDictionary *operationCacheDict;</div><div class="line"></div><div class="line"><span class="variable">@end</span></div></pre></td></tr></table></figure>
<ul>
<li>å®ç°<code>init</code>æ–¹æ³•å®ä¾‹åŒ–ç›¸å…³æˆå‘˜å˜é‡</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">instancetype</span>)init</div><div class="line">&#123;</div><div class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> init];</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>) &#123;</div><div class="line">        _downloadQueque = [[<span class="built_in">NSOperationQueue</span> alloc] init];</div><div class="line">        _imageCacheDict = [<span class="built_in">NSMutableDictionary</span> dictionary];</div><div class="line">        _operationCacheDict = [<span class="built_in">NSMutableDictionary</span> dictionary];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="å®ç°ä¸‹è½½æ“ä½œä»£ç "><a href="#å®ç°ä¸‹è½½æ“ä½œä»£ç " class="headerlink" title="å®ç°ä¸‹è½½æ“ä½œä»£ç "></a>å®ç°ä¸‹è½½æ“ä½œä»£ç </h4><ul>
<li>ç¼“å­˜å›¾ç‰‡çš„æ—¶å€™, ç”±äºæ˜¯é‡‡ç”¨ä½¿ç”¨URLçš„<code>lastPathComponent</code>ä½œä¸ºç¼“å­˜å›¾ç‰‡çš„æ–‡ä»¶åè¿›è¡Œå­˜å‚¨çš„, å› æ­¤å½“å‰é¢çš„åœ°å€ä¸åŒ, è€Œ<code>lastPathComponent</code>ç›¸åŒæ—¶, å¯èƒ½é€ æˆç¼“å­˜æ··ä¹±, ä¾‹å¦‚:<blockquote>
<p>www.zhihu.com/123.png<br>www.baidu.com/123.png</p>
</blockquote>
</li>
<li>ä¸Šé¢ä¸¤ä¸ªæ–‡ä»¶ç¼“å­˜åä¼šå¯¼è‡´è¦†ç›–!!!</li>
<li>å› æ­¤è¦ä¿è¯æ¯ä¸€ä¸ªæ–‡ä»¶åœ¨ç¼“å­˜çš„æ—¶å€™éƒ½èƒ½å¾—åˆ°å”¯ä¸€çš„æ–‡ä»¶å</li>
<li>æ‰€ä»¥å°†ç¼“å­˜å›¾ç‰‡çš„urlè¿›è¡Œmd5æ“ä½œå, èƒ½å¤Ÿä½¿å¾—ç¼“å­˜æ•°æ®è·å¾—å”¯ä¸€æ€§</li>
<li>å¯¼å…¥<code>NSString+hash</code>åˆ†ç±», è¯¥ç±»ä¸­çš„æ–¹æ³•å¯ä»¥è¿›è¡Œä¸€ç³»åˆ—çš„åŠ å¯†æ“ä½œ, æˆ‘ä»¬ä½¿ç”¨å…¶ä¸­çš„md5æ“ä½œ</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">-(<span class="built_in">NSString</span> *)filePathWithURLString:(<span class="built_in">NSString</span> *)URLString &#123;</div><div class="line">    <span class="comment">//è·å–æ²™ç›’ç¼“å­˜è·¯å¾„</span></div><div class="line">    <span class="built_in">NSString</span> *cachesPath = <span class="built_in">NSSearchPathForDirectoriesInDomains</span>(<span class="built_in">NSCachesDirectory</span>, <span class="built_in">NSUserDomainMask</span>, <span class="literal">YES</span>)[<span class="number">0</span>];</div><div class="line">    <span class="comment">//å°†URLè¿›è¡Œmd5æ“ä½œ</span></div><div class="line">    <span class="built_in">NSString</span> *md5_fileName = [URLString cz_md5String];</div><div class="line">    <span class="comment">//åˆæˆç¼“å­˜æ–‡ä»¶è·¯å¾„</span></div><div class="line">    <span class="built_in">NSString</span> *cacheFilePath = [cachesPath stringByAppendingPathComponent:md5_fileName];</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> cacheFilePath;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>å°†é€»è¾‘åˆ¤æ–­çš„ä»£ç å‰ªåˆ‡åˆ°<code>ä¸‹è½½ç®¡ç†å™¨</code>ä¸­</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">-(<span class="keyword">void</span>)downloadImageWithURLString:(<span class="built_in">NSString</span> *)URLString completion:(<span class="keyword">void</span> (^)(<span class="built_in">UIImage</span> *))completion&#123;</div><div class="line">    <span class="built_in">NSAssert</span>(completion != <span class="literal">nil</span>, <span class="string">@"å¿…é¡»ä¼ å…¥å®Œæˆå›è°ƒ"</span>);</div><div class="line">    </div><div class="line">    <span class="built_in">UIImage</span> *cacheImage = <span class="keyword">self</span>.imageCacheDict[URLString];</div><div class="line">    <span class="comment">//åˆ¤æ–­å›¾åƒæ˜¯å¦å·²ç»è¢«ç¼“å­˜</span></div><div class="line">    <span class="comment">//å¦‚æœç¼“å­˜ åˆ™ç›´æ¥å°†ç¼“å­˜ä¸­çš„å›¾åƒæ˜¾ç¤ºåœ¨iconViewä¸Š</span></div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.imageCacheDict[URLString] != <span class="literal">nil</span>) &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"å›¾åƒå·²ç»ä»å­—å…¸ç¼“å­˜ä¸­å–å‡º"</span>);</div><div class="line">        completion(cacheImage);</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">//è·å–æ²™ç›’è·¯å¾„</span></div><div class="line">    <span class="built_in">NSString</span> *cachePath = [<span class="keyword">self</span> filePathWithURLString:URLString];</div><div class="line">    <span class="comment">//åˆ¤æ–­æ²™ç›’ä¸­æ˜¯å¦å·²ç»ç¼“å­˜äº†å›¾ç‰‡</span></div><div class="line">    cacheImage = [<span class="built_in">UIImage</span> imageWithContentsOfFile:cachePath];</div><div class="line">    <span class="keyword">if</span> (cacheImage != <span class="literal">nil</span>) &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"å›¾åƒå·²ç»ä»æ²™ç›’ä¸­å–å‡º"</span>);</div><div class="line">        <span class="comment">//å¦‚æœç¼“å­˜äº†å›¾ç‰‡, åˆ™å‘å›¾åƒç¼“å­˜å­—å…¸ä¸­å­˜å‚¨ä¸€ä»½, å¹¶å°†å›¾åƒç›´æ¥æ˜¾ç¤ºåˆ°cellçš„iconViewä¸Š</span></div><div class="line">        [<span class="keyword">self</span>.imageCacheDict setObject:cacheImage forKey:URLString];</div><div class="line">        completion(cacheImage);</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">//åˆ¤æ–­æ“ä½œæ˜¯å¦å·²ç»åœ¨é˜Ÿåˆ—ä¸­, å¦‚æœæ“ä½œå·²ç»å­˜åœ¨, é‚£ä¹ˆç›´æ¥è¿”å›</span></div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.operationCacheDict[URLString] != <span class="literal">nil</span>) &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"downloading......"</span>);</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>è¿è¡Œæµ‹è¯•<br>æ­¤æ—¶ç¨‹åºæœ¬è´¨ä¸Šæ²¡æœ‰è¿›è¡Œä»»ä½•æ”¹åŠ¨, ç¨‹åºè¿è¡Œå’Œä¹‹å‰åº”è¯¥æ²¡æœ‰ä»»ä½•åŒºåˆ«<br>ä¸‹ä¸€ç›®æ ‡: è‡ªå®šä¹‰ä¸‹è½½æ“ä½œ</p>
</blockquote>
<h2 id="b-å®ç°ä¸‹è½½æ“ä½œ"><a href="#b-å®ç°ä¸‹è½½æ“ä½œ" class="headerlink" title="b. å®ç°ä¸‹è½½æ“ä½œ"></a>b. å®ç°ä¸‹è½½æ“ä½œ</h2><h3 id="ç›®æ ‡-2"><a href="#ç›®æ ‡-2" class="headerlink" title="ç›®æ ‡"></a>ç›®æ ‡</h3><ul>
<li>å®ç°ä¸‹è½½æ“ä½œ, å¤„ç†å•ç‹¬çš„æ–‡ä»¶ä¸‹è½½</li>
<li>ä½“ä¼š<code>isCancelled</code>å±æ€§çš„ä½¿ç”¨</li>
<li>æŒæ¡åœ¨è‡ªå®šä¹‰<code>operation</code>æ—¶, éœ€è¦:<ul>
<li>é‡å†™<code>main</code>æ–¹æ³•</li>
</ul>
</li>
</ul>
<h3 id="æ“ä½œæ­¥éª¤-1"><a href="#æ“ä½œæ­¥éª¤-1" class="headerlink" title="æ“ä½œæ­¥éª¤"></a>æ“ä½œæ­¥éª¤</h3><ul>
<li>æ–°å»ºä¸‹è½½æ“ä½œ<code>HMDownloadOperation</code>ç»§æ‰¿è‡ª<code>NSOperation</code></li>
<li>å®šä¹‰ç›¸å…³æ¥å£å¦‚ä¸‹</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></div><div class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">HMDownloadOperation</span> : <span class="title">NSOperation</span></span></div><div class="line"></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIImage</span> *downloadImage;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> *  ä¸‹è½½æ“ä½œ</div><div class="line"> *</div><div class="line"> *  @param URLString è¦ä¸‹è½½æ–‡ä»¶çš„URLè·¯å¾„</div><div class="line"> *  @param cachePath ç¼“å­˜æ–‡ä»¶çš„åœ°å€</div><div class="line"> *</div><div class="line"> *  @return åˆ›å»ºå¥½çš„ä¸‹è½½æ“ä½œ</div><div class="line"> */</div><div class="line">+(<span class="keyword">instancetype</span>)downloadOperationWithURLString:(<span class="built_in">NSString</span> *)URLString cachePath:(<span class="built_in">NSString</span> *)cachePath;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<h4 id="å®ç°ç±»æ–¹æ³•"><a href="#å®ç°ç±»æ–¹æ³•" class="headerlink" title="å®ç°ç±»æ–¹æ³•"></a>å®ç°ç±»æ–¹æ³•</h4><ul>
<li>åœ¨ç±»æ‰©å±•ä¸­å®šä¹‰å±æ€§</li>
</ul>
<figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="variable">@interface</span> HMDownloadOperation ()</div><div class="line"></div><div class="line"><span class="variable">@property</span> (nonatomic, copy) NSString *URLString;</div><div class="line"><span class="variable">@property</span> (nonatomic, copy) NSString *cachePath;</div><div class="line"></div><div class="line"><span class="variable">@end</span></div></pre></td></tr></table></figure>
<ul>
<li>å®ç°ç±»æ–¹æ³•, è®°å½•å±æ€§å€¼</li>
</ul>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">+(instance<span class="keyword">type</span>)downloadOperationWithURLString:(<span class="type">NSString</span> *)<span class="type">URLString</span> cachePath:(<span class="type">NSString</span> *)cachePath&#123;</div><div class="line">    <span class="type">HMDownloadOperation</span> *operation = [[<span class="type">HMDownloadOperation</span> alloc] init];</div><div class="line">    </div><div class="line">    operation.<span class="type">URLString</span> = <span class="type">URLString</span>;</div><div class="line">    operation.cachePath = cachePath;</div><div class="line">    </div><div class="line">    return operation;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="å®ç°mainæ–¹æ³•"><a href="#å®ç°mainæ–¹æ³•" class="headerlink" title="å®ç°mainæ–¹æ³•"></a>å®ç°<code>main</code>æ–¹æ³•</h4><blockquote>
<ul>
<li><code>main</code>æ–¹æ³•æ˜¯è‡ªå®šä¹‰æ“ä½œçš„å…¥å£æ–¹æ³•</li>
<li>æ·»åŠ æ“ä½œæ˜¯å¦è¢«å–æ¶ˆçš„åˆ¤æ–­</li>
</ul>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">-(<span class="keyword">void</span>)main&#123;</div><div class="line">    <span class="comment">//ç”Ÿæˆä¸‹è½½URL</span></div><div class="line">    <span class="built_in">NSURL</span> *url = [<span class="built_in">NSURL</span> URLWithString:<span class="keyword">self</span>.URLString];</div><div class="line">    </div><div class="line">    <span class="comment">//åˆ¤æ–­ä¸‹è½½é“¾æ¥æ˜¯å¦ç”ŸæˆæˆåŠŸ</span></div><div class="line">    <span class="keyword">if</span> (url == <span class="literal">nil</span>) &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"ä¸‹è½½åœ°å€é”™è¯¯"</span>);</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//åˆ¤æ–­æ“ä½œæ˜¯å¦å·²è¢«å–æ¶ˆ</span></div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.isCancelled) &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"ä¸‹è½½æ“ä½œè¢«å–æ¶ˆäº†!"</span>);</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//ä¸‹è½½</span></div><div class="line">    <span class="built_in">NSData</span> *data = [<span class="built_in">NSData</span> dataWithContentsOfURL:url];</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> (data != <span class="literal">nil</span>) &#123;</div><div class="line">        <span class="comment">//å°†æ•°æ®å†™å…¥æ²™ç›’ä¸­</span></div><div class="line">        [data writeToFile:<span class="keyword">self</span>.cachePath atomically:<span class="literal">YES</span>];</div><div class="line">        <span class="comment">//å°†äºŒè¿›åˆ¶æ•°æ®è½¬æ¢æˆå›¾åƒ</span></div><div class="line">        <span class="keyword">self</span>.downloadImage = [<span class="built_in">UIImage</span> imageWithData:data];</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="c-åœ¨ä¸‹è½½ç®¡ç†å™¨ä¸­å¢åŠ ä¸‹è½½æ“ä½œ"><a href="#c-åœ¨ä¸‹è½½ç®¡ç†å™¨ä¸­å¢åŠ ä¸‹è½½æ“ä½œ" class="headerlink" title="c. åœ¨ä¸‹è½½ç®¡ç†å™¨ä¸­å¢åŠ ä¸‹è½½æ“ä½œ"></a>c. åœ¨ä¸‹è½½ç®¡ç†å™¨ä¸­å¢åŠ ä¸‹è½½æ“ä½œ</h2><h3 id="ç›®æ ‡-3"><a href="#ç›®æ ‡-3" class="headerlink" title="ç›®æ ‡"></a>ç›®æ ‡</h3><ul>
<li>åœ¨ä¸‹è½½ç®¡ç†å™¨ä¸­å¢åŠ ä¸‹è½½æ“ä½œ</li>
<li>æµ‹è¯•ä¸‹è½½çš„æ²™ç›’ç¼“å­˜å’Œå†…å­˜ç¼“å­˜</li>
</ul>
<h3 id="æ“ä½œæ­¥éª¤-2"><a href="#æ“ä½œæ­¥éª¤-2" class="headerlink" title="æ“ä½œæ­¥éª¤"></a>æ“ä½œæ­¥éª¤</h3><ul>
<li>åœ¨<code>HMDownloadOperationManager</code>ä¸­å¯¼å…¥<code>HMDownloadOperation</code>çš„å¤´æ–‡ä»¶</li>
<li>åœ¨<code>HMDownloadOperationManager</code>ä¸­ç»§ç»­å®ç°<code>downloadImageWithURLString: completion:</code>æ–¹æ³•</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line">-(<span class="keyword">void</span>)downloadImageWithURLString:(<span class="built_in">NSString</span> *)URLString completion:(<span class="keyword">void</span> (^)(<span class="built_in">UIImage</span> *))completion&#123;</div><div class="line">    <span class="built_in">NSAssert</span>(completion != <span class="literal">nil</span>, <span class="string">@"å¿…é¡»ä¼ å…¥å®Œæˆå›è°ƒ"</span>);</div><div class="line">    </div><div class="line">    <span class="built_in">UIImage</span> *cacheImage = [<span class="keyword">self</span>.imageCacheDict objectForKey:URLString];</div><div class="line">    <span class="comment">//åˆ¤æ–­å›¾åƒæ˜¯å¦å·²ç»è¢«ç¼“å­˜</span></div><div class="line">    <span class="comment">//å¦‚æœç¼“å­˜ åˆ™ç›´æ¥å°†ç¼“å­˜ä¸­çš„å›¾åƒæ˜¾ç¤ºåœ¨iconViewä¸Š</span></div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.imageCacheDict[URLString] != <span class="literal">nil</span>) &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"å›¾åƒå·²ç»ä»å­—å…¸ç¼“å­˜ä¸­å–å‡º"</span>);</div><div class="line">        completion(cacheImage);</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">//è·å–æ²™ç›’è·¯å¾„</span></div><div class="line">    <span class="built_in">NSString</span> *cachePath = [<span class="keyword">self</span> filePathWithURLString:URLString];</div><div class="line">    <span class="comment">//åˆ¤æ–­æ²™ç›’ä¸­æ˜¯å¦å·²ç»ç¼“å­˜äº†å›¾ç‰‡</span></div><div class="line">    cacheImage = [<span class="built_in">UIImage</span> imageWithContentsOfFile:cachePath];</div><div class="line">    <span class="keyword">if</span> (cacheImage != <span class="literal">nil</span>) &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"å›¾åƒå·²ç»ä»æ²™ç›’ä¸­å–å‡º"</span>);</div><div class="line">        <span class="comment">//å¦‚æœç¼“å­˜äº†å›¾ç‰‡, åˆ™å‘å›¾åƒç¼“å­˜å­—å…¸ä¸­å­˜å‚¨ä¸€ä»½, å¹¶å°†å›¾åƒç›´æ¥æ˜¾ç¤ºåˆ°cellçš„iconViewä¸Š</span></div><div class="line">        [<span class="keyword">self</span>.imageCacheDict setObject:cacheImage forKey:URLString];</div><div class="line">        completion(cacheImage);</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">//åˆ¤æ–­æ“ä½œæ˜¯å¦å·²ç»åœ¨é˜Ÿåˆ—ä¸­, å¦‚æœæ“ä½œå·²ç»å­˜åœ¨, é‚£ä¹ˆç›´æ¥è¿”å›</span></div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.operationCacheDict[URLString] != <span class="literal">nil</span>) &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"downloading......"</span>);</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">//å®ä¾‹åŒ–ä¸‹è½½æ“ä½œ</span></div><div class="line">    HMDownloadOperation *operation = [HMDownloadOperation downloadOperationWithURLString:URLString cachePath:cachePath];</div><div class="line">    <span class="comment">//ç›‘å¬ä¸‹è½½å®Œæˆçš„æ“ä½œ</span></div><div class="line">    [operation setCompletionBlock:^&#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"ä¸‹è½½å·²å®Œæˆ %@"</span>, [<span class="built_in">NSThread</span> currentThread]);</div><div class="line">    &#125;];</div><div class="line">    <span class="comment">//å°†æ“ä½œåŠ å…¥ä¸‹è½½é˜Ÿåˆ—, å¹¶æ·»åŠ åˆ°æ“ä½œç¼“å­˜ä¸­</span></div><div class="line">    [<span class="keyword">self</span>.downloadQueque addOperation:operation];</div><div class="line">    [<span class="keyword">self</span>.operationCacheDict setObject:operation forKey:URLString];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="ä¿®æ”¹ViewControllerä»£ç "><a href="#ä¿®æ”¹ViewControllerä»£ç " class="headerlink" title="ä¿®æ”¹ViewControllerä»£ç "></a>ä¿®æ”¹<code>ViewController</code>ä»£ç </h4><h5 id="ä¿®æ”¹å‰çš„å‡†å¤‡"><a href="#ä¿®æ”¹å‰çš„å‡†å¤‡" class="headerlink" title="ä¿®æ”¹å‰çš„å‡†å¤‡"></a>ä¿®æ”¹å‰çš„å‡†å¤‡</h5><ul>
<li>åœ¨è§†å›¾æ§åˆ¶å™¨ä¸­, åˆ é™¤å’Œä¸‹è½½ç›¸å…³çš„å±æ€§</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSOperationQueue</span> *downloadQueque;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSMutableDictionary</span> *imageCacheDict;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSMutableDictionary</span> *operationCacheDict;</div></pre></td></tr></table></figure>
<ul>
<li>åˆ é™¤æ‡’åŠ è½½çš„ç›¸å…³ä»£ç </li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">-(<span class="built_in">NSOperationQueue</span> *)downloadQueque&#123;</div><div class="line">    <span class="keyword">if</span> (_downloadQueque == <span class="literal">nil</span>) &#123;</div><div class="line">        _downloadQueque = [[<span class="built_in">NSOperationQueue</span> alloc] init];</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> _downloadQueque;</div><div class="line">&#125;</div><div class="line"></div><div class="line">-(<span class="built_in">NSMutableDictionary</span> *)imageCacheDict&#123;</div><div class="line">    <span class="keyword">if</span> (_imageCacheDict == <span class="literal">nil</span>) &#123;</div><div class="line">        _imageCacheDict = [<span class="built_in">NSMutableDictionary</span> dictionary];</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> _imageCacheDict;</div><div class="line">&#125;</div><div class="line"></div><div class="line">-(<span class="built_in">NSMutableDictionary</span> *)operationCacheDict&#123;</div><div class="line">    <span class="keyword">if</span> (_operationCacheDict == <span class="literal">nil</span>) &#123;</div><div class="line">        _operationCacheDict = [<span class="built_in">NSMutableDictionary</span> dictionary];</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> _operationCacheDict;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>æ³¨é‡Šæ‰<code>didReceiveMemoryWarning</code>æ–¹æ³•</li>
</ul>
<figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">-</span>(void)<span class="selector-tag">didReceiveMemoryWarning</span>&#123;</div><div class="line">    <span class="selector-attr">[super didReceiveMemoryWarning]</span>;</div><div class="line">    <span class="comment">//ç§»é™¤ç¼“å­˜ä¸­çš„æ‰€æœ‰å¯¹è±¡</span></div><div class="line">    <span class="selector-attr">[self.imageCacheDict removeAllObjects]</span>;</div><div class="line">    <span class="selector-attr">[self.operationCacheDict removeAllObjects]</span>;</div><div class="line">    <span class="comment">//å–æ¶ˆé˜Ÿåˆ—ä¸­çš„æ‰€æœ‰æ“ä½œ</span></div><div class="line">    <span class="selector-attr">[self.downloadQueque cancelAllOperations]</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="ä½¿ç”¨ä¸‹è½½æ“ä½œç®¡ç†å™¨ä¸‹è½½å›¾åƒ"><a href="#ä½¿ç”¨ä¸‹è½½æ“ä½œç®¡ç†å™¨ä¸‹è½½å›¾åƒ" class="headerlink" title="ä½¿ç”¨ä¸‹è½½æ“ä½œç®¡ç†å™¨ä¸‹è½½å›¾åƒ"></a>ä½¿ç”¨ä¸‹è½½æ“ä½œç®¡ç†å™¨ä¸‹è½½å›¾åƒ</h5><ul>
<li>å¯¼å…¥å¤´æ–‡ä»¶</li>
</ul>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="selector-id">#import</span> <span class="string">"HMDownloadOperationManager.h"</span></div></pre></td></tr></table></figure>
<ul>
<li>ä¿®æ”¹æ•°æ®æºæ–¹æ³•</li>
</ul>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">-(UITableViewCell *)<span class="string">tableView:</span>(UITableView *)tableView <span class="string">cellForRowAtIndexPath:</span>(NSIndexPath *)indexPath&#123;</div><div class="line">    </div><div class="line">    HMAppCell *cell = [tableView <span class="string">dequeueReusableCellWithIdentifier:</span>cellID <span class="string">forIndexPath:</span>indexPath];</div><div class="line">    </div><div class="line">    HMAppInfo *info = self.app_infos[indexPath.row];</div><div class="line">    </div><div class="line">    cell.appName.text = info.name;</div><div class="line">    cell.downCount.text = info.download;</div><div class="line">    <span class="comment">//åœ¨è¿™é‡Œè®¾ç½®å ä½å›¾åƒ ç”¨æ¥è§£å†³å›¾åƒé—ªåŠ¨çš„é—®é¢˜</span></div><div class="line">    cell.iconView.image = [UIImage <span class="string">imageNamed:</span>@<span class="string">"user_default"</span>];</div><div class="line">    </div><div class="line">    HMDownloadOperationManager *manager = [HMDownloadOperationManager sharedManager];</div><div class="line">    </div><div class="line">    [manager <span class="string">downloadImageWithURLString:</span>info.icon <span class="string">completion:</span>^(UIImage *image) &#123;</div><div class="line">        cell.iconView.image = image;</div><div class="line">    &#125;];</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> cell;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="ä¸‹è½½å®Œæˆåå®Œæˆå›è°ƒ"><a href="#ä¸‹è½½å®Œæˆåå®Œæˆå›è°ƒ" class="headerlink" title="ä¸‹è½½å®Œæˆåå®Œæˆå›è°ƒ"></a>ä¸‹è½½å®Œæˆåå®Œæˆå›è°ƒ</h5><ul>
<li>åœ¨ä¸‹è½½ç®¡ç†ä¸­å®ç°<code>setCompletionBlock</code>çš„ä»£ç </li>
</ul>
<figure class="highlight scheme"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[<span class="name">operation</span> setCompletionBlock:^&#123;</div><div class="line">    NSLog(<span class="name">@</span><span class="string">"ä¸‹è½½å·²å®Œæˆ %@"</span>, [<span class="name">NSThread</span> currentThread])<span class="comment">;</span></div><div class="line">    </div><div class="line">    //ä¸»çº¿ç¨‹å›è°ƒ</div><div class="line">    [[<span class="name">NSOperationQueue</span> mainQueue] addOperationWithBlock:^&#123;</div><div class="line">        completion(<span class="name">operation.downloadImage</span>)<span class="comment">;</span></div><div class="line">    &#125;]<span class="comment">;</span></div><div class="line">&#125;]<span class="comment">;</span></div></pre></td></tr></table></figure>
<blockquote>
<p>ç³»ç»Ÿä¼šæç¤ºå¾ªç¯å¼•ç”¨äº†! å› ä¸ºåœ¨<code>operation</code>çš„<code>completionBlock</code>ä¸­ä½¿ç”¨äº†<code>operation</code>è‡ªèº«</p>
</blockquote>
<ul>
<li>ä½¿ç”¨<code>__weak</code>è§£å†³å¾ªç¯å¼•ç”¨çš„é—®é¢˜, å¹¶å®Œå–„ä»£ç </li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//å®ä¾‹åŒ–ä¸‹è½½æ“ä½œ</span></div><div class="line">HMDownloadOperation *operation = [HMDownloadOperation downloadOperationWithURLString:URLString cachePath:cachePath];</div><div class="line"></div><div class="line">__<span class="keyword">weak</span> HMDownloadOperation *weakSelf = operation;</div><div class="line"></div><div class="line"><span class="comment">//ç›‘å¬ä¸‹è½½å®Œæˆçš„æ“ä½œ</span></div><div class="line">[operation setCompletionBlock:^&#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"ä¸‹è½½å·²å®Œæˆ %@"</span>, [<span class="built_in">NSThread</span> currentThread]);</div><div class="line">    <span class="comment">//è·å–ä¸‹è½½å¥½çš„å›¾ç‰‡</span></div><div class="line">    <span class="built_in">UIImage</span> *cacheImage = weakSelf.downloadImage;</div><div class="line">    </div><div class="line">    <span class="comment">//ä¸‹è½½å®Œæˆååˆ é™¤æ“ä½œ</span></div><div class="line">    [<span class="keyword">self</span>.operationCacheDict removeObjectForKey:URLString];</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> (cacheImage != <span class="literal">nil</span>) &#123;</div><div class="line">        <span class="comment">//å­˜å…¥å­—å…¸ç¼“å­˜ä¸­</span></div><div class="line">        [<span class="keyword">self</span>.imageCacheDict setObject:cacheImage forKey:URLString];</div><div class="line">        </div><div class="line">        <span class="comment">//ä¸»çº¿ç¨‹å›è°ƒ</span></div><div class="line">        [[<span class="built_in">NSOperationQueue</span> mainQueue] addOperationWithBlock:^&#123;</div><div class="line">            completion(weakSelf.downloadImage);</div><div class="line">        &#125;];</div><div class="line">    &#125;</div><div class="line">&#125;];</div></pre></td></tr></table></figure>
<blockquote>
<p>è¿è¡Œæµ‹è¯•<br><img src="http://d.pr/i/1eOaG+" alt="æµ‹è¯•"></p>
</blockquote>
<ul>
<li>åœ¨<code>HMDownloadOperation</code>ä¸­æ·»åŠ æ¨¡æ‹Ÿå»¶æ—¶çš„ä»£ç , æµ‹è¯•æ“ä½œçš„ç¼“å­˜æƒ…å†µ</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">-(<span class="keyword">void</span>)main&#123;</div><div class="line">    <span class="comment">//ç”Ÿæˆä¸‹è½½URL</span></div><div class="line">    <span class="built_in">NSURL</span> *url = [<span class="built_in">NSURL</span> URLWithString:<span class="keyword">self</span>.URLString];</div><div class="line">    </div><div class="line">    <span class="comment">//æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ</span></div><div class="line">    [<span class="built_in">NSThread</span> sleepForTimeInterval:arc4random_uniform(<span class="number">5</span>)];</div><div class="line">    </div><div class="line">    <span class="comment">//åˆ¤æ–­ä¸‹è½½é“¾æ¥æ˜¯å¦ç”ŸæˆæˆåŠŸ</span></div><div class="line">    <span class="keyword">if</span> (url == <span class="literal">nil</span>) &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"ä¸‹è½½åœ°å€é”™è¯¯"</span>);</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//åˆ¤æ–­æ“ä½œæ˜¯å¦å·²è¢«å–æ¶ˆ</span></div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.isCancelled) &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"ä¸‹è½½æ“ä½œè¢«å–æ¶ˆäº†!"</span>);</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//ä¸‹è½½</span></div><div class="line">    <span class="built_in">NSData</span> *data = [<span class="built_in">NSData</span> dataWithContentsOfURL:url];</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> (data != <span class="literal">nil</span>) &#123;</div><div class="line">        <span class="comment">//å°†æ•°æ®å†™å…¥æ²™ç›’ä¸­</span></div><div class="line">        [data writeToFile:<span class="keyword">self</span>.cachePath atomically:<span class="literal">YES</span>];</div><div class="line">        <span class="comment">//å°†äºŒè¿›åˆ¶æ•°æ®è½¬æ¢æˆå›¾åƒ</span></div><div class="line">        <span class="keyword">self</span>.downloadImage = [<span class="built_in">UIImage</span> imageWithData:data];</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>è¿è¡Œæµ‹è¯•<br><img src="http://d.pr/i/Dlua+" alt="æµ‹è¯•"><br>ä¸‹ä¸€ç›®æ ‡: å»ºç«‹<code>UIImageView</code>çš„åˆ†ç±»æ–¹æ³•</p>
</blockquote>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[æ¨¡æ‹ŸSDWebImageå¼‚æ­¥ä¸‹è½½å›¾ç‰‡æ“ä½œ(ä¸‰)]]></title>
      <url>http://yoursite.com/2016/08/02/%E6%A8%A1%E6%8B%9FSDWebImage%E5%BC%82%E6%AD%A5%E4%B8%8B%E8%BD%BD%E5%9B%BE%E7%89%87%E6%93%8D%E4%BD%9C(%E4%B8%89)/</url>
      <content type="html"><![CDATA[<h2 id="å¼‚æ­¥å›¾åƒ-æ“ä½œç¼“å­˜"><a href="#å¼‚æ­¥å›¾åƒ-æ“ä½œç¼“å­˜" class="headerlink" title="å¼‚æ­¥å›¾åƒ-æ“ä½œç¼“å­˜"></a>å¼‚æ­¥å›¾åƒ-æ“ä½œç¼“å­˜</h2><h3 id="ç›®æ ‡"><a href="#ç›®æ ‡" class="headerlink" title="ç›®æ ‡"></a>ç›®æ ‡</h3><ul>
<li>å»ºç«‹<code>æ“ä½œç¼“å­˜å­—å…¸</code>, ç¼“å­˜ä¸‹è½½æ“ä½œ, é¿å…æ“ä½œè¢«é‡å¤åˆ›å»º</li>
</ul>
<h3 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><ul>
<li>åœ¨<code>viewController</code>ä¸­å®šä¹‰<code>æ“ä½œç¼“å­˜å­—å…¸</code>å±æ€§</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSMutableDictionary</span> *operationCacheDict;</div></pre></td></tr></table></figure>
<ul>
<li>æ‡’åŠ è½½æ“ä½œç¼“å­˜å­—å…¸</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">-(<span class="built_in">NSMutableDictionary</span> *)operationCacheDict&#123;</div><div class="line">    <span class="keyword">if</span> (_operationCacheDict == <span class="literal">nil</span>) &#123;</div><div class="line">        _operationCacheDict = [<span class="built_in">NSMutableDictionary</span> dictionary];</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> _operationCacheDict;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>a.ä¿®æ”¹æ•°æ®æºæ–¹æ³•, åœ¨ä¸‹è½½æ“ä½œå‰, åˆ¤æ–­ä¸‹è½½æ“ä½œæ˜¯å¦å·²ç»å­˜åœ¨</li>
<li>b.åœ¨æ•°æ®æºæ–¹æ³•çš„æœ«å°¾, å°†æ“ä½œæ·»åŠ åˆ°<code>æ“ä½œç¼“å­˜å­—å…¸</code>ä¸­</li>
<li>c.åœ¨ä¸‹è½½æ“ä½œå®Œæˆå, åº”å°†æ“ä½œç§»é™¤</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line">-(<span class="built_in">UITableViewCell</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView cellForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath&#123;</div><div class="line">    </div><div class="line">    HMAppCell *cell = [tableView dequeueReusableCellWithIdentifier:cellID forIndexPath:indexPath];</div><div class="line">    </div><div class="line">    HMAppInfo *info = <span class="keyword">self</span>.app_infos[indexPath.row];</div><div class="line">    </div><div class="line">    cell.appName.text = info.name;</div><div class="line">    cell.downCount.text = info.download;</div><div class="line">    <span class="comment">//åœ¨è¿™é‡Œè®¾ç½®å ä½å›¾åƒ ç”¨æ¥è§£å†³å›¾åƒé—ªåŠ¨çš„é—®é¢˜</span></div><div class="line">    cell.iconView.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"user_default"</span>];</div><div class="line">    </div><div class="line">    <span class="comment">//åˆ¤æ–­å›¾åƒæ˜¯å¦å·²ç»è¢«ç¼“å­˜</span></div><div class="line">    <span class="comment">//å¦‚æœç¼“å­˜ åˆ™ç›´æ¥å°†ç¼“å­˜ä¸­çš„å›¾åƒæ˜¾ç¤ºåœ¨iconViewä¸Š</span></div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.imageCacheDict[info.icon] != <span class="literal">nil</span>) &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@ çš„å›¾åƒå·²ç»ä»å­—å…¸ç¼“å­˜ä¸­å–å‡º"</span>, info.name);</div><div class="line">        cell.iconView.image = <span class="keyword">self</span>.imageCacheDict[info.icon];</div><div class="line">        <span class="keyword">return</span> cell;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">//a. åˆ¤æ–­æ“ä½œæ˜¯å¦å·²ç»åœ¨é˜Ÿåˆ—ä¸­, å¦‚æœæ“ä½œå·²ç»å­˜åœ¨, é‚£ä¹ˆç›´æ¥è¿”å›</span></div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.operationCacheDict[info.icon] != <span class="literal">nil</span>) &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@ is downloading"</span>, info.name);</div><div class="line">        <span class="keyword">return</span> cell;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="built_in">NSURL</span> *url = [<span class="built_in">NSURL</span> URLWithString:<span class="keyword">self</span>.app_infos[indexPath.row].icon];</div><div class="line">    </div><div class="line">    <span class="built_in">NSBlockOperation</span> *op = [<span class="built_in">NSBlockOperation</span>  blockOperationWithBlock:^&#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"æ­£åœ¨ä¸‹è½½ %@ çš„å›¾ç‰‡"</span>, <span class="keyword">self</span>.app_infos[indexPath.row].name);</div><div class="line">        <span class="comment">//åœ¨è¿™é‡ŒåŠ å…¥æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿçš„ä»£ç </span></div><div class="line">        <span class="comment">//æ¨¡æ‹Ÿä¸‹è½½ç¯å¢ƒæœ‰éšæœºå»¶è¿Ÿ å¯ä»¥çœ‹åˆ°æœ‰æ“ä½œè¢«é‡å¤æ·»åŠ äº†</span></div><div class="line">        [<span class="built_in">NSThread</span> sleepForTimeInterval:arc4random_uniform(<span class="number">10</span>)];</div><div class="line">        </div><div class="line">        <span class="built_in">NSData</span> *data = [<span class="built_in">NSData</span> dataWithContentsOfURL:url];</div><div class="line">        <span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> imageWithData:data];</div><div class="line">        </div><div class="line">        <span class="comment">//åœ¨ä¸»çº¿ç¨‹ä¸­æ›´æ–°UI</span></div><div class="line">        [[<span class="built_in">NSOperationQueue</span> mainQueue] addOperationWithBlock:^&#123;</div><div class="line">            <span class="comment">//æŸ¥çœ‹å·²ç»å­˜åœ¨çš„æ“ä½œæ•°é‡</span></div><div class="line">            <span class="built_in">NSLog</span>(<span class="string">@"æ“ä½œçš„æ•°é‡: %ld"</span>, <span class="keyword">self</span>.downloadQueque.operationCount);</div><div class="line">            </div><div class="line">            <span class="comment">//æ·»åŠ åˆ°å›¾åƒå­—å…¸ç¼“å­˜ä¸­</span></div><div class="line">            <span class="comment">//æ³¨æ„!! å­—å…¸valueä¸èƒ½ä¸ºnil</span></div><div class="line">            <span class="keyword">if</span> (image != <span class="literal">nil</span>) &#123;</div><div class="line">                [<span class="keyword">self</span>.imageCacheDict setValue:image forKey:info.icon];</div><div class="line">            &#125;</div><div class="line">            </div><div class="line">            <span class="comment">//c.ä¸‹è½½å®Œæˆ, åº”å°†å½“å‰ä¸‹è½½æ“ä½œä»ç¼“å­˜ä¸­ç§»é™¤</span></div><div class="line">            [<span class="keyword">self</span>.operationCacheDict removeObjectForKey:info.icon];</div><div class="line">            </div><div class="line">            cell.iconView.image = image;</div><div class="line">        &#125;];</div><div class="line">    &#125;];</div><div class="line">    </div><div class="line">    <span class="comment">//å°†æ“ä½œåŠ å…¥ä¸‹è½½é˜Ÿåˆ—</span></div><div class="line">    [<span class="keyword">self</span>.downloadQueque addOperation:op];</div><div class="line">    <span class="comment">//b. å°†æ“ä½œåŠ å…¥æ“ä½œçš„å­—å…¸ç¼“å­˜</span></div><div class="line">    [<span class="keyword">self</span>.operationCacheDict setObject:op forKey:info.icon];</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> cell;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>åœ¨å†…å­˜è­¦å‘Šä¸­å¤„ç†ç¼“å­˜æ“ä½œ</li>
</ul>
<figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="selector-id">#pragma</span> <span class="selector-tag">mark</span> <span class="selector-tag">-</span> <span class="selector-tag">memory</span> <span class="selector-tag">Warning</span></div><div class="line"></div><div class="line"><span class="selector-tag">-</span>(void)<span class="selector-tag">didReceiveMemoryWarning</span>&#123;</div><div class="line">    <span class="selector-attr">[super didReceiveMemoryWarning]</span>;</div><div class="line">    <span class="comment">//ç§»é™¤ç¼“å­˜ä¸­çš„æ‰€æœ‰å¯¹è±¡</span></div><div class="line">    <span class="selector-attr">[self.imageCacheDict removeAllObjects]</span>;</div><div class="line">    <span class="selector-attr">[self.operationCacheDict removeAllObjects]</span>;</div><div class="line">    <span class="comment">//å–æ¶ˆé˜Ÿåˆ—ä¸­çš„æ‰€æœ‰æ“ä½œ</span></div><div class="line">    <span class="selector-attr">[self.downloadQueque cancelAllOperations]</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>è¿è¡Œæµ‹è¯•<br><img src="http://d.pr/i/1gMYl+" alt="æµ‹è¯•"></p>
</blockquote>
<h2 id="å¼‚æ­¥å›¾åƒ-æ²™ç›’ç¼“å­˜"><a href="#å¼‚æ­¥å›¾åƒ-æ²™ç›’ç¼“å­˜" class="headerlink" title="å¼‚æ­¥å›¾åƒ-æ²™ç›’ç¼“å­˜"></a>å¼‚æ­¥å›¾åƒ-æ²™ç›’ç¼“å­˜</h2><h3 id="æ²™ç›’ç›®å½•ä»‹ç»"><a href="#æ²™ç›’ç›®å½•ä»‹ç»" class="headerlink" title="æ²™ç›’ç›®å½•ä»‹ç»"></a>æ²™ç›’ç›®å½•ä»‹ç»</h3><ul>
<li>Documents<ul>
<li>ä¿å­˜ç”±åº”ç”¨ç¨‹åºäº§ç”Ÿçš„æ–‡ä»¶æˆ–è€…æ•°æ®ï¼Œä¾‹å¦‚ï¼šæ¶‚é¸¦ç¨‹åºç”Ÿæˆçš„å›¾ç‰‡ï¼Œæ¸¸æˆå…³å¡è®°å½•</li>
<li>iCloud ä¼šè‡ªåŠ¨å¤‡ä»½<code>Document</code>ä¸­çš„æ‰€æœ‰æ–‡ä»¶</li>
<li>å¦‚æœä¿å­˜äº†ä»ç½‘ç»œä¸‹è½½çš„æ–‡ä»¶ï¼Œåœ¨ä¸Šæ¶å®¡æ‰¹çš„æ—¶å€™ï¼Œä¼šè¢«æ‹’ï¼</li>
</ul>
</li>
<li>tmp<ul>
<li>ä¸´æ—¶æ–‡ä»¶å¤¹ï¼Œä¿å­˜ä¸´æ—¶æ–‡ä»¶</li>
<li>ä¿å­˜åœ¨<code>tmp</code>æ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å›æ”¶ï¼Œè­¬å¦‚ç£ç›˜ç©ºé—´ç´§å¼ æˆ–è€…é‡æ–°å¯åŠ¨æ‰‹æœº</li>
<li>ç¨‹åºå‘˜ä¸éœ€è¦å…³å¿ƒ<code>tmp</code>æ–‡ä»¶å¤¹ä¸­çš„é‡Šæ”¾</li>
</ul>
</li>
<li>Caches<ul>
<li>ç¼“å­˜ï¼Œä¿å­˜ä»ç½‘ç»œä¸‹è½½çš„æ–‡ä»¶ï¼Œåç»­ä»ç„¶éœ€è¦ç»§ç»­ä½¿ç”¨ï¼Œä¾‹å¦‚ï¼šç½‘ç»œä¸‹è½½çš„ç¼“å­˜æ•°æ®ï¼Œå›¾ç‰‡</li>
<li><strong>Cachesç›®å½•ä¸‹é¢çš„æ–‡ä»¶,å½“æ‰‹æœºå­˜å‚¨ç©ºé—´ä¸è¶³çš„æ—¶å€™,ä¼šè‡ªåŠ¨åˆ é™¤</strong></li>
<li><strong>è¦æ±‚ç¨‹åºå¿…éœ€æä¾›ä¸€ä¸ªå®Œå–„çš„æ¸…é™¤ç¼“å­˜ç›®å½•çš„â€è§£å†³æ–¹æ¡ˆâ€ï¼</strong></li>
</ul>
</li>
<li>preferences<ul>
<li>ç³»ç»Ÿåå¥½ï¼Œç”¨æˆ·åå¥½</li>
<li>æ“ä½œæ˜¯é€šè¿‡<code>[NSUserDefaults standardDefaults]</code>æ¥ç›´æ¥æ“ä½œ</li>
</ul>
</li>
</ul>
<h3 id="æ“ä½œæ­¥éª¤"><a href="#æ“ä½œæ­¥éª¤" class="headerlink" title="æ“ä½œæ­¥éª¤"></a>æ“ä½œæ­¥éª¤</h3><h4 id="å¼•å…¥NSString-Pathåˆ†ç±»"><a href="#å¼•å…¥NSString-Pathåˆ†ç±»" class="headerlink" title="å¼•å…¥NSString+Pathåˆ†ç±»"></a>å¼•å…¥<code>NSString+Path</code>åˆ†ç±»</h4><ul>
<li>è¯¥åˆ†ç±»å¯ä»¥ç®€åŒ–è·å–æ²™ç›’ç›®å½•çš„æ“ä½œ</li>
<li>å¯¹urlåœ°å€ä½¿ç”¨ç›¸å…³çš„<code>appending</code>æ–¹æ³•, å¯ä»¥ç›´æ¥ç”Ÿæˆå¯¹åº”æ–‡ä»¶åçš„æ²™ç›’åœ°å€</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/// è·å–Documentsç›®å½•</span></div><div class="line">- (<span class="built_in">NSString</span> *)appendDocumentsPath</div><div class="line">&#123;</div><div class="line">    <span class="comment">// è·å–Documentsæ–‡ä»¶ç›®å½•</span></div><div class="line">    <span class="built_in">NSString</span> *documentsPath = [<span class="built_in">NSSearchPathForDirectoriesInDomains</span>(<span class="built_in">NSDocumentDirectory</span>, <span class="built_in">NSUserDomainMask</span>, <span class="literal">YES</span>) lastObject];</div><div class="line">    <span class="comment">// è·å–å›¾ç‰‡çš„åå­—</span></div><div class="line">    <span class="built_in">NSString</span> *fileName = [<span class="keyword">self</span> lastPathComponent];</div><div class="line">    <span class="comment">// Documentsæ–‡ä»¶ç›®å½•æ‹¼æ¥å›¾ç‰‡çš„åå­— == å›¾ç‰‡ä¿å­˜åˆ°æ²™ç›’çš„è·¯å¾„</span></div><div class="line">    <span class="built_in">NSString</span> *filePath = [documentsPath stringByAppendingPathComponent:fileName];</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> filePath;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/// è·å–Cacheç›®å½•</span></div><div class="line">- (<span class="built_in">NSString</span> *)appendCachePath</div><div class="line">&#123;</div><div class="line">    <span class="comment">// è·å–Cacheæ–‡ä»¶ç›®å½•</span></div><div class="line">    <span class="built_in">NSString</span> *cachePath = [<span class="built_in">NSSearchPathForDirectoriesInDomains</span>(<span class="built_in">NSCachesDirectory</span>, <span class="built_in">NSUserDomainMask</span>, <span class="literal">YES</span>) lastObject];</div><div class="line">    <span class="comment">// è·å–å›¾ç‰‡çš„åå­—</span></div><div class="line">    <span class="built_in">NSString</span> *fileName = [<span class="keyword">self</span> lastPathComponent];</div><div class="line">    <span class="comment">// Cacheæ–‡ä»¶ç›®å½•æ‹¼æ¥å›¾ç‰‡çš„åå­— == å›¾ç‰‡ä¿å­˜åˆ°æ²™ç›’çš„è·¯å¾„</span></div><div class="line">    <span class="built_in">NSString</span> *filePath = [cachePath stringByAppendingPathComponent:fileName];</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> filePath;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/// è·å–Tmpç›®å½•</span></div><div class="line">- (<span class="built_in">NSString</span> *)appendTmpPath</div><div class="line">&#123;</div><div class="line">    <span class="comment">// è·å–Documentsæ–‡ä»¶ç›®å½•</span></div><div class="line">    <span class="built_in">NSString</span> *tmpPath = <span class="built_in">NSTemporaryDirectory</span>();</div><div class="line">    <span class="comment">// è·å–å›¾ç‰‡çš„åå­—</span></div><div class="line">    <span class="built_in">NSString</span> *fileName = [<span class="keyword">self</span> lastPathComponent];</div><div class="line">    <span class="comment">// Documentsæ–‡ä»¶ç›®å½•æ‹¼æ¥å›¾ç‰‡çš„åå­— == å›¾ç‰‡ä¿å­˜åˆ°æ²™ç›’çš„è·¯å¾„</span></div><div class="line">    <span class="built_in">NSString</span> *filePath = [tmpPath stringByAppendingPathComponent:fileName];</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> filePath;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="æ²™ç›’ç¼“å­˜"><a href="#æ²™ç›’ç¼“å­˜" class="headerlink" title="æ²™ç›’ç¼“å­˜"></a>æ²™ç›’ç¼“å­˜</h4><ul>
<li>å¯¼å…¥<code>NSString+Path</code>åˆ†ç±»å¤´æ–‡ä»¶</li>
</ul>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="selector-id">#import</span> <span class="string">"NSString+path.h"</span></div></pre></td></tr></table></figure>
<ul>
<li>a. å°†å›¾åƒç¼“å­˜è‡³æ²™ç›’ä¸­</li>
<li>b. åˆ¤æ–­æ²™ç›’ä¸­æ˜¯å¦æœ‰å›¾åƒçš„ç¼“å­˜, å¦‚æœæœ‰, åˆ™å°†æ²™ç›’ä¸­çš„å›¾åƒç›´æ¥æ˜¾ç¤ºåœ¨cellçš„<code>iconView</code>ä¸Š, å¹¶<code>return cell</code></li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div></pre></td><td class="code"><pre><div class="line">-(<span class="built_in">UITableViewCell</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView cellForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath&#123;</div><div class="line">    </div><div class="line">    HMAppCell *cell = [tableView dequeueReusableCellWithIdentifier:cellID forIndexPath:indexPath];</div><div class="line">    </div><div class="line">    HMAppInfo *info = <span class="keyword">self</span>.app_infos[indexPath.row];</div><div class="line">    </div><div class="line">    cell.appName.text = info.name;</div><div class="line">    cell.downCount.text = info.download;</div><div class="line">    <span class="comment">//åœ¨è¿™é‡Œè®¾ç½®å ä½å›¾åƒ ç”¨æ¥è§£å†³å›¾åƒé—ªåŠ¨çš„é—®é¢˜</span></div><div class="line">    cell.iconView.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"user_default"</span>];</div><div class="line">    </div><div class="line">    <span class="comment">//åˆ¤æ–­å›¾åƒæ˜¯å¦å·²ç»è¢«ç¼“å­˜</span></div><div class="line">    <span class="comment">//å¦‚æœç¼“å­˜ åˆ™ç›´æ¥å°†ç¼“å­˜ä¸­çš„å›¾åƒæ˜¾ç¤ºåœ¨iconViewä¸Š</span></div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.imageCacheDict[info.icon] != <span class="literal">nil</span>) &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@ çš„å›¾åƒå·²ç»ä»å­—å…¸ç¼“å­˜ä¸­å–å‡º"</span>, info.name);</div><div class="line">        cell.iconView.image = <span class="keyword">self</span>.imageCacheDict[info.icon];</div><div class="line">        <span class="keyword">return</span> cell;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">//è·å–æ²™ç›’è·¯å¾„</span></div><div class="line">    <span class="built_in">NSString</span> *cachePath = [info.icon appendCachePath];</div><div class="line">    </div><div class="line">    <span class="comment">//b. åˆ¤æ–­æ²™ç›’ä¸­æ˜¯å¦å·²ç»ç¼“å­˜äº†å›¾ç‰‡</span></div><div class="line">    <span class="built_in">UIImage</span> *cacheImage = [<span class="built_in">UIImage</span> imageWithContentsOfFile:cachePath];</div><div class="line">    <span class="keyword">if</span> (cacheImage != <span class="literal">nil</span>) &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@ çš„å›¾åƒå·²ç»ä»æ²™ç›’ä¸­å–å‡º"</span>, info.name);</div><div class="line">        <span class="comment">//å¦‚æœç¼“å­˜äº†å›¾ç‰‡, åˆ™å‘å›¾åƒç¼“å­˜å­—å…¸ä¸­å­˜å‚¨ä¸€ä»½, å¹¶å°†å›¾åƒç›´æ¥æ˜¾ç¤ºåˆ°cellçš„iconViewä¸Š</span></div><div class="line">        [<span class="keyword">self</span>.imageCacheDict setObject:cacheImage forKey:info.icon];</div><div class="line">        cell.iconView.image = cacheImage;</div><div class="line">        <span class="keyword">return</span> cell;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">//åˆ¤æ–­æ“ä½œæ˜¯å¦å·²ç»åœ¨é˜Ÿåˆ—ä¸­, å¦‚æœæ“ä½œå·²ç»å­˜åœ¨, é‚£ä¹ˆç›´æ¥è¿”å›</span></div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.operationCacheDict[info.icon] != <span class="literal">nil</span>) &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@ is downloading"</span>, info.name);</div><div class="line">        <span class="keyword">return</span> cell;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="built_in">NSURL</span> *url = [<span class="built_in">NSURL</span> URLWithString:<span class="keyword">self</span>.app_infos[indexPath.row].icon];</div><div class="line">    </div><div class="line">    <span class="built_in">NSBlockOperation</span> *op = [<span class="built_in">NSBlockOperation</span>  blockOperationWithBlock:^&#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"æ­£åœ¨ä¸‹è½½ %@ çš„å›¾ç‰‡"</span>, <span class="keyword">self</span>.app_infos[indexPath.row].name);</div><div class="line">        <span class="comment">//åœ¨è¿™é‡ŒåŠ å…¥æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿçš„ä»£ç </span></div><div class="line">        <span class="comment">//æ¨¡æ‹Ÿä¸‹è½½ç¯å¢ƒæœ‰éšæœºå»¶è¿Ÿ å¯ä»¥çœ‹åˆ°æœ‰æ“ä½œè¢«é‡å¤æ·»åŠ äº†</span></div><div class="line">        [<span class="built_in">NSThread</span> sleepForTimeInterval:arc4random_uniform(<span class="number">5</span>)];</div><div class="line">        </div><div class="line">        <span class="built_in">NSData</span> *data = [<span class="built_in">NSData</span> dataWithContentsOfURL:url];</div><div class="line">        <span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> imageWithData:data];</div><div class="line">        </div><div class="line">        <span class="comment">//a. å°†ä¸‹è½½å¥½çš„å›¾ç‰‡ä¿å­˜åˆ°æ²™ç›’ä¸­</span></div><div class="line">        [data writeToFile:cachePath atomically:<span class="literal">YES</span>];</div><div class="line">        </div><div class="line">        <span class="comment">//åœ¨ä¸»çº¿ç¨‹ä¸­æ›´æ–°UI</span></div><div class="line">        [[<span class="built_in">NSOperationQueue</span> mainQueue] addOperationWithBlock:^&#123;</div><div class="line">            <span class="comment">//æŸ¥çœ‹å·²ç»å­˜åœ¨çš„æ“ä½œæ•°é‡</span></div><div class="line">            <span class="built_in">NSLog</span>(<span class="string">@"æ“ä½œçš„æ•°é‡: %ld"</span>, <span class="keyword">self</span>.downloadQueque.operationCount);</div><div class="line">            </div><div class="line">            <span class="comment">//æ·»åŠ åˆ°å›¾åƒå­—å…¸ç¼“å­˜ä¸­</span></div><div class="line">            <span class="comment">//æ³¨æ„!! å­—å…¸valueä¸èƒ½ä¸ºnil</span></div><div class="line">            <span class="keyword">if</span> (image != <span class="literal">nil</span>) &#123;</div><div class="line">                [<span class="keyword">self</span>.imageCacheDict setValue:image forKey:info.icon];</div><div class="line">            &#125;</div><div class="line">            </div><div class="line">            <span class="comment">//ä¸‹è½½å®Œæˆ, åº”å°†å½“å‰ä¸‹è½½æ“ä½œä»ç¼“å­˜ä¸­ç§»é™¤</span></div><div class="line">            [<span class="keyword">self</span>.operationCacheDict removeObjectForKey:info.icon];</div><div class="line">            </div><div class="line">            cell.iconView.image = image;</div><div class="line">        &#125;];</div><div class="line">    &#125;];</div><div class="line">    </div><div class="line">    <span class="comment">//å°†æ“ä½œåŠ å…¥ä¸‹è½½é˜Ÿåˆ—</span></div><div class="line">    [<span class="keyword">self</span>.downloadQueque addOperation:op];</div><div class="line">    <span class="comment">//å°†æ“ä½œåŠ å…¥æ“ä½œçš„å­—å…¸ç¼“å­˜</span></div><div class="line">    [<span class="keyword">self</span>.operationCacheDict setObject:op forKey:info.icon];</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> cell;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>è¿è¡Œæµ‹è¯•<br>å¯ä»¥çœ‹åˆ°, ç¨‹åºåˆšå¼€å§‹è¿è¡Œçš„æ—¶å€™, å½“æ²™ç›’ä¸­ç¼“å­˜äº†å›¾ç‰‡æ—¶, å°†ç›´æ¥ä»æ²™ç›’ä¸­åŠ è½½å›¾ç‰‡, è€Œç¬¬äºŒæ¬¡åŠ è½½å›¾ç‰‡æ—¶, åˆ™ä¼šç›´æ¥ä»ç¼“å­˜å­—å…¸ä¸­å–å‡ºäº†<br><img src="http://d.pr/i/Lg8E+" alt="æµ‹è¯•"><br><img src="http://d.pr/i/1aDEG+" alt="æ²™ç›’ç¼“å­˜"></p>
</blockquote>
<p><strong>è‡³æ­¤, æ¨¡æ‹ŸSDWebImageå°±å®Œæˆäº†, ä¸‹ä¸€æ­¥, æˆ‘å°†ç»§ç»­å°è¯•ç®€å•æ¨¡ä»¿ä¸€ä¸‹SDWebImageçš„å†…éƒ¨å®ç°</strong></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[æ¨¡æ‹ŸSDWebImageå¼‚æ­¥ä¸‹è½½å›¾ç‰‡æ“ä½œ(äºŒ)]]></title>
      <url>http://yoursite.com/2016/08/01/%E6%A8%A1%E6%8B%9FSDWebImage%E5%BC%82%E6%AD%A5%E4%B8%8B%E8%BD%BD%E5%9B%BE%E7%89%87%E6%93%8D%E4%BD%9C(%E4%BA%8C)/</url>
      <content type="html"><![CDATA[<h2 id="å¼‚æ­¥å›¾åƒ-è‡ªè¡ŒåŠ è½½"><a href="#å¼‚æ­¥å›¾åƒ-è‡ªè¡ŒåŠ è½½" class="headerlink" title="å¼‚æ­¥å›¾åƒ-è‡ªè¡ŒåŠ è½½"></a>å¼‚æ­¥å›¾åƒ-è‡ªè¡ŒåŠ è½½</h2><h3 id="ç›®æ ‡"><a href="#ç›®æ ‡" class="headerlink" title="ç›®æ ‡"></a>ç›®æ ‡</h3><ul>
<li>è‡ªè¡ŒåŠ è½½å¼‚æ­¥å›¾åƒ</li>
<li>è®¾ç½®</li>
</ul>
<h3 id="æ“ä½œæ­¥éª¤"><a href="#æ“ä½œæ­¥éª¤" class="headerlink" title="æ“ä½œæ­¥éª¤"></a>æ“ä½œæ­¥éª¤</h3><h4 id="å¼‚æ­¥ä¸‹è½½çš„ç®€å•å®ç°"><a href="#å¼‚æ­¥ä¸‹è½½çš„ç®€å•å®ç°" class="headerlink" title="å¼‚æ­¥ä¸‹è½½çš„ç®€å•å®ç°"></a>å¼‚æ­¥ä¸‹è½½çš„ç®€å•å®ç°</h4><ul>
<li>å®šä¹‰æ“ä½œé˜Ÿåˆ—</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSOperationQueue</span> *queque;</div></pre></td></tr></table></figure>
<ul>
<li>æ‡’åŠ è½½æ“ä½œé˜Ÿåˆ—</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">-(<span class="built_in">NSOperationQueue</span> *)queque&#123;</div><div class="line">    <span class="keyword">if</span> (_queque == <span class="literal">nil</span>) &#123;</div><div class="line">        _queque = [[<span class="built_in">NSOperationQueue</span> alloc] init];</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> _queque;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>ä¿®æ”¹æ•°æ®æºæ–¹æ³•</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">-(<span class="built_in">UITableViewCell</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView cellForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath&#123;</div><div class="line">    </div><div class="line">    HMAppCell *cell = [tableView dequeueReusableCellWithIdentifier:cellID forIndexPath:indexPath];</div><div class="line">    </div><div class="line">    HMAppInfo *info = <span class="keyword">self</span>.app_infos[indexPath.row];</div><div class="line">    </div><div class="line">    cell.appName.text = info.name;</div><div class="line">    cell.downCount.text = info.download;</div><div class="line">    </div><div class="line">    <span class="comment">//å°†ä½¿ç”¨SDWebImageåŠ è½½å›¾ç‰‡çš„ä»£ç æ³¨é‡Šæ‰</span></div><div class="line"><span class="comment">//    [cell.iconView sd_setImageWithURL:[NSURL URLWithString:info.icon]];</span></div><div class="line">    </div><div class="line">    <span class="built_in">NSURL</span> *url = [<span class="built_in">NSURL</span> URLWithString:<span class="keyword">self</span>.app_infos[indexPath.row].icon];</div><div class="line">    </div><div class="line">    <span class="built_in">NSBlockOperation</span> *op = [<span class="built_in">NSBlockOperation</span>  blockOperationWithBlock:^&#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"æ­£åœ¨ä¸‹è½½ %@ çš„å›¾ç‰‡"</span>, <span class="keyword">self</span>.app_infos[indexPath.row].name);</div><div class="line">        </div><div class="line">        <span class="built_in">NSData</span> *data = [<span class="built_in">NSData</span> dataWithContentsOfURL:url];</div><div class="line">        <span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> imageWithData:data];</div><div class="line">        </div><div class="line">        [[<span class="built_in">NSOperationQueue</span> mainQueue] addOperationWithBlock:^&#123;</div><div class="line">            cell.iconView.image = image;</div><div class="line">        &#125;];</div><div class="line">    &#125;];</div><div class="line">    </div><div class="line">    [<span class="keyword">self</span>.downloadQueque addOperation:op];</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> cell;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>è¿è¡Œæµ‹è¯•<br><img src="http://d.pr/i/lh1F+" alt="æµ‹è¯•"></p>
</blockquote>
<h4 id="æ¨¡æ‹Ÿå»¶æ—¶"><a href="#æ¨¡æ‹Ÿå»¶æ—¶" class="headerlink" title="æ¨¡æ‹Ÿå»¶æ—¶"></a>æ¨¡æ‹Ÿå»¶æ—¶</h4><ul>
<li>æ¨¡æ‹Ÿç½‘ç»œå»¶æ—¶</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSLog</span>(<span class="string">@"æ­£åœ¨ä¸‹è½½ %@ çš„å›¾ç‰‡"</span>, <span class="keyword">self</span>.app_infos[indexPath.row].name);</div><div class="line"><span class="comment">//åœ¨è¿™é‡ŒåŠ å…¥æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿçš„ä»£ç </span></div><div class="line">[<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">0.5</span>];</div></pre></td></tr></table></figure>
<blockquote>
<p>è¿è¡Œæµ‹è¯•, å¿«é€Ÿæ»šåŠ¨è¡¨æ ¼</p>
<ul>
<li>ä¼šå‘ç°è¡¨æ ¼è¡Œçš„cellå› ä¸ºå¤ç”¨, å‡ºç°å›¾ç‰‡é—ªåŠ¨çš„é—®é¢˜<br><img src="http://d.pr/i/13Kmz+" alt="å›¾ç‰‡é—ªåŠ¨"></li>
<li>è¡¨æ ¼çš„å¤ç”¨é—®é¢˜ï¼šæ²¡æœ‰åœ¨æ•°æ®æºæ–¹æ³•ä¸­æ›´æ–°æ˜¾ç¤º</li>
<li>è§£å†³åŠæ³•ï¼šä½¿ç”¨å ä½å›¾åƒ</li>
</ul>
</blockquote>
<ul>
<li>åœ¨æ•°æ®æºæ–¹æ³•ä¸­è®¾ç½®å ä½å›¾åƒ</li>
</ul>
<figure class="highlight sqf"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">cell.appName.<span class="built_in">text</span> = info.<span class="built_in">name</span>;</div><div class="line">cell.downCount.<span class="built_in">text</span> = info.download;</div><div class="line"><span class="comment">//åœ¨è¿™é‡Œè®¾ç½®å ä½å›¾åƒ(å›¾åƒç´ æè¯·è‡ªè¡Œå¯»æ‰¾) ç”¨æ¥è§£å†³å›¾åƒé—ªåŠ¨çš„é—®é¢˜</span></div><div class="line">cell.iconView.<span class="built_in">image</span> = [UIImage imageNamed:@<span class="string">"user_default"</span>];</div></pre></td></tr></table></figure>
<blockquote>
<p>è¿è¡Œæµ‹è¯•<br><img src="http://d.pr/i/hNrP+" alt="è®¾ç½®å ä½å›¾åƒ"></p>
<ul>
<li>æ¯æ¬¡å›¾åƒéƒ½ä»ç½‘ç»œä¸‹è½½ï¼Œæµªè´¹æµé‡</li>
<li>æ¯æ¬¡éƒ½æ˜¾ç¤ºå ä½å›¾åƒï¼Œé€ æˆä¸å¥½çš„ç”¨æˆ·ä½“éªŒ</li>
<li>åˆç†çš„è§£å†³æ–¹æ¡ˆï¼šå›¾åƒæ²¡æœ‰ä¸‹è½½æ˜¾ç¤ºå ä½å›¾åƒï¼Œå¦‚æœä¸‹è½½å®Œæˆï¼Œç›´æ¥æ˜¾ç¤ºå›¾åƒ</li>
<li>è§£å†³åŠæ³•ä¸€ï¼šåœ¨æ¨¡å‹ä¸­ç¼“å­˜å›¾åƒ<ul>
<li>ä¼˜ç‚¹ï¼šç®€å•</li>
<li>ç¼ºç‚¹ï¼šå†…å­˜ä¸è¶³æ—¶ä¸å¥½é‡Šæ”¾èµ„æº</li>
</ul>
</li>
<li>è§£å†³åŠæ³•äºŒï¼šæ–°å»ºå›¾åƒç¼“å­˜å­—å…¸<ul>
<li>ä¼˜ç‚¹ï¼šèƒ½å¤Ÿå•ç‹¬ç®¡ç†å›¾åƒçš„å†…å­˜ç¼“å­˜</li>
<li>ç¼ºç‚¹ï¼šä»£ç è¦ç¨å¾®ç¹çä¸€äº›</li>
</ul>
</li>
</ul>
</blockquote>
<h2 id="å¼‚æ­¥å›¾åƒ-ä½¿ç”¨æ¨¡å‹ç¼“å­˜"><a href="#å¼‚æ­¥å›¾åƒ-ä½¿ç”¨æ¨¡å‹ç¼“å­˜" class="headerlink" title="å¼‚æ­¥å›¾åƒ-ä½¿ç”¨æ¨¡å‹ç¼“å­˜"></a>å¼‚æ­¥å›¾åƒ-ä½¿ç”¨æ¨¡å‹ç¼“å­˜</h2><h3 id="ç›®æ ‡-1"><a href="#ç›®æ ‡-1" class="headerlink" title="ç›®æ ‡"></a>ç›®æ ‡</h3><ul>
<li>ä½¿ç”¨æ¨¡å‹ç¼“å­˜ç½‘ç»œå›¾åƒ</li>
</ul>
<h3 id="æ“ä½œæ­¥éª¤-1"><a href="#æ“ä½œæ­¥éª¤-1" class="headerlink" title="æ“ä½œæ­¥éª¤"></a>æ“ä½œæ­¥éª¤</h3><ul>
<li>åœ¨æ¨¡å‹ä¸­æ·»åŠ å›¾åƒç¼“å­˜å±æ€§</li>
</ul>
<blockquote>
<p>æ³¨æ„éœ€è¦å¯¼å…¥<uikit uikit.h="">å¤´æ–‡ä»¶</uikit></p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></div><div class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">HMAppInfo</span> : <span class="title">NSObject</span></span></div><div class="line"></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *name;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *download;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *icon;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">weak</span>) <span class="built_in">UIImage</span> *imageCache;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<ul>
<li>ä¿®æ”¹æ•°æ®æºæ–¹æ³•</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">-(<span class="built_in">UITableViewCell</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView cellForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath&#123;</div><div class="line">    </div><div class="line">    HMAppCell *cell = [tableView dequeueReusableCellWithIdentifier:cellID forIndexPath:indexPath];</div><div class="line">    </div><div class="line">    HMAppInfo *info = <span class="keyword">self</span>.app_infos[indexPath.row];</div><div class="line">    </div><div class="line">    cell.appName.text = info.name;</div><div class="line">    cell.downCount.text = info.download;</div><div class="line">    <span class="comment">//åœ¨è¿™é‡Œè®¾ç½®å ä½å›¾åƒ ç”¨æ¥è§£å†³å›¾åƒé—ªåŠ¨çš„é—®é¢˜</span></div><div class="line">    cell.iconView.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"user_default"</span>];</div><div class="line">    </div><div class="line">    <span class="comment">//åˆ¤æ–­æ˜¯å¦åœ¨æ¨¡å‹ä¸­å·²ç»æœ‰ç¼“å­˜ å¦‚æœæœ‰ å°†å›¾ç‰‡è®¾ç½®å¥½åç›´æ¥return cell;</span></div><div class="line">    <span class="keyword">if</span> (info.imageCache != <span class="literal">nil</span>) &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"ä»æ¨¡å‹ç¼“å­˜ä¸­å–å›¾ç‰‡"</span>);</div><div class="line">        cell.iconView.image = info.imageCache;</div><div class="line">        <span class="keyword">return</span> cell;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="built_in">NSURL</span> *url = [<span class="built_in">NSURL</span> URLWithString:<span class="keyword">self</span>.app_infos[indexPath.row].icon];</div><div class="line">    </div><div class="line">    <span class="built_in">NSBlockOperation</span> *op = [<span class="built_in">NSBlockOperation</span>  blockOperationWithBlock:^&#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"æ­£åœ¨ä¸‹è½½ %@ çš„å›¾ç‰‡"</span>, <span class="keyword">self</span>.app_infos[indexPath.row].name);</div><div class="line">        <span class="comment">//åœ¨è¿™é‡ŒåŠ å…¥æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿçš„ä»£ç </span></div><div class="line">        [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">0.5</span>];</div><div class="line">        </div><div class="line">        <span class="built_in">NSData</span> *data = [<span class="built_in">NSData</span> dataWithContentsOfURL:url];</div><div class="line">        <span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> imageWithData:data];</div><div class="line">        </div><div class="line">        <span class="comment">//åœ¨è¿™é‡Œå°†å›¾åƒå­˜å…¥æ¨¡å‹ç¼“å­˜</span></div><div class="line">        info.imageCache = image;</div><div class="line">        </div><div class="line">        <span class="comment">//åœ¨ä¸»çº¿ç¨‹ä¸­æ›´æ–°UI</span></div><div class="line">        [[<span class="built_in">NSOperationQueue</span> mainQueue] addOperationWithBlock:^&#123;</div><div class="line">            cell.iconView.image = image;</div><div class="line">        &#125;];</div><div class="line">    &#125;];</div><div class="line">    </div><div class="line">    <span class="comment">//å°†æ“ä½œåŠ å…¥ä¸‹è½½é˜Ÿåˆ—</span></div><div class="line">    [<span class="keyword">self</span>.downloadQueque addOperation:op];</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> cell;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>å­˜åœ¨é—®é¢˜</p>
<ul>
<li>å¦‚æœå‡ºç°å†…å­˜è­¦å‘Š, å†…å­˜æ¸…ç†å·¥ä½œå°†å˜å¾—ç¹çä¸”ä¸ç¬¦åˆé€»è¾‘</li>
<li>ä¸€æ—¦cellå¤ç”¨, ä»ç„¶ä¼šé‡æ–°ä¸‹è½½<br><img src="http://d.pr/i/MBha+" alt="é‡æ–°ä¸‹è½½çš„å¤ç°"></li>
<li>è§£å†³åŠæ³•: å•ç‹¬ç®¡ç†å›¾åƒç¼“å­˜</li>
</ul>
</blockquote>
<h2 id="å¼‚æ­¥å›¾åƒ-ä½¿ç”¨å­—å…¸è¿›è¡Œç¼“å­˜"><a href="#å¼‚æ­¥å›¾åƒ-ä½¿ç”¨å­—å…¸è¿›è¡Œç¼“å­˜" class="headerlink" title="å¼‚æ­¥å›¾åƒ-ä½¿ç”¨å­—å…¸è¿›è¡Œç¼“å­˜"></a>å¼‚æ­¥å›¾åƒ-ä½¿ç”¨å­—å…¸è¿›è¡Œç¼“å­˜</h2><h3 id="ç›®æ ‡-2"><a href="#ç›®æ ‡-2" class="headerlink" title="ç›®æ ‡"></a>ç›®æ ‡</h3><ul>
<li>ä½¿ç”¨å­—å…¸ç¼“å­˜å·²ç»ä¸‹è½½å¥½çš„å›¾åƒ</li>
</ul>
<h3 id="æ“ä½œæ­¥éª¤-2"><a href="#æ“ä½œæ­¥éª¤-2" class="headerlink" title="æ“ä½œæ­¥éª¤"></a>æ“ä½œæ­¥éª¤</h3><ul>
<li>æ¢å¤æ¨¡å‹ å°†ä¹‹å‰è®¾ç½®çš„ç¼“å­˜å›¾åƒå±æ€§åˆ é™¤</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">HMAppInfo</span> : <span class="title">NSObject</span></span></div><div class="line"></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *name;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *download;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *icon;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<ul>
<li>åœ¨<code>viewController</code>ä¸­å®šä¹‰å­—å…¸ç¼“å­˜å±æ€§</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSMutableDictionary</span> *imageCacheDict;</div></pre></td></tr></table></figure>
<ul>
<li>æ‡’åŠ è½½å­—å…¸ç¼“å­˜</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">-(<span class="built_in">NSMutableDictionary</span> *)imageCacheDict&#123;</div><div class="line">    <span class="keyword">if</span> (_imageCacheDict == <span class="literal">nil</span>) &#123;</div><div class="line">        _imageCacheDict = [<span class="built_in">NSMutableDictionary</span> dictionary];</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> _imageCacheDict;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>ä¿®æ”¹æ•°æ®æºæ–¹æ³•, åˆ¤æ–­ç¼“å­˜å›¾åƒæ˜¯å¦å·²ç»å­˜åœ¨</li>
<li>å¦‚æœç¼“å­˜ä¸å­˜åœ¨, åˆ™ä¸‹è½½å›¾åƒ, å¹¶æ·»åŠ åˆ°å­—å…¸ç¼“å­˜ä¸­</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line">-(<span class="built_in">UITableViewCell</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView cellForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath&#123;</div><div class="line">    </div><div class="line">    HMAppCell *cell = [tableView dequeueReusableCellWithIdentifier:cellID forIndexPath:indexPath];</div><div class="line">    </div><div class="line">    HMAppInfo *info = <span class="keyword">self</span>.app_infos[indexPath.row];</div><div class="line">    </div><div class="line">    cell.appName.text = info.name;</div><div class="line">    cell.downCount.text = info.download;</div><div class="line">    <span class="comment">//åœ¨è¿™é‡Œè®¾ç½®å ä½å›¾åƒ ç”¨æ¥è§£å†³å›¾åƒé—ªåŠ¨çš„é—®é¢˜</span></div><div class="line">    cell.iconView.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"user_default"</span>];</div><div class="line">    </div><div class="line">    <span class="comment">//åˆ¤æ–­å›¾åƒæ˜¯å¦å·²ç»è¢«ç¼“å­˜</span></div><div class="line">    <span class="comment">//å¦‚æœç¼“å­˜ åˆ™ç›´æ¥å°†ç¼“å­˜ä¸­çš„å›¾åƒæ˜¾ç¤ºåœ¨iconViewä¸Š</span></div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.imageCacheDict[info.icon] != <span class="literal">nil</span>) &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@ çš„å›¾åƒå·²ç»ä»å­—å…¸ç¼“å­˜ä¸­å–å‡º"</span>, info.name);</div><div class="line">        cell.iconView.image = <span class="keyword">self</span>.imageCacheDict[info.icon];</div><div class="line">        <span class="keyword">return</span> cell;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.operationCacheDict[info.icon] != <span class="literal">nil</span>) &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@ is downloading"</span>, info.name);</div><div class="line">        <span class="keyword">return</span> cell;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="built_in">NSURL</span> *url = [<span class="built_in">NSURL</span> URLWithString:<span class="keyword">self</span>.app_infos[indexPath.row].icon];</div><div class="line">    </div><div class="line">    <span class="built_in">NSBlockOperation</span> *op = [<span class="built_in">NSBlockOperation</span>  blockOperationWithBlock:^&#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"æ­£åœ¨ä¸‹è½½ %@ çš„å›¾ç‰‡"</span>, <span class="keyword">self</span>.app_infos[indexPath.row].name);</div><div class="line">        <span class="comment">//åœ¨è¿™é‡ŒåŠ å…¥æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿçš„ä»£ç </span></div><div class="line">        <span class="comment">//æ¨¡æ‹Ÿä¸‹è½½ç¯å¢ƒæœ‰éšæœºå»¶è¿Ÿ å¯ä»¥çœ‹åˆ°æœ‰æ“ä½œè¢«é‡å¤æ·»åŠ äº†</span></div><div class="line">        [<span class="built_in">NSThread</span> sleepForTimeInterval:arc4random_uniform(<span class="number">10</span>)];</div><div class="line">        </div><div class="line">        <span class="built_in">NSData</span> *data = [<span class="built_in">NSData</span> dataWithContentsOfURL:url];</div><div class="line">        <span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> imageWithData:data];</div><div class="line">        </div><div class="line">        <span class="comment">//åœ¨ä¸»çº¿ç¨‹ä¸­æ›´æ–°UI</span></div><div class="line">        [[<span class="built_in">NSOperationQueue</span> mainQueue] addOperationWithBlock:^&#123;</div><div class="line">            <span class="comment">//æŸ¥çœ‹å·²ç»å­˜åœ¨çš„æ“ä½œæ•°é‡</span></div><div class="line">            <span class="built_in">NSLog</span>(<span class="string">@"æ“ä½œçš„æ•°é‡: %ld"</span>, <span class="keyword">self</span>.downloadQueque.operationCount);</div><div class="line">            </div><div class="line">            <span class="comment">//æ·»åŠ åˆ°å›¾åƒå­—å…¸ç¼“å­˜ä¸­</span></div><div class="line">            <span class="comment">//æ³¨æ„!! å­—å…¸valueä¸èƒ½ä¸ºnil</span></div><div class="line">            <span class="keyword">if</span> (image != <span class="literal">nil</span>) &#123;</div><div class="line">                [<span class="keyword">self</span>.imageCacheDict setValue:image forKey:info.icon];</div><div class="line">            &#125;</div><div class="line">            </div><div class="line">            cell.iconView.image = image;</div><div class="line">        &#125;];</div><div class="line">    &#125;];</div><div class="line">    </div><div class="line">    <span class="comment">//å°†æ“ä½œåŠ å…¥ä¸‹è½½é˜Ÿåˆ—</span></div><div class="line">    [<span class="keyword">self</span>.downloadQueque addOperation:op];</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> cell;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>æ³¨æ„: ä½¿ç”¨æ¨¡å‹çš„iconå±æ€§, å¯ä»¥é¿å…ç¼“å­˜å›¾åƒé‡åçš„é—®é¢˜</p>
</blockquote>
<h3 id="å®ç°å†…å­˜è­¦å‘Šæ–¹æ³•"><a href="#å®ç°å†…å­˜è­¦å‘Šæ–¹æ³•" class="headerlink" title="å®ç°å†…å­˜è­¦å‘Šæ–¹æ³•"></a>å®ç°å†…å­˜è­¦å‘Šæ–¹æ³•</h3><figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="selector-id">#pragma</span> <span class="selector-tag">mark</span> <span class="selector-tag">-</span> <span class="selector-tag">memory</span> <span class="selector-tag">Warning</span></div><div class="line"></div><div class="line"><span class="selector-tag">-</span>(void)<span class="selector-tag">didReceiveMemoryWarning</span>&#123;</div><div class="line">    <span class="selector-attr">[super didReceiveMemoryWarning]</span>;</div><div class="line">    <span class="selector-attr">[self.imageCacheDict removeAllObjects]</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>è¿è¡Œæµ‹è¯•<br><img src="http://d.pr/i/wyGJ+" alt="æµ‹è¯•"><br>å¦‚æœæŸä¸€ä¸ªä¸‹è½½æ“ä½œè€—æ—¶è¾ƒé•¿, å½“ç”¨æˆ·å¿«é€Ÿæ‹–æ‹½è¡¨å•æ—¶, ä¸‹è½½æ“ä½œä¼šè¢«é‡å¤åˆ›å»º!</p>
</blockquote>
<h3 id="æµ‹è¯•é‡å¤åˆ›å»ºæ“ä½œçš„ç°è±¡"><a href="#æµ‹è¯•é‡å¤åˆ›å»ºæ“ä½œçš„ç°è±¡" class="headerlink" title="æµ‹è¯•é‡å¤åˆ›å»ºæ“ä½œçš„ç°è±¡"></a>æµ‹è¯•é‡å¤åˆ›å»ºæ“ä½œçš„ç°è±¡</h3><ul>
<li>è®¾ç½®ä¸‹è½½çš„æ¨¡æ‹Ÿå»¶è¿Ÿç•¥é•¿ä¸€äº›, å¹¶å¿«é€Ÿæ‹–åŠ¨è¡¨å•<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSLog</span>(<span class="string">@"æ­£åœ¨ä¸‹è½½ %@ çš„å›¾ç‰‡"</span>, <span class="keyword">self</span>.app_infos[indexPath.row].name);</div><div class="line"><span class="comment">//åœ¨è¿™é‡ŒåŠ å…¥æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿçš„ä»£ç </span></div><div class="line"><span class="comment">//æ¨¡æ‹Ÿä¸‹è½½ç¯å¢ƒæœ‰éšæœºå»¶è¿Ÿ å¯ä»¥çœ‹åˆ°æœ‰æ“ä½œè¢«é‡å¤æ·»åŠ äº†</span></div><div class="line">[<span class="built_in">NSThread</span> sleepForTimeInterval:arc4random_uniform(<span class="number">10</span>)];</div></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>å¦‚ä¸‹å›¾, æ€»å…±åªæœ‰16å¼ å›¾ç‰‡, å´æ·»åŠ äº†21ä¸ªä¸‹è½½æ“ä½œ!<br><img src="http://d.pr/i/7p3P+" alt="æµ‹è¯•"></p>
</blockquote>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[æ¨¡æ‹ŸSDWebImageå¼‚æ­¥ä¸‹è½½å›¾ç‰‡æ“ä½œ(ä¸€)]]></title>
      <url>http://yoursite.com/2016/07/30/%E6%A8%A1%E6%8B%9FSDWebImage%E5%BC%82%E6%AD%A5%E4%B8%8B%E8%BD%BD%E5%9B%BE%E7%89%87%E6%93%8D%E4%BD%9C(%E4%B8%80)/</url>
      <content type="html"><![CDATA[<p><img src="http://ww4.sinaimg.cn/large/6b1763dbjw1f6c5lbhtm5j21kw2aytxa.jpg" alt="æ€ç»´å¯¼å›¾"></p>
<h2 id="å¼‚æ­¥ä¸‹è½½å›¾ç‰‡æ“ä½œ-æ­å»ºç•Œé¢"><a href="#å¼‚æ­¥ä¸‹è½½å›¾ç‰‡æ“ä½œ-æ­å»ºç•Œé¢" class="headerlink" title="å¼‚æ­¥ä¸‹è½½å›¾ç‰‡æ“ä½œ-æ­å»ºç•Œé¢"></a>å¼‚æ­¥ä¸‹è½½å›¾ç‰‡æ“ä½œ-æ­å»ºç•Œé¢</h2><h3 id="ç›®æ ‡"><a href="#ç›®æ ‡" class="headerlink" title="ç›®æ ‡"></a>ç›®æ ‡</h3><ul>
<li>æ­å»ºç•Œé¢</li>
<li>ä½“ä¼š<code>AFNetWoring</code>çš„ä½¿ç”¨</li>
<li>å¤ä¹ <code>tableView</code>çš„ç®€å•å®ç”¨</li>
</ul>
<h3 id="æ“ä½œæ­¥éª¤"><a href="#æ“ä½œæ­¥éª¤" class="headerlink" title="æ“ä½œæ­¥éª¤"></a>æ“ä½œæ­¥éª¤</h3><h4 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h4><ul>
<li>æ–°å»ºé¡¹ç›®</li>
<li>å°†<code>Main.storyboard</code>ä¸­åˆå§‹çš„<code>ViewController</code>åˆ é™¤, å¹¶åœ¨å…¶ä¸­æ‹–å…¥ä¸€ä¸ªåŒ…è£…ç€<code>NavigationController</code>çš„<code>TableviewController</code></li>
<li>å°†<code>storyboard</code>ä¸­çš„<code>TableView</code> ç»‘å®šä¸ºç³»ç»Ÿçš„<code>viewController</code>ç±» å¹¶å°†ç³»ç»Ÿè‡ªå¸¦çš„<code>viewController</code>ç»§æ‰¿è‡ª<code>UITableViewController</code>ç±»<blockquote>
<p>è¿è¡Œæµ‹è¯•<br><img src="http://d.pr/i/1dUJF+" alt="Cellç•Œé¢æ­å»º"></p>
</blockquote>
</li>
</ul>
<h4 id="åŠ è½½ç½‘ç»œæ•°æ®"><a href="#åŠ è½½ç½‘ç»œæ•°æ®" class="headerlink" title="åŠ è½½ç½‘ç»œæ•°æ®"></a>åŠ è½½ç½‘ç»œæ•°æ®</h4><ul>
<li>æ·»åŠ <code>AFNetWorking</code>ç½‘ç»œæ¡†æ¶</li>
<li>å¯¼å…¥å¤´æ–‡ä»¶</li>
</ul>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="selector-id">#import</span> <span class="string">"AFNetworking.h"</span></div></pre></td></tr></table></figure>
<ul>
<li>å®ç°loadDataæ–¹æ³•</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">-(<span class="keyword">void</span>)loadData &#123;</div><div class="line">    <span class="built_in">NSString</span> *urlString = <span class="string">@"https://raw.githubusercontent.com/massacreformash/DemoRepository/master/apps.json"</span>;</div><div class="line">    </div><div class="line">    <span class="comment">//åˆå§‹åŒ–ä¸€ä¸ªç½‘ç»œè¯·æ±‚çš„ç®¡ç†å™¨</span></div><div class="line">    AFHTTPSessionManager *manager = [AFHTTPSessionManager manager];</div><div class="line">    </div><div class="line">    [manager GET:urlString parameters:<span class="literal">nil</span> progress:<span class="literal">nil</span> success:^(<span class="built_in">NSURLSessionDataTask</span> * _Nonnull task, <span class="keyword">id</span>  _Nullable responseObject) &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"success: %@"</span>, responseObject);</div><div class="line">    &#125; failure:^(<span class="built_in">NSURLSessionDataTask</span> * _Nullable task, <span class="built_in">NSError</span> * _Nonnull error) &#123;</div><div class="line">        <span class="comment">//åœ¨å…¬å¸å¼€å‘çš„è¯ é”™è¯¯è¯·æ±‚ä¸€å®šè¦å¤„ç†</span></div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"fail: %@"</span>, error);</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</div><div class="line">    &#125;];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>è¿è¡Œæµ‹è¯• æ­¤æ—¶åœ¨æ§åˆ¶å°åº”è¯¥èƒ½å¤Ÿçœ‹åˆ°ç±»ä¼¼äºè¿™æ ·çš„è¾“å‡º:<br><img src="http://d.pr/i/1e5R7+" alt="è¾“å‡º"></p>
</blockquote>
<h4 id="ç»‘å®šè¡¨æ ¼æ•°æ®"><a href="#ç»‘å®šè¡¨æ ¼æ•°æ®" class="headerlink" title="ç»‘å®šè¡¨æ ¼æ•°æ®"></a>ç»‘å®šè¡¨æ ¼æ•°æ®</h4><ul>
<li>å®šä¹‰tableViewå¯é‡ç”¨æ ‡è¯†ç¬¦</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">static</span> <span class="built_in">NSString</span> *cellId = <span class="string">@"cellid"</span>;</div></pre></td></tr></table></figure>
<ul>
<li>è®¾ç½®æ•°æ®æºå¹¶æ³¨å†ŒåŸå‹cell</li>
<li>éµå®ˆåè®®</li>
</ul>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@interface</span> ViewController () <span class="variable">&lt;UITableViewDataSource&gt;</span></div></pre></td></tr></table></figure>
<ul>
<li>å®ç°åè®®æ–¹æ³•</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#pragma mark - æ•°æ®æºæ–¹æ³•</span></div><div class="line"></div><div class="line">-(<span class="built_in">NSInteger</span>)tableView:(<span class="built_in">UITableView</span> *)tableView numberOfRowsInSection:(<span class="built_in">NSInteger</span>)section&#123;</div><div class="line">    <span class="keyword">return</span> <span class="number">10</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">-(<span class="built_in">UITableViewCell</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView cellForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath&#123;</div><div class="line">    <span class="built_in">UITableViewCell</span> *cell = [tableView dequeueReusableCellWithIdentifier:cellId forIndexPath:indexPath];</div><div class="line">    cell.textLabel.text = @(indexPath.row).description;</div><div class="line">    <span class="keyword">return</span> cell;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p><img src="http://d.pr/i/D2IP+" alt="æµ‹è¯•"></p>
</blockquote>
<h4 id="å®šä¹‰æ¨¡å‹"><a href="#å®šä¹‰æ¨¡å‹" class="headerlink" title="å®šä¹‰æ¨¡å‹"></a>å®šä¹‰æ¨¡å‹</h4><ul>
<li>æ–°å»º<code>HMAppInfo</code>æ¨¡å‹ ç»§æ‰¿è‡ª<code>NSObject</code> å¹¶å£°æ˜å¥½ç›¸å…³å±æ€§</li>
</ul>
<figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="variable">@interface</span> <span class="attribute">HMAppInfo </span>: NSObject</div><div class="line"></div><div class="line"><span class="variable">@property</span> (nonatomic, copy) NSString *name;</div><div class="line"><span class="variable">@property</span> (nonatomic, copy) NSString *download;</div><div class="line"><span class="variable">@property</span> (nonatomic, copy) NSString *icon;</div><div class="line"></div><div class="line"><span class="variable">@end</span></div></pre></td></tr></table></figure>
<ul>
<li>åœ¨viewControllerä¸­å¯¼å…¥æ¨¡å‹ å¹¶è®¾ç½®æ¨¡å‹æ•°ç»„</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#import <span class="meta-string">"HMAppInfo.h"</span></span></div><div class="line"></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSMutableArray</span> &lt;HMAppInfo *&gt; *app_infos;</div></pre></td></tr></table></figure>
<ul>
<li>æ‡’åŠ è½½<code>app_infos</code></li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">-(<span class="built_in">NSMutableArray</span> *)app_infos&#123;</div><div class="line">    <span class="keyword">if</span> (_app_infos == <span class="literal">nil</span>) &#123;</div><div class="line">        _app_infos = [<span class="built_in">NSMutableArray</span> array];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> _app_infos;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>ä¿®æ”¹<code>loadData</code>æ–¹æ³• åœ¨å…¶ä¸­å°†ä¸‹è½½å¥½çš„å­—å…¸è½¬ä¸ºæ¨¡å‹</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">-(<span class="keyword">void</span>)loadData &#123;</div><div class="line">    </div><div class="line">    <span class="built_in">NSString</span> *urlString = <span class="string">@"https://raw.githubusercontent.com/massacreformash/DemoRepository/master/apps.json"</span>;</div><div class="line">    </div><div class="line">    <span class="comment">//åˆå§‹åŒ–ä¸€ä¸ªç½‘ç»œè¯·æ±‚çš„ç®¡ç†å™¨</span></div><div class="line">    AFHTTPSessionManager *manager = [AFHTTPSessionManager manager];</div><div class="line">    </div><div class="line">    [manager GET:urlString parameters:<span class="literal">nil</span> progress:<span class="literal">nil</span> success:^(<span class="built_in">NSURLSessionDataTask</span> * _Nonnull task, <span class="keyword">id</span>  _Nullable responseObject) &#123;</div><div class="line">        <span class="comment">//å­—å…¸è½¬æ¨¡å‹</span></div><div class="line">        <span class="built_in">NSArray</span> *array = responseObject;</div><div class="line">        <span class="keyword">for</span> (<span class="built_in">NSDictionary</span> *dict <span class="keyword">in</span> array) &#123;</div><div class="line">            HMAppInfo *info = [[HMAppInfo alloc] init];</div><div class="line">            [info setValuesForKeysWithDictionary:dict];</div><div class="line">            [<span class="keyword">self</span>.app_infos addObject:info];</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="comment">//åˆ·æ–°tableView</span></div><div class="line">        [<span class="keyword">self</span>.tableView reloadData];</div><div class="line">    &#125; failure:^(<span class="built_in">NSURLSessionDataTask</span> * _Nullable task, <span class="built_in">NSError</span> * _Nonnull error) &#123;</div><div class="line">        <span class="comment">//åœ¨å…¬å¸å¼€å‘çš„è¯ é”™è¯¯è¯·æ±‚ä¸€å®šè¦å¤„ç†</span></div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"fail: %@"</span>, error);</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</div><div class="line">    &#125;];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>å¾—åˆ°ç±»ä¼¼å¦‚ä¸‹æ•°æ®:<br><img src="http://d.pr/i/1kt4z+" alt="æµ‹è¯•"></p>
</blockquote>
<ul>
<li>ä¿®æ”¹æ•°æ®æºæ–¹æ³•, ç»‘å®šcellæ•°æ®</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#pragma mark - æ•°æ®æºæ–¹æ³•</span></div><div class="line"></div><div class="line">-(<span class="built_in">NSInteger</span>)tableView:(<span class="built_in">UITableView</span> *)tableView numberOfRowsInSection:(<span class="built_in">NSInteger</span>)section&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.app_infos.count;</div><div class="line">&#125;</div><div class="line"></div><div class="line">-(<span class="built_in">UITableViewCell</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView cellForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath&#123;</div><div class="line">    <span class="built_in">UITableViewCell</span> *cell = [tableView dequeueReusableCellWithIdentifier:<span class="string">@"cell"</span> forIndexPath:indexPath];</div><div class="line">    </div><div class="line">    HMAppInfo *info = <span class="keyword">self</span>.app_infos[indexPath.row];</div><div class="line">    cell.textLabel.text = info.name;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>è¿›è¡Œæµ‹è¯•<br><img src="http://d.pr/i/27pF+" alt="æµ‹è¯•"></p>
</blockquote>
<h2 id="å¼‚æ­¥ä¸‹è½½å›¾ç‰‡æ“ä½œ-è®¾ç½®å›¾åƒ"><a href="#å¼‚æ­¥ä¸‹è½½å›¾ç‰‡æ“ä½œ-è®¾ç½®å›¾åƒ" class="headerlink" title="å¼‚æ­¥ä¸‹è½½å›¾ç‰‡æ“ä½œ-è®¾ç½®å›¾åƒ"></a>å¼‚æ­¥ä¸‹è½½å›¾ç‰‡æ“ä½œ-è®¾ç½®å›¾åƒ</h2><h3 id="ç›®æ ‡-1"><a href="#ç›®æ ‡-1" class="headerlink" title="ç›®æ ‡"></a>ç›®æ ‡</h3><ul>
<li>ä½¿ç”¨<code>SDWebImage</code>å¼‚æ­¥åŠ è½½ç½‘ç»œå›¾åƒ</li>
<li>åœ¨storyboardä¸­è‡ªå®šä¹‰Cell</li>
</ul>
<h3 id="æ“ä½œæ­¥éª¤-1"><a href="#æ“ä½œæ­¥éª¤-1" class="headerlink" title="æ“ä½œæ­¥éª¤"></a>æ“ä½œæ­¥éª¤</h3><h4 id="ä½¿ç”¨SDWebImageåŠ è½½å›¾åƒ"><a href="#ä½¿ç”¨SDWebImageåŠ è½½å›¾åƒ" class="headerlink" title="ä½¿ç”¨SDWebImageåŠ è½½å›¾åƒ"></a>ä½¿ç”¨<code>SDWebImage</code>åŠ è½½å›¾åƒ</h4><ul>
<li>å¯¼å…¥<code>SDWebImage</code>æ¡†æ¶</li>
<li>å¯¼å…¥å¤´æ–‡ä»¶</li>
</ul>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="selector-id">#import</span> <span class="string">"UIImageView+WebCache.h"</span></div></pre></td></tr></table></figure>
<ul>
<li>ä¿®æ”¹æ•°æ®æºæ–¹æ³•</li>
</ul>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">- (UITableViewCell *)<span class="string">tableView:</span>(UITableView *)tableView <span class="string">cellForRowAtIndexPath:</span>(NSIndexPath *)indexPath &#123;</div><div class="line"></div><div class="line">    UITableViewCell *cell = [tableView <span class="string">dequeueReusableCellWithIdentifier:</span>cellId <span class="string">forIndexPath:</span>indexPath];</div><div class="line"></div><div class="line">    HMAppInfo *info = self.app_infos[indexPath.row];</div><div class="line">    cell.textLabel.text = info.name;</div><div class="line"></div><div class="line">    <span class="comment">//SDWebImage</span></div><div class="line">    [cell.imageView <span class="string">sd_setImageWithURL:</span>[NSURL <span class="string">URLWithString:</span>info.icon]];</div><div class="line"></div><div class="line">    <span class="keyword">return</span> cell;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>åœ¨info.plistå¢åŠ ATSè®¾ç½®<br><img src="http://d.pr/i/15K3N+" alt="è®¾ç½®ATS"><br>è¿è¡Œæµ‹è¯•</p>
<ul>
<li>å›¾åƒéœ€è¦ç‚¹å‡»ä¹‹åæ‰èƒ½æ˜¾ç¤º<br><img src="http://d.pr/i/XTsf+" alt="æµ‹è¯•"></li>
<li>å› ä¸ºå›¾åƒåŠ è½½æ˜¯å¼‚æ­¥çš„, ç¬¬ä¸€æ¬¡è®¾ç½®æ•°æ®æºæ–¹æ³•æ—¶, å›¾åƒè¿˜æ²¡æœ‰ä¸‹è½½å®Œæˆ, é‚£ä¹ˆç³»ç»Ÿé»˜è®¤çš„<code>tableViewCell</code>ä¹Ÿä¸ä¼šåˆ›å»ºå›¾åƒè§†å›¾<br>è§£å†³åŠæ³•: ç”¨è‡ªå®šä¹‰çš„Cell</li>
</ul>
</blockquote>
<h4 id="è‡ªå®šä¹‰Cell"><a href="#è‡ªå®šä¹‰Cell" class="headerlink" title="è‡ªå®šä¹‰Cell"></a>è‡ªå®šä¹‰Cell</h4><ul>
<li>æ–°å»ºè‡ªå®šä¹‰çš„<code>HMAppCell</code>ç»§æ‰¿è‡ª<code>UITableviewCell</code>, åŒæ—¶å°†Tableviewçš„Cellç»‘å®šåˆ°<code>HMAppCell</code>ç±»</li>
<li>è®¾ç½®è‡ªåŠ¨å¸ƒå±€</li>
</ul>
<p><img src="http://d.pr/i/18u4U+" alt="Cellç•Œé¢æ­å»º"></p>
<ul>
<li>ä»£ç è¿çº¿åˆ°å¤´æ–‡ä»¶ä¸­</li>
</ul>
<figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="variable">@interface</span> <span class="attribute">HMAppCell </span>: UITableViewCell</div><div class="line"></div><div class="line"><span class="variable">@property</span> (weak, nonatomic) IBOutlet UIImageView *iconView;</div><div class="line"><span class="variable">@property</span> (weak, nonatomic) IBOutlet UILabel *appName;</div><div class="line"><span class="variable">@property</span> (weak, nonatomic) IBOutlet UILabel *downCount;</div><div class="line"></div><div class="line"><span class="variable">@end</span></div></pre></td></tr></table></figure>
<h4 id="ä¿®æ”¹æ§åˆ¶å™¨çš„ä»£ç "><a href="#ä¿®æ”¹æ§åˆ¶å™¨çš„ä»£ç " class="headerlink" title="ä¿®æ”¹æ§åˆ¶å™¨çš„ä»£ç "></a>ä¿®æ”¹æ§åˆ¶å™¨çš„ä»£ç </h4><ul>
<li>å¯¼å…¥å¤´æ–‡ä»¶</li>
</ul>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="selector-id">#import</span> <span class="string">"HMAppCell.h"</span></div></pre></td></tr></table></figure>
<ul>
<li>ä¿®æ”¹å¯é‡ç”¨cellä¸ºè‡ªå®šä¹‰cell</li>
</ul>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">HMAppCell *cell = [tableView <span class="string">dequeueReusableCellWithIdentifier:</span>cellID <span class="string">forIndexPath:</span>indexPath];</div></pre></td></tr></table></figure>
<ul>
<li>ä¿®æ”¹æ•°æ®æºæ–¹æ³•</li>
</ul>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">-(UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath&#123;</div><div class="line">    </div><div class="line">    HMAppCell *cell = [tableView dequeueReusableCellWithIdentifier:cellID forIndexPath:indexPath]<span class="comment">;</span></div><div class="line">    </div><div class="line">    HMAppInfo *info = self.app_infos[indexPath.row]<span class="comment">;</span></div><div class="line">    </div><div class="line">    cell.appName<span class="meta">.text</span> = info.name<span class="comment">;</span></div><div class="line">    cell.downCount<span class="meta">.text</span> = info.download<span class="comment">;</span></div><div class="line">    [cell.iconView sd_setImageWithURL:[NSURL URLWithString:info.icon]]<span class="comment">;</span></div><div class="line">    </div><div class="line">    return cell<span class="comment">;</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>è¿è¡Œæµ‹è¯•<br><img src="http://d.pr/i/1hGr7+" alt="æµ‹è¯•"></p>
</blockquote>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[GCD ä½¿ç”¨æ‰‹å†Œ]]></title>
      <url>http://yoursite.com/2016/05/08/GCD%E4%BD%BF%E7%94%A8%E6%89%8B%E5%86%8C/</url>
      <content type="html"><![CDATA[<h2 id="GCD-ä½¿ç”¨æ‰‹å†Œ"><a href="#GCD-ä½¿ç”¨æ‰‹å†Œ" class="headerlink" title="GCD ä½¿ç”¨æ‰‹å†Œ"></a>GCD ä½¿ç”¨æ‰‹å†Œ</h2><ul>
<li>æ³¨: åœ¨ç½‘ä¸Šçœ‹åˆ°äº†è¿™ç¯‡æ–‡ç« çš„ç¿»è¯‘, å®åœ¨æ˜¯é”™æ¼å¤ªå¤š, è€Œä¸”æä¸é€šé¡º. æ‰€ä»¥è‡ªå·±å‡†å¤‡ç€æ‰‹ç¿»è¯‘ä¸€é, åŸæ–‡åœ°å€åœ¨ä¸‹é¢é™„ä¸Š</li>
<li><a href="">http://khanlou.com/2016/04/the-GCD-handbook/</a></li>
</ul>
<blockquote>
<p><code>Grand Central Dispatch</code>, æˆ–è€…è¯´<code>GCD</code>, æ˜¯ä¸€ä¸ªéå¸¸æœ‰åŠ›çš„å·¥å…·. å®ƒå‘æˆ‘ä»¬æä¾›äº†ä¸€äº›åº•å±‚çš„ç»„ä»¶, åƒæ˜¯<code>é˜Ÿåˆ—</code>æˆ–æ˜¯<code>ä¿¡å·é‡</code>ç­‰è¿™äº›ç»„ä»¶, å¯ä»¥è®©æˆ‘ä»¬é€šè¿‡æœ‰è¶£çš„æ’åˆ—ç»„åˆæ–¹å¼è¾¾åˆ°å¤šçº¿ç¨‹çš„æ•ˆæœ. ä½†ä¸å¹¸çš„æ˜¯, è¿™ä¸ª C è¯­è¨€ä¸ºåº•å±‚çš„ API æ¡†æ¶æœ‰ä¸€äº›æ™¦æ¶©éš¾æ‡‚, å¹¶ä¸”æ²¡æœ‰ä¸€äº›æ˜æ˜¾çš„æç¤ºèƒ½å¤Ÿå‘Šè¯‰æˆ‘ä»¬å¦‚ä½•å°†è¿™äº›åº•å±‚çš„æ¡†æ¶ç»„åˆæˆä¸ºå®é™…çš„åº”ç”¨åœºæ™¯</p>
<p>åœ¨è¿™ç¯‡æ–‡ç« ä¸­, æˆ‘å¸Œæœ›èƒ½å°†ä¸€äº›å¸¸è§çš„åº”ç”¨åœºæ™¯é€šè¿‡<code>GCD</code>çš„APIå‘å¤§å®¶å‘ˆç°</p>
</blockquote>
<h3 id="åå°çº¿ç¨‹"><a href="#åå°çº¿ç¨‹" class="headerlink" title="åå°çº¿ç¨‹"></a>åå°çº¿ç¨‹</h3><blockquote>
<p>åå°çº¿ç¨‹æœ‰å¯èƒ½æ˜¯æœ€ç®€å•çš„åº”ç”¨åœºæ™¯äº†, è¿™å¯ä»¥è®©æˆ‘ä»¬åœ¨åå°çš„çº¿ç¨‹ä¸­æ‰§è¡Œä¸€äº›ä»£ç , å¹¶è¿”å›åˆ°ä¸»çº¿ç¨‹ç»§ç»­å¤„ç†(åƒæ˜¯<code>UIKit</code>ä¸­çš„ä¸€äº›ç»„ä»¶, å¿…é¡»åœ¨ä¸»çº¿ç¨‹ä¸­è¿›è¡Œæ“ä½œ)</p>
<p><strong>åœ¨è¿™ä¸ªæ•™ç¨‹ä¸­, æˆ‘ä¼šä½¿ç”¨ç±»ä¼¼äº<code>doSomeExpensiveWork()</code>è¿™æ ·çš„æ–¹æ³•, æ¥è¡¨ç¤ºè€—æ—¶æ“ä½œ(è€—æ—¶æ“ä½œ: å³æˆ‘ä»¬åº”è¯¥æ”¾åœ¨å¼‚æ­¥ä¸­æ‰§è¡Œçš„æ–¹æ³•, é˜²æ­¢ä¸»çº¿ç¨‹è¢«é˜»å¡)</strong></p>
</blockquote>
<ul>
<li>è¿™ä¸ªæ¨¡å¼å¯ä»¥ä»¥ä¸‹é¢çš„ä»£ç æ¥å®ç°</li>
</ul>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">let defaultPriority = DISPATCH_QUEUE_PRIORITY_DEFAULT</div><div class="line">let backgroundQueue = dispatch_get_global_queue(<span class="name">defaultPriority</span>, <span class="number">0</span>)</div><div class="line">dispatch_async(<span class="name">backgroundQueue</span>, &#123;</div><div class="line">	let result = doSomeExpensiveWork()</div><div class="line">	dispatch_async(<span class="name">dispatch_get_main_queue</span>(), &#123;</div><div class="line">		//use `result` somehow</div><div class="line">	&#125;)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<ul>
<li>åœ¨å®é™…åº”ç”¨ä¸­, é™¤äº†<code>DISPATCH_QUEUE_PRIORITY_DEFAULT</code>æˆ‘æ²¡æœ‰ç”¨è¿‡å…¶ä»–é˜Ÿåˆ—çš„ä¼˜å…ˆçº§. <code>dispatch_get_global_queue(defaultPriority, 0)</code>è¿™ä¸ªæ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªå…¨å±€é˜Ÿåˆ—, å¯ä»¥å°†ä¸Šç™¾ä¸ªçº¿ç¨‹æ”¾åœ¨åå°ä¸­è¿›è¡Œæ“ä½œ.</li>
<li>å¦‚æœæˆ‘ä»¬éœ€è¦å°†è€—æ—¶æ“ä½œæ”¾åœ¨ä¸€ä¸ªä¸€ä¸ªç‰¹å®šçš„é˜Ÿåˆ—ä¸­æ‰§è¡Œ, æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>dispatch_queue_create</code>æ–¹æ³•åˆ›å»ºè‡ªå·±çš„é˜Ÿåˆ—. <code>dispatch_queue_create</code>è¿™ä¸ªæ–¹æ³•å¯ä»¥è®©æˆ‘ä»¬è‡ªè¡Œç»™é˜Ÿåˆ—å‘½å(è€Œéè¿”å›ä¸€ä¸ªå”¯ä¸€çš„<code>å…¨å±€é˜Ÿåˆ—</code>), å¹¶ä¸”å¯ä»¥é€‰æ‹©æ‰€åˆ›å»ºçš„é˜Ÿåˆ—æ˜¯ä¸²è¡Œé˜Ÿåˆ—è¿˜æ˜¯å¹¶è¡Œé˜Ÿåˆ—</li>
<li>éœ€è¦æ³¨æ„çš„æ˜¯, æ¯ä¸€æ¬¡è°ƒç”¨ä½¿ç”¨çš„éƒ½æ˜¯<code>dispatch_async</code>æ“ä½œ, è€Œä¸æ˜¯<code>dispatch_sync</code>æ“ä½œ(æ³¨: asyncå³asynchronous: å¼‚æ­¥æ“ä½œ, syncå³synchronous: åŒæ­¥æ“ä½œ). <code>dispatch_async</code>ä¼šåœ¨blockæ‰§è¡Œå®Œæ¯•å‰å°±è¿”å›, å¹¶ä¸”æ‰§è¡Œä¸‹é¢çš„ä»£ç , ä½†<code>dispatch_sync</code>åˆ™ä¼šç­‰å¾…blockä¸­çš„ä»£ç æ‰§è¡Œå®Œæ¯•åæ‰ä¼šè¿”å›. The inner call can use dispatch_sync (because it doesnâ€™t matter when it returns), but the outer call must be dispatch_async (otherwise the main thread will be blocked).</li>
</ul>
<h3 id="åˆ›å»ºå•ä¾‹"><a href="#åˆ›å»ºå•ä¾‹" class="headerlink" title="åˆ›å»ºå•ä¾‹"></a>åˆ›å»ºå•ä¾‹</h3><blockquote>
<p><code>dispatch_once</code>è¿™ä¸ª API å¯ä»¥ç”¨æ¥åˆ›å»ºå•ä¾‹. åœ¨ Swift ä¸­è¿™å·²ç»ä¸æ˜¯å¿…é¡»çš„äº†, å› ä¸ºåœ¨ Swift ä¸­å­˜åœ¨ä¸€ç§æ›´ç®€å•çš„æ–¹å¼æ¥åˆ›å»ºå•ä¾‹(æ³¨: å³å¯ä»¥é€šè¿‡<code>static let</code>å®ç°). ä¸è¿‡åœ¨ OBjective-C ä¸­, è¿™ä¸ªæ–¹å¼è¿˜æ˜¯å¯ä»¥ä¾›åæ¥äººå‚è€ƒçš„</p>
</blockquote>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">+ (<span class="keyword">instancetype) </span><span class="keyword">sharedInstance </span>&#123;  </div><div class="line">	static <span class="keyword">dispatch_once_t </span>onceToken<span class="comment">;  </span></div><div class="line">	static id <span class="keyword">sharedInstance; </span> </div><div class="line">	<span class="keyword">dispatch_once(&amp;onceToken, </span>^&#123;  </div><div class="line">		<span class="keyword">sharedInstance </span>= [[self alloc] init]<span class="comment">;  </span></div><div class="line">	&#125;)<span class="comment">;  </span></div><div class="line">	return <span class="keyword">sharedInstance; </span> </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="blockè°ƒç”¨çš„ä¸²è¡ŒåŒ–"><a href="#blockè°ƒç”¨çš„ä¸²è¡ŒåŒ–" class="headerlink" title="blockè°ƒç”¨çš„ä¸²è¡ŒåŒ–"></a>blockè°ƒç”¨çš„ä¸²è¡ŒåŒ–</h3><blockquote>
<p>ä»è¿™é‡Œå¼€å§‹, GCD è¿™ç§æœºåˆ¶å¼€å§‹å˜çš„æœ‰è¶£èµ·æ¥äº†. ä½¿ç”¨<code>ä¿¡å·é‡</code>, æˆ‘ä»¬å¯ä»¥å°†æŸä¸€ä¸ªçº¿ç¨‹é˜»å¡ä»»æ„æ—¶é—´, çŸ¥é“å¦ä¸€ä¸ªçº¿ç¨‹å‘å‡ºä¿¡å·. <code>ä¿¡å·é‡(Semaphore)</code>, å°±åƒ GCD ä¸­å…¶å®ƒçš„ç»„ä»¶ä¸€æ ·, æ˜¯çº¿ç¨‹å®‰å…¨çš„, å¹¶ä¸”å¯ä»¥åœ¨ä»»æ„åœ°æ–¹è§¦å‘.<br><br><br><br>ä¿¡å·é‡å¯ä»¥è¢«ç”¨ä½œå½“æˆ‘ä»¬éœ€è¦å°†ä¸€ä¸ªå¼‚æ­¥æ“ä½œè½¬å˜ä¸ºåŒæ­¥æ“ä½œ, è€Œåˆæ— æ³•ä¿®æ”¹è¯¥æ“ä½œæ—¶çš„ä¸€ç§æ–¹æ³•</p>
</blockquote>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">// on a background queue</div><div class="line">dispatch_semaphore_t semaphore = dispatch_semaphore_create(<span class="number">0</span>)</div><div class="line">doSomeExpensiveWorkAsynchronously(<span class="name">completionBlock</span>: &#123;</div><div class="line">    dispatch_semaphore_signal(<span class="name">semaphore</span>)</div><div class="line">&#125;)</div><div class="line">dispatch_semaphore_wait(<span class="name">semaphore</span>, DISPATCH_TIME_FOREVER)</div><div class="line">//the expensive asynchronous work is now done</div></pre></td></tr></table></figure>
<ul>
<li>è°ƒç”¨<code>dispatch_semaphore_wait</code>æ–¹æ³•ä¼šé˜»å¡çº¿ç¨‹, ç›´åˆ°<code>dispatch_semaphore_signal</code>æ–¹æ³•è¢«è°ƒç”¨. è¿™æ„å‘³ç€<code>signal</code>å¿…é¡»åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­è¢«è°ƒç”¨, å› ä¸ºå½“å‰çº¿ç¨‹å·²ç»å®Œå…¨è¢«é˜»å¡, å¦‚æœè°ƒç”¨åˆ™ä¼šé€ æˆæ­»é”. æ­¤å¤–, æˆ‘ä»¬ä¹Ÿä¸èƒ½å†ä¸»çº¿ç¨‹ä¸­è°ƒç”¨<code>wait</code>æ–¹æ³•, è€Œåªèƒ½åœ¨åå°çº¿ç¨‹ä¸­è°ƒç”¨.</li>
<li>åœ¨è°ƒç”¨<code>dispatch_semaphore_wait</code>æ–¹æ³•æ—¶, æˆ‘ä»¬å¯ä»¥é€‰æ‹©ä»»æ„çš„è¶…æ—¶æ—¶é—´, ä½†æˆ‘æ›´å€¾å‘äºä½¿ç”¨<code>DISPATCH_TIME_FOREVER</code>.</li>
<li>çœ‹åˆ°è¿™é‡Œ, æˆ‘ä»¬å¯èƒ½è¿˜æ˜¯ä¸å¤ªæ˜ç¡®ä¸ºä»€ä¹ˆè¦åœ¨å·²ç»æœ‰blockçš„æƒ…å†µä¸‹å°†å…¶ä¸²è¡ŒåŒ–, ä½†è¿™ä¸ªæœºåˆ¶è¿Ÿæ—©æ˜¯æœ‰ç”¨çš„. æˆ‘æœ€è¿‘ä½¿ç”¨åˆ°å®ƒçš„ä¸€ä¸ªæƒ…æ™¯æ˜¯, æˆ‘éœ€è¦å°†ä¸€ç³»åˆ—å¼‚æ­¥æ“ä½œåœ¨åå°ä¸²è¡Œæ‰§è¡Œ. ç®€å•æŠ½è±¡æ¥è¯´, è¿™ä¸ªæƒ…æ™¯å¯ä»¥è¢«ç§°ä½œ<code>å¼‚æ­¥ä¸²è¡Œæœºåˆ¶</code>:</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typealias</span> <span class="type">DoneBlock</span> = () -&gt; ()</div><div class="line"><span class="keyword">typealias</span> <span class="type">WorkBlock</span> = (<span class="type">DoneBlock</span>) -&gt; ()</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">AsyncSerialWorker</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">let</span> serialQueue = dispatch_queue_create(<span class="string">"com.khanlou.serial.queue"</span>, <span class="type">DISPATCH_QUEUE_SERIAL</span>)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">enqueueWork</span><span class="params">(work: WorkBlock)</span></span> &#123;</div><div class="line">        dispatch_async(serialQueue) &#123;</div><div class="line">            <span class="keyword">let</span> semaphore = dispatch_semaphore_create(<span class="number">0</span>)</div><div class="line">            work(&#123;</div><div class="line">                dispatch_semaphore_signal(semaphore)</div><div class="line">            &#125;)</div><div class="line">            dispatch_semaphore_wait(semaphore, <span class="type">DISPATCH_TIME_FOREVER</span>)</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°, åœ¨è¿™ä¸ªç®€å•çš„ç±»ä¸­, æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªä¸²è¡Œé˜Ÿåˆ—, å¹¶ä¸”å…è®¸ä½¿ç”¨ä¸€ä¸ªblockå°†è¦æ‰§è¡Œçš„ä»£ç å…¥é˜Ÿ. åŒæ—¶, è¿™ä¸ª<code>WorkBlock</code>åœ¨æ‰§è¡Œå®Œæ¯•åæä¾›äº†ä¸€ä¸ª<code>DoneBlock</code>ä½œä¸ºè¿”å›å€¼, è€Œè¿™ä¸ª<code>DoneBlock</code>åˆ™ä¼šè§¦å‘<code>ä¿¡å·é‡</code>, æ¥ä½¿å¾—è¿™ä¸ªä¸²è¡Œé˜Ÿåˆ—å¾—ä»¥ç»§ç»­æ‰§è¡Œ.</li>
</ul>
<h3 id="é™åˆ¶å¹¶å‘blockçš„æ•°é‡"><a href="#é™åˆ¶å¹¶å‘blockçš„æ•°é‡" class="headerlink" title="é™åˆ¶å¹¶å‘blockçš„æ•°é‡"></a>é™åˆ¶å¹¶å‘blockçš„æ•°é‡</h3><blockquote>
<p>åœ¨ä¹‹å‰çš„ä¾‹å­ä¸­, ä¿¡å·é‡ä»…ä»…ä½œä¸ºç®€å•çš„æ ‡è®°è¿›è¡Œä½¿ç”¨, ä½†å®é™…ä¸Šå®ƒä¹Ÿå¯ä»¥ä½œä¸ºæœ‰é™èµ„æºçš„è®¡æ•°å™¨æ¥ä½¿ç”¨. å¦‚æœä½ ä»…ä»…å¸Œæœ›é’ˆå¯¹æŸä¸€ç‰¹å®šçš„èµ„æºæœåŠ¡å¼€å¯æŒ‡å®šæ•°é‡çš„ç½‘ç»œè¿æ¥, ä½ å¯ä»¥å‚è€ƒä¸‹é¢çš„ä»£ç : </p>
</blockquote>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">LimitedWorker</span> &#123;</span></div><div class="line">	private <span class="keyword">let</span> serialQueue = dispatch_queue_create(<span class="string">"com.khanlou.serial.queue"</span>, DISPATCH_QUEUE_SERIAL)</div><div class="line">	private <span class="keyword">let</span> concurrentQueue = dispatch_queue_create(<span class="string">"com.khanlou.concurrent.queue"</span>, DISPATCH_QUEUE_CONCURRENT)</div><div class="line">	private <span class="keyword">let</span> semaphore: dispatch_semaphore_t</div><div class="line">		</div><div class="line">	init(limit: Int) &#123;</div><div class="line">        semaphone = dispatch_semaphore_create(limit)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    func enqueue<span class="function"><span class="params">(task: () -&gt; ())</span> &#123;</span></div><div class="line">        <span class="title">dispatch_async</span><span class="params">(serialQueue)</span> &#123;</div><div class="line">            <span class="title">dispatch_semaphore_wait</span><span class="params">(self.semaphore, DISPATCH_TIME_FOREVER)</span></div><div class="line">            <span class="title">dispatch_async</span><span class="params">(self.concurrentQueue)</span> &#123;</div><div class="line">                <span class="title">task</span><span class="params">()</span></div><div class="line">                <span class="title">dispatch_semaphore_signal</span><span class="params">(self.semaphore)</span></div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li><p>è¿™ä¸€æ®µä»£ç æ˜¯å‚è€ƒè‡ªè‹¹æœå®˜æ–¹çš„ <a href="https://developer.apple.com/library/content/documentation/General/Conceptual/ConcurrencyProgrammingGuide/OperationQueues/OperationQueues.html#//apple_ref/doc/uid/TP40008091-CH102-SW24" target="_blank" rel="external">Concurrency Programming Guide</a>. è€Œå…¶ä¸­çš„è§£é‡Šè¦æ¯”æˆ‘æ¸…æ™°ä¸€äº›: </p>
<blockquote>
<p>å½“æˆ‘ä»¬åˆ›å»ºä¿¡å·é‡æ—¶, å¯ä»¥é’ˆå¯¹ç‰¹å®šçš„èµ„æºæŒ‡å®šå¯ç”¨æ•°é‡. è¯¥å˜é‡å¯ä»¥åœ¨åˆå§‹åŒ–ä¿¡å·é‡çš„æ—¶å€™è¿›è¡Œèµ‹å€¼. æ¯æ¬¡åœ¨æˆ‘ä»¬ç­‰å¾…(è°ƒç”¨<code>wait</code>)çš„æ—¶å€™, <code>dispatch_semaphore_wait</code>æ–¹æ³•ä¼šå°†è¯¥å˜é‡è‡ªå‡1. å¦‚æœè‡ªå‡åçš„ç»“æœä¸ºè´Ÿæ•°, åˆ™è¯¥æ–¹æ³•å†…éƒ¨ä¼šé€šçŸ¥å†…æ ¸é˜»å¡è¯¥çº¿ç¨‹. æ¢å¥è¯è¯´, <code>dispatch_semaphore_signal</code>æ–¹æ³•åˆ™ä¼šå°†è¯¥å˜é‡è‡ªå¢1, ä»¥è¡¨ç¤ºè¯¥èµ„æºå·²ç»è¢«é‡Šæ”¾, å¯ä»¥ä½¿ç”¨. å¦‚æœæ­¤æ—¶æœ‰ä»»åŠ¡è¢«é˜»å¡, ä¸”æ­£åœ¨ç­‰å¾…å¯ç”¨èµ„æºçš„è¯, å…¶ä¸­ä¹‹ä¸€å°±ä¼šè¢«é‡Šæ”¾å¼€å¹¶è¢«æ‰§è¡Œ.</p>
</blockquote>
<ul>
<li>è¿™ä¸ªæœºåˆ¶æ¯”è¾ƒç±»ä¼¼äº<code>NSOperationQueue</code>ä¸­çš„<code>maxConcurrentOperationCount</code>å±æ€§. å¦‚æœæˆ‘ä»¬ä½¿ç”¨äº† GCD åŸç”Ÿçš„é˜Ÿåˆ—å–ä»£äº†<code>NSOperationQueue</code>çš„è¯, åˆ™å¯ä»¥ä½¿ç”¨ä¿¡å·é‡æ§åˆ¶åŒæ—¶æ‰§è¡Œçš„blockæ•°é‡.</li>
<li><p>æ„Ÿè°¢ <a href="http://dx13.co.uk/articles/2016/6/4/limiting-concurrent-execution-using-gcd.html" target="_blank" rel="external">Mike Rhodes</a> çš„æé†’, è¿™æ®µä»£ç å¯ä»¥è¢«ä¸€ä¸ª <a href="https://gist.github.com/khanlou/c5664183cfa5505a4eb011656c2c0e46" target="_blank" rel="external">ä¹‹å‰çš„ç‰ˆæœ¬</a> ä¼˜åŒ–. ä»–å†™é“: </p>
<blockquote>
<p>æˆ‘ä»¬ä½¿ç”¨å¹¶å‘é˜Ÿåˆ—æ¥æ‰§è¡Œç”¨æˆ·çš„ä»»åŠ¡, å¹¶åœ¨è¯¥é˜Ÿåˆ—ä¸­æ‰§è¡Œ GCD å…è®¸æˆ‘ä»¬æ‰§è¡Œçš„æ•°é‡çš„ä»»åŠ¡. å…¶ä¸­çš„å…³é”®åœ¨äºç¬¬äºŒä¸ª GCD é˜Ÿåˆ—. è¯¥é˜Ÿåˆ—æ˜¯ä¸€ä¸ªä¸²è¡Œé˜Ÿåˆ—, å¯¹äºä¹‹å‰çš„å¹¶å‘é˜Ÿåˆ—æ¥è¯´, å…¶æ‰®æ¼”äº†ä¸€ä¸ªå®ˆé—¨å‘˜çš„è§’è‰². æˆ‘ä»¬åœ¨è¿™ä¸ªä¸²è¡Œé˜Ÿåˆ—ä¸­ç­‰å¾…ä¿¡å·é‡çš„å‘å‡º, è¿™æ„å‘³ç€å½“å¹¶å‘é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡æ•°é‡è¾¾åˆ°æœ€å¤§å, æˆ‘ä»¬ä¹Ÿåªæœ‰ä¸€ä¸ªè¢«é˜»å¡çš„çº¿ç¨‹. è€Œå…¶å®ƒè¢«å…¥é˜Ÿçš„ä»»åŠ¡åˆ™ä¼šåœ¨ä¸²è¡Œé˜Ÿåˆ—å†…éƒ¨ç­‰å¾…æ‰§è¡Œ, å¹¶ä¸”ä¸ä¼šå¯¼è‡´æ–°çº¿ç¨‹è¢«å¼€å¯.</p>
</blockquote>
</li>
</ul>
</li>
</ul>
]]></content>
    </entry>
    
  
  
</search>
